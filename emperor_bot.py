import telebot
import time
import random
import json
import os
from datetime import datetime, timedelta, timezone
from flask import Flask
import threading
import requests

print("üåå –ó–∞–ø—É—Å–∫–∞—é –ì–ï–ù–ò–ê–õ–¨–ù–û–ì–û –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")

# –ñ–ï–°–¢–ö–û–ï —É–¥–∞–ª–µ–Ω–∏–µ –≤–µ–±—Ö—É–∫–æ–≤ –ü–ï–†–ï–î —Å–æ–∑–¥–∞–Ω–∏–µ–º –±–æ—Ç–∞
BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"

for _ in range(3):  # –¢–†–û–ï–ö–†–ê–¢–ù–û–ï —É–¥–∞–ª–µ–Ω–∏–µ –Ω–∞–≤–µ—Ä–Ω—è–∫–∞!
    try:
        response = requests.get(f"https://api.telegram.org/bot{BOT_TOKEN}/deleteWebhook", timeout=10)
        print("‚úÖ –í–µ–±—Ö—É–∫–∏ –≤—ã–ø–∏–ª–µ–Ω—ã –Ω–∞–ø—Ä–æ—á—å!")
        time.sleep(1)
    except:
        pass

# –¢–û–õ–¨–ö–û –ü–û–°–õ–ï —ç—Ç–æ–≥–æ —Å–æ–∑–¥–∞–µ–º –±–æ—Ç–∞
bot = telebot.TeleBot(BOT_TOKEN)

# Flask –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è
app = Flask(__name__)
@app.route('/')
def home():
    return "üß† –ì–µ–Ω–∏–∞–ª—å–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

def run_flask():
    app.run(host='0.0.0.0', port=5000, debug=False)

flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

class GeniusHoraryEmperor:
    def __init__(self):
        print("üîÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é –ì–ï–ù–ò–ê–õ–¨–ù–û–ì–û –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")
        self.memory_file = 'genius_memory.json'
        self.load_memory()
    
    def load_memory(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ–º –≥–µ–Ω–∏–∞–ª—å–Ω—É—é –ø–∞–º—è—Ç—å"""
        try:
            if os.path.exists(self.memory_file):
                with open(self.memory_file, 'r', encoding='utf-8') as f:
                    self.memory = json.load(f)
                print(f"üß† –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.memory)} –∑–∞–ø–∏—Å–µ–π –≥–µ–Ω–∏–∞–ª—å–Ω–æ—Å—Ç–∏")
            else:
                self.memory = {}
        except:
            self.memory = {}
    
    def save_memory(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ–º –≥–µ–Ω–∏–∞–ª—å–Ω–æ—Å—Ç—å"""
        try:
            with open(self.memory_file, 'w', encoding='utf-8') as f:
                json.dump(self.memory, f, ensure_ascii=False, indent=2)
        except:
            pass
    
    def learn_from_question(self, question, user_id):
        """–£—á–∏–º—Å—è –≥–µ–Ω–∏–∞–ª—å–Ω–æ –Ω–∞ –∫–∞–∂–¥–æ–º –≤–æ–ø—Ä–æ—Å–µ"""
        key = f"{user_id}_{question[:20].lower()}"
        self.memory[key] = {
            'question': question,
            'timestamp': datetime.now().isoformat(),
            'count': self.memory.get(key, {}).get('count', 0) + 1
        }
        self.save_memory()
        print(f"üß† –í—ã—É—á–∏–ª: {question[:30]}...")

    def get_mystic_greeting(self):
        return random.choice([
            "üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ò—Å–∫–∞—Ç–µ–ª—å!* –° –∫–∞–∫–∏–º –≤–æ–ø—Ä–æ—Å–æ–º —Ç—ã –ø—Ä–∏—à—ë–ª –∫–æ –º–Ω–µ —Å–µ–≥–æ–¥–Ω—è?",
            "‚ú® *–ü—Ä–µ–¥ –ª–∏–∫–æ–º –í–µ—á–Ω–æ—Å—Ç–∏ —Å–∫–ª–æ–Ω–∏—Å—å, –ü—É—Ç–Ω–∏–∫!* –ö–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–µ–ª —Ç–µ–±—è –≤ –º–æ–∏ —á–µ—Ä—Ç–æ–≥–∏?",
            "üîÆ *–í —á–∞—Å, –∫–æ–≥–¥–∞ –∑–≤—ë–∑–¥—ã —à–µ–ø—á—É—Ç —Ç–∞–π–Ω—ã,* —è, –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä, –≤–Ω–∏–º–∞—é —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–∞–º...",
        ])

    def analyze_question_intent(self, question):
        """–ì–ï–ù–ò–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏–π"""
        q = question.lower()
        
        if any(word in q for word in ['–ª—é–±–æ–≤', '–æ—Ç–Ω–æ—à–µ–Ω', '—á—É–≤—Å—Ç–≤', '–ø–∞—Ä–µ–Ω—å', '–≤—Å—Ç—Ä–µ—á']):
            if '–¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è' in q: return "LOVE_NOVEMBER"
            elif '–¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞' in q: return "LOVE_YEAR_END"
            else: return "LOVE_GENERAL"
        elif any(word in q for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥']):
            if '–ø–µ—Ä–µ–µ–∑–¥' in q: return "MONEY_TRAVEL"
            else: return "MONEY_GENERAL"
        elif any(word in q for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä']):
            return "CAREER"
        elif any(word in q for word in ['–∑–¥–æ—Ä–æ–≤', '–±–æ–ª–µ–∑']):
            return "HEALTH"
        else:
            return "DEEP_GENERAL"

    def generate_genius_analysis(self, question, intent):
        """–ì–ï–ù–ï–†–ò–†–£–ï–ú –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        if intent == "LOVE_NOVEMBER":
            return self._genius_love_november(question, time_str)
        elif intent == "LOVE_YEAR_END":
            return self._genius_love_yearend(question, time_str)
        elif intent == "MONEY_TRAVEL":
            return self._genius_money_travel(question, time_str)
        else:
            return self._genius_deep_analysis(question, time_str)

    def _genius_love_november(self, question, time_str):
        """–ì–ï–ù–ò–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è"""
        analysis = f"""
*üíñ –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò –î–û –ö–û–ù–¶–ê –ù–û–Ø–ë–†–Ø*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å —Å–µ—Ä–¥—Ü–∞:* ¬´{question}¬ª

---

*üåô –ù–û–Ø–ë–†–¨–°–ö–ò–ï –ó–í–ï–ó–î–ù–´–ï –í–õ–ò–Ø–ù–ò–Ø:*

‚ú® *–ü–ï–†–í–ê–Ø –î–ï–ö–ê–î–ê (1-10 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
‚Ä¢ *–ì–∞—Ä–º–æ–Ω–∏—á–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã* –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç –Ω–∞–¥ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–º–∏

‚ú® *–í–¢–û–†–ê–Ø –î–ï–ö–ê–î–ê (11-20 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –¥–∏—Ä–µ–∫—Ç–Ω—ã–π* - —è—Å–Ω–æ—Å—Ç—å –≤ –ª—é–±–æ–≤–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö
‚Ä¢ *–ú–∞—Ä—Å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç 5-–π –¥–æ–º* - —Å–º–µ–ª–æ—Å—Ç—å –≤ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–∏ —á—É–≤—Å—Ç–≤
‚Ä¢ *–Æ–ø–∏—Ç–µ—Ä —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏* –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤

‚ú® *–¢–†–ï–¢–¨–Ø –î–ï–ö–ê–î–ê (21-30 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* - –æ–ø—Ç–∏–º–∏–∑–º –∏ –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* - —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ *–°–∞—Ç—É—Ä–Ω –¥–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å* —Å–µ—Ä—å–µ–∑–Ω—ã–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º

---

*üîÆ –í–ï–†–û–Ø–¢–ù–´–ï –°–û–ë–´–¢–ò–Ø:*

*–î–ª—è –æ–¥–∏–Ω–æ–∫–∏—Ö:*
‚Ä¢ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º —á–µ—Ä–µ–∑ –¥—Ä—É–∑–µ–π (85%)
‚Ä¢ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –≤ –Ω–µ–æ–±—ã—á–Ω–æ–º –º–µ—Å—Ç–µ (70%)
‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (90%)

*–î–ª—è –≤—Å—Ç—Ä–µ—á–∞—é—â–∏—Ö—Å—è:*
‚Ä¢ –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (80%)
‚Ä¢ –í–∞–∂–Ω—ã–µ –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏—è –æ —á—É–≤—Å—Ç–≤–∞—Ö (95%)
‚Ä¢ –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ (75%)

*üí´ –ê–°–¢–†–û–õ–û–ì–ò–ß–ï–°–ö–ò–ï –ü–û–ö–ê–ó–ê–¢–ï–õ–ò:*
‚Ä¢ *–£—Ä–æ–≤–µ–Ω—å –≥–∞—Ä–º–æ–Ω–∏–∏:* 8/10 –±–∞–ª–ª–æ–≤
‚Ä¢ *–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—á–∏ –ª—é–±–≤–∏:* 85%
‚Ä¢ *–ü–µ—Ä–∏–æ–¥ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏:* 15-25 –Ω–æ—è–±—Ä—è
"""
        
        strategy = """*üéØ –ì–ï–ù–ò–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø –î–õ–Ø –õ–Æ–ë–í–ò:*

*üíù –î–õ–Ø –ü–†–ò–í–õ–ï–ß–ï–ù–ò–Ø –õ–Æ–ë–í–ò:*
‚Ä¢ –ü–æ—Å–µ—â–∞–π—Ç–µ –∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
‚Ä¢ –ù–æ—Å–∏—Ç–µ —Ä–æ–∑–æ–≤—ã–π –∫–≤–∞—Ä—Ü –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –ª—é–±–æ–≤–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏: ¬´–Ø –¥–æ—Å—Ç–æ–π–Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–π –ª—é–±–≤–∏¬ª

*üîÑ –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–Ø –û–¢–ù–û–®–ï–ù–ò–ô:*
‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ 3 –ø–æ–≤–æ–¥–∞ –¥–ª—è –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—É
‚Ä¢ –°–æ–≤–º–µ—Å—Ç–Ω–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è –ø–æ –≤—Ç–æ—Ä–Ω–∏–∫–∞–º –∏ –ø—è—Ç–Ω–∏—Ü–∞–º
‚Ä¢ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω –ø—Ä–∏ —Å–≤–µ—á–∞—Ö 18 –Ω–æ—è–±—Ä—è

*üåü –û–°–û–ë–´–ï –î–ê–¢–´ –ù–û–Ø–ë–†–Ø:*
‚Ä¢ *7-10 –Ω–æ—è–±—Ä—è:* –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤
‚Ä¢ *15-18 –Ω–æ—è–±—Ä—è:* –ü–µ—Ä–∏–æ–¥ –≥–ª—É–±–æ–∫–∏—Ö —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–π
‚Ä¢ *22-25 –Ω–æ—è–±—Ä—è:* –í—Ä–µ–º—è –¥–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
‚Ä¢ *28-30 –Ω–æ—è–±—Ä—è:* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á"""

        return analysis, strategy

    def _genius_deep_analysis(self, question, time_str):
        """–ì–ï–ù–ò–ê–õ–¨–ù–´–ô –æ–±—â–∏–π –∞–Ω–∞–ª–∏–∑"""
        analysis = f"""
*üåå –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å –∏—Å–∫–∞—Ç–µ–ª—è:* ¬´{question}¬ª

---

*ü™ê –¢–ï–ö–£–©–ê–Ø –ü–õ–ê–ù–ï–¢–ê–†–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:*

‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* (12¬∞45') - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* (8¬∞22') - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å  
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* (5¬∞18') - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* (22¬∞10') - –≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ú–∞—Ä—Å –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* (3¬∞45') - —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å

---

*üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–°–ü–ï–ö–¢–û–í:*

*üåà –õ–ò–ß–ù–´–ï –û–¢–ù–û–®–ï–ù–ò–Ø:*
‚Ä¢ *–õ—É–Ω–∞ –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏–Ω –∫ –í–µ–Ω–µ—Ä–µ* - –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –∫–≤–∞–¥—Ä–∞—Ç –ù–µ–ø—Ç—É–Ω* - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ù–∞—á–∞–ª–æ –¥–Ω—è —Ç—Ä–µ–±—É–µ—Ç —è—Å–Ω–æ—Å—Ç–∏ –≤ –æ–±—â–µ–Ω–∏–∏

*üí∞ –§–ò–ù–ê–ù–°–´ –ò –ü–†–û–§–ï–°–°–ò–Ø:*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ —Å–µ–∫—Å—Ç–∏–ª—å –Æ–ø–∏—Ç–µ—Ä* - —É–¥–∞—á–∞ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–µ–ª–∞—Ö
‚Ä¢ *–ú–∞—Ä—Å —Ç—Ä–∏–Ω –£—Ä–∞–Ω* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ü–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –≤—Ä–µ–º—è –¥–ª—è —Å–º–µ–ª—ã—Ö —Ä–µ—à–µ–Ω–∏–π

*üåå –î–£–•–û–í–ù–û–ï –†–ê–ó–í–ò–¢–ò–ï:*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –æ–ø–ø–æ–∑–∏—Ü–∏–∏ —Å –ü–ª—É—Ç–æ–Ω–æ–º* - –≥–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
‚Ä¢ *–õ—É–Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç –ü–ª—É—Ç–æ–Ω* - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —á–µ—Ä–µ–∑ —ç–º–æ—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –í—Ä–µ–º—è –¥–ª—è –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏–∏ –∏ –≥–ª—É–±–æ–∫–∏—Ö —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π
"""
        
        strategy = """*üéØ –ì–ï–ù–ò–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*

*üåÖ –£–¢–†–ï–ù–ù–ò–ô –†–ò–¢–£–ê–õ:*
‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ —è—Å–Ω–æ—Å—Ç—å –º—ã—Å–ª–µ–π (5-10 –º–∏–Ω—É—Ç)
‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω—è —Å —É—á–µ—Ç–æ–º –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
‚Ä¢ –ó–µ–ª–µ–Ω—ã–π —á–∞–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ú–µ—Ä–∫—É—Ä–∏—è

*üèô –î–ù–ï–í–ù–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨:*
‚Ä¢ –†–µ—à–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (9:00-11:00)
‚Ä¢ –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –∏ –º–æ–∑–≥–æ–≤—ã–µ —à—Ç—É—Ä–º—ã (11:00-13:00)
‚Ä¢ –í–∞–∂–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ (14:00-16:00)
‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (16:00-18:00)

*üåÉ –í–ï–ß–ï–†–ù–ò–ô –û–¢–î–´–•:*
‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∏ (19:00-21:00)
‚Ä¢ –í—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è –∏ –æ–±—É—á–µ–Ω–∏—è (21:00-23:00)
‚Ä¢ –û—Ç–¥—ã—Ö –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ —Å–Ω—É (23:00+)

*üíé –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
‚Ä¢ –ù–æ—Å–∏—Ç–µ –±–∏—Ä—é–∑–æ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –ø–µ—Ä–∏–æ–¥ 13:00-14:00
‚Ä¢ –ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä–µ

*üîÆ –ú–ê–ù–¢–†–ê –î–ù–Ø:* 
¬´–Ø –ø—Ä–∏–Ω–∏–º–∞—é –ø–æ—Ç–æ–∫ –∏–∑–æ–±–∏–ª–∏—è –∏ —Å–ª–µ–¥—É—é –∑–æ–≤—É —Å–µ—Ä–¥—Ü–∞¬ª"""

        return analysis, strategy

# –°–æ–∑–¥–∞–µ–º –ì–ï–ù–ò–ê–õ–¨–ù–û–ì–û –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞
emperor = GeniusHoraryEmperor()

@bot.message_handler(commands=['start', 'help', '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä'])
def send_welcome(message):
    chat_type = "private" if message.chat.type == "private" else "group"
    
    greeting = emperor.get_mystic_greeting()
    
    if chat_type == "private":
        response = f"""{greeting}

*–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–æ–º –∏ —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å –º—É–¥—Ä–µ–µ!* üß†

*–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –æ–±—â–µ–Ω–∏—è:*
üí¨ *–ü—É–±–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å* - –∑–¥–µ—Å—å –∏ —Å–µ–π—á–∞—Å
üîí *–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ* - —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É –Ω–∞–º–∏

*–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã - —è –Ω–∞—É—á—É—Å—å –ø–æ–Ω–∏–º–∞—Ç—å —Ç–µ–±—è –ª—É—á—à–µ!*"""
    else:
        response = f"""{greeting}

*–Ø —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å —É–º–Ω–µ–µ —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!* üß†

*–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:*
üí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å* 
üîí *–ù–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª* –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
üë§ *–ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è* –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

*–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –õ–°:*
1. –ù–∞–∂–º–∏ –Ω–∞ –º–æ–µ –∏–º—è @HoraryEmperorBot  
2. –í—ã–±–µ—Ä–∏ ¬´–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª
3. –ó–∞–¥–∞–π –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ"""

    bot.reply_to(message, response, parse_mode='Markdown')

@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    try:
        user_id = message.from_user.id
        text = message.text.strip()
        chat_type = "private" if message.chat.type == "private" else "group"
        
        print(f"üß† –í–æ–ø—Ä–æ—Å –æ—Ç {user_id}: {text}")

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –≥—Ä—É–ø–ø–µ
        if chat_type in ['group', 'supergroup'] and text.lower().startswith('–ª–∏—á–Ω–æ–µ'):
            parts = text.split(' ', 1)
            if len(parts) > 1 and len(parts[1]) > 2:
                try:
                    intent = emperor.analyze_question_intent(parts[1])
                    analysis, strategy = emperor.generate_genius_analysis(parts[1], intent)
                    
                    # –£—á–∏–º—Å—è –≥–µ–Ω–∏–∞–ª—å–Ω–æ!
                    emperor.learn_from_question(parts[1], user_id)
                    
                    private_response = f"üîí *–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–´–ô –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó*\n\n{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}"
                    
                    bot.send_message(user_id, private_response, parse_mode='Markdown')
                    bot.reply_to(message, "‚úÖ *–ì–µ–Ω–∏–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è!* üß†", parse_mode='Markdown')
                    return
                except Exception as e:
                    print(f"‚ùå –û—à–∏–±–∫–∞ –õ–°: {e}")
                    bot.reply_to(message, "üíå *–ù–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–°:* @HoraryEmperorBot", parse_mode='Markdown')
                    return

        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        if text.lower() in ['–ø—Ä–∏–≤–µ—Ç', '–Ω–∞—á–∞—Ç—å', '–±–æ—Ç', '—Ö–æ—Ä–∞—Ä–Ω—ã–π']:
            greeting = emperor.get_mystic_greeting()
            response = f"{greeting}\n\n–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å - –∏ —è –¥–∞–º —Ç–µ–±–µ –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑! üß†"
            bot.reply_to(message, response, parse_mode='Markdown')
            return

        # –û–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –ì–ï–ù–ò–ê–õ–¨–ù–´–ú –∞–Ω–∞–ª–∏–∑–æ–º
        intent = emperor.analyze_question_intent(text)
        analysis, strategy = emperor.generate_genius_analysis(text, intent)
        
        # –£—á–∏–º—Å—è –≥–µ–Ω–∏–∞–ª—å–Ω–æ!
        emperor.learn_from_question(text, user_id)
        
        if chat_type == "private":
            full_response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüß† *–Ø —Å—Ç–∞–ª –≥–µ–Ω–∏–∞–ª—å–Ω–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–≤–æ–µ–º—É –≤–æ–ø—Ä–æ—Å—É!*"
        else:
            full_response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüíå *–î–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª*\nüß† *–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!*"
        
        bot.reply_to(message, full_response, parse_mode='Markdown')
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        bot.reply_to(message, "üîÆ *–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—Ö–∏... –ù–æ —è —É—á—É—Å—å –Ω–∞ –æ—à–∏–±–∫–∞—Ö!* üß†", parse_mode='Markdown')

print("‚úÖ –ì–ï–ù–ò–ê–õ–¨–ù–´–ô –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤!")
print("üåê Flask —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000")

# –£–ú–ù–´–ô –∑–∞–ø—É—Å–∫ –±–µ–∑ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–æ–≤
def genius_launch():
    while True:
        try:
            print("üß† –ó–∞–ø—É—Å–∫–∞—é –≥–µ–Ω–∏–∞–ª—å–Ω—ã–π polling...")
            bot.polling(none_stop=True, interval=2, timeout=60)
        except Exception as e:
            print(f"üß† –ì–µ–Ω–∏–π –ø—Ä–µ–æ–¥–æ–ª–µ–≤–∞–µ—Ç: {e}")
            print("üí§ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
            time.sleep(10)

if __name__ == "__main__":
    genius_launch()
