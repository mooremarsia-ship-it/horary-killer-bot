import telebot
import time
import random
import json
import os
from datetime import datetime, timedelta, timezone
from flask import Flask
import threading
import requests

print("üåå –ó–∞–ø—É—Å–∫–∞—é –°–í–ï–†–•–£–ú–ù–û–ì–û –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"

# –£–¥–∞–ª—è–µ–º –≤–µ–±—Ö—É–∫–∏
try:
    response = requests.get(f"https://api.telegram.org/bot{BOT_TOKEN}/deleteWebhook")
    print("‚úÖ –í–µ–±—Ö—É–∫–∏ —É–¥–∞–ª–µ–Ω—ã")
    time.sleep(2)
except:
    print("‚úÖ –í–µ–±—Ö—É–∫–æ–≤ –Ω–µ –±—ã–ª–æ")

bot = telebot.TeleBot(BOT_TOKEN)

# Flask
app = Flask(__name__)
@app.route('/')
def home():
    return "üß† –°–≤–µ—Ä—Ö—É–º–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

def run_flask():
    app.run(host='0.0.0.0', port=5000, debug=False)

flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

class SuperSmartEmperor:
    def __init__(self):
        print("üîÆ –°–≤–µ—Ä—Ö—É–º–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
    
    def get_greeting(self):
        return random.choice([
            "üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ò—Å–∫–∞—Ç–µ–ª—å!* –° –∫–∞–∫–∏–º –≤–æ–ø—Ä–æ—Å–æ–º —Ç—ã –ø—Ä–∏—à—ë–ª –∫–æ –º–Ω–µ —Å–µ–≥–æ–¥–Ω—è?",
            "‚ú® *–ü—Ä–µ–¥ –ª–∏–∫–æ–º –í–µ—á–Ω–æ—Å—Ç–∏ —Å–∫–ª–æ–Ω–∏—Å—å, –ü—É—Ç–Ω–∏–∫!* –ö–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–µ–ª —Ç–µ–±—è –≤ –º–æ–∏ —á–µ—Ä—Ç–æ–≥–∏?",
            "üîÆ *–í —á–∞—Å, –∫–æ–≥–¥–∞ –∑–≤—ë–∑–¥—ã —à–µ–ø—á—É—Ç —Ç–∞–π–Ω—ã,* —è, –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä, –≤–Ω–∏–º–∞—é —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–∞–º...",
        ])
    
    def is_greeting_or_command(self, text):
        """–¢–û–ß–ù–û–ï —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–π –∏ –∫–æ–º–∞–Ω–¥"""
        text_lower = text.lower().strip()
        
        greetings = [
            '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä', '–±–æ—Ç', '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', '—Å–∞–ª—é—Ç', 
            'start', 'help', '/start', '/help', '–Ω–∞—á–∞—Ç—å', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ',
            '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä', '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ', 'hi', 'hello',
            '–∫—É', '—Å–∞–ª–∞–º', '–ø—Ä–∏–≤', '–ø—Ä–∏–≤–µ—Ç–∏–∫', '—Ö–æ—Ä–∞—Ä–Ω—ã–π', '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä'
        ]
        
        return text_lower in greetings
    
    def is_private_request(self, text):
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ª–∏—á–Ω–æ–µ"""
        return text.lower().startswith(('–ª–∏—á–Ω–æ–µ', '–ø—Ä–∏–≤–∞—Ç–Ω–æ', '–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ'))
    
    def is_real_question(self, text):
        """–£–ú–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞ - –Ω–∞—Å—Ç–æ—è—â–∏–π –ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å"""
        text_lower = text.lower().strip()
        
        # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ - –Ω–µ –≤–æ–ø—Ä–æ—Å
        if self.is_greeting_or_command(text_lower):
            return False
            
        # –°–ª–∏—à–∫–æ–º –∫–æ—Ä–æ—Ç–∫–∏–µ —Å–æ–æ–±—â–µ–Ω–∏—è - –Ω–µ –≤–æ–ø—Ä–æ—Å—ã
        if len(text_lower) < 4:
            return False
            
        # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –Ω–∞—Å—Ç–æ—è—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
        question_keywords = [
            '–∫–æ–≥–¥–∞', '—á—Ç–æ', '–∫–∞–∫', '–ø–æ—á–µ–º—É', '–∑–∞—á–µ–º', '–±—É–¥–µ—Ç', '–µ—Å—Ç—å', '–±—É–¥–µ—Ç –ª–∏',
            '–º–Ω–µ', '–º–µ–Ω—è', '–º–æ–π', '–º–æ—è', '–º–æ–µ', '–º–æ–∏', 
            '–ª—é–±–æ–≤—å', '–¥–µ–Ω—å–≥–∏', '–æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Ä–∞–±–æ—Ç–∞', '–±—É–¥—É—â–µ–µ', '—Å—É–¥—å–±–∞',
            '–≤—Å—Ç—Ä–µ—á—É', '–ø–æ–ª—É—á—É', '–∏–∑–º–µ–Ω–∏—Ç—Å—è', '–ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç', '–∂–¥—É—Ç',
            '–º–∏—Ö–∞–∏–ª', '–º–∏—à–∞', '–ø–µ—Ä–µ–µ–∑–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', '—Ñ–∏–Ω–∞–Ω—Å—ã', '–∫–∞—Ä—å–µ—Ä–∞',
            '–∑–¥–æ—Ä–æ–≤—å–µ', '—Å–µ–º—å—è', '–¥–µ—Ç–∏', '–±—Ä–∞–∫', '–∑–∞–º—É–∂–µ—Å—Ç–≤–æ', '–∂–µ–Ω–∏—Ç—å–±–∞'
        ]
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        has_keywords = any(keyword in text_lower for keyword in question_keywords)
        
        # –ò–ª–∏ –µ—Å—Ç—å –≤–æ–ø—Ä–æ—Å–∏—Ç–µ–ª—å–Ω—ã–π –∑–Ω–∞–∫
        has_question_mark = '?' in text_lower
        
        return has_keywords or has_question_mark

    def analyze_question_intent(self, question):
        """–°–í–ï–†–•–£–ú–ù–´–ô –∞–Ω–∞–ª–∏–∑ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞"""
        question_lower = question.lower()
        
        print(f"üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏–Ω—Ç–µ–Ω—Ç –¥–ª—è: {question_lower}")
        
        # –õ–Æ–ë–û–í–¨ - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
        if any(word in question_lower for word in ['–ª—é–±–æ–≤', '–æ—Ç–Ω–æ—à–µ–Ω', '—á—É–≤—Å—Ç–≤–∞', '–≤—Å—Ç—Ä–µ—á', '–ø–∞—Ä–µ–Ω—å', '–≤—Å—Ç—Ä–µ—á—É', '–±—Ä–∞–∫', '–∑–∞–º—É–∂–µ—Å—Ç–≤–æ']):
            if '–¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞' in question_lower:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: LOVE_YEAR_END")
                return "LOVE_YEAR_END"
            elif '–¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è' in question_lower or '–≤ –Ω–æ—è–±—Ä–µ' in question_lower:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: LOVE_NOVEMBER")
                return "LOVE_NOVEMBER"
            else:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: LOVE_GENERAL")
                return "LOVE_GENERAL"
        
        # –§–ò–ù–ê–ù–°–´
        elif any(word in question_lower for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥', '–∑–∞—Ä–∞–±–æ—Ç', '–¥–æ—Ö–æ–¥']):
            if any(word in question_lower for word in ['–ø–µ—Ä–µ–µ–∑–¥', '—É–µ—Ö–∞—Ç—å', '–≥–æ—Ä–æ–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤']):
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: MONEY_FOR_TRAVEL")
                return "MONEY_FOR_TRAVEL"
            else:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: MONEY_GENERAL")
                return "MONEY_GENERAL"
        
        # –ö–ê–†–¨–ï–†–ê
        elif any(word in question_lower for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä', '–ø—Ä–æ—Ñ–µ—Å—Å–∏', '–¥–æ–ª–∂–Ω–æ—Å—Ç']):
            print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: CAREER")
            return "CAREER"
        
        # –ó–î–û–†–û–í–¨–ï
        elif any(word in question_lower for word in ['–∑–¥–æ—Ä–æ–≤', '–±–æ–ª–µ–∑']):
            print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: HEALTH")
            return "HEALTH"
        
        # –û–ë–©–ò–ô –≤–æ–ø—Ä–æ—Å
        else:
            print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: GENERAL")
            return "GENERAL"

    def generate_smart_response(self, text, user_id):
        """–£–ú–ù–´–ô –æ—Ç–≤–µ—Ç –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç —Ç–∏–ø–∞ —Å–æ–æ–±—â–µ–Ω–∏—è"""
        
        # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –ø–æ–º–æ—â—å
        if self.is_greeting_or_command(text):
            return "help", None
        
        # –ï—Å–ª–∏ —ç—Ç–æ –∑–∞–ø—Ä–æ—Å –Ω–∞ –ª–∏—á–Ω–æ–µ - –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –æ—Ç–¥–µ–ª—å–Ω–æ
        elif self.is_private_request(text):
            return "private", text
        
        # –ï—Å–ª–∏ —ç—Ç–æ –Ω–µ –≤–æ–ø—Ä–æ—Å - –ø—Ä–æ—Å–∏–º –∑–∞–¥–∞—Ç—å –≤–æ–ø—Ä–æ—Å
        elif not self.is_real_question(text):
            return "not_question", None
        
        # –ï—Å–ª–∏ —ç—Ç–æ –Ω–∞—Å—Ç–æ—è—â–∏–π –≤–æ–ø—Ä–æ—Å - –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º
        else:
            intent = self.analyze_question_intent(text)
            analysis, strategy = self._generate_deep_analysis(text, intent)
            return "analysis", (analysis, strategy)

    def _generate_deep_analysis(self, question, intent):
        """–ì–ï–ù–ï–†–ò–†–£–ï–ú –ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        if intent == "LOVE_NOVEMBER":
            return self._deep_love_november(question, time_str)
        elif intent == "LOVE_YEAR_END":
            return self._deep_love_yearend(question, time_str)
        elif intent == "LOVE_GENERAL":
            return self._deep_love_general(question, time_str)
        elif intent == "MONEY_FOR_TRAVEL":
            return self._deep_money_travel(question, time_str)
        elif intent == "MONEY_GENERAL":
            return self._deep_money_general(question, time_str)
        elif intent == "CAREER":
            return self._deep_career_analysis(question, time_str)
        else:
            return self._deep_general_analysis(question, time_str)

    def _deep_love_november(self, question, time_str):
        """–ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è"""
        analysis = f"""
*üíñ –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò –î–û –ö–û–ù–¶–ê –ù–û–Ø–ë–†–Ø*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å —Å–µ—Ä–¥—Ü–∞:* ¬´{question}¬ª

---

*üåô –ù–û–Ø–ë–†–¨–°–ö–ò–ï –ó–í–ï–ó–î–ù–´–ï –í–õ–ò–Ø–ù–ò–Ø:*

‚ú® *–ü–ï–†–í–ê–Ø –î–ï–ö–ê–î–ê (1-10 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
‚Ä¢ *–ì–∞—Ä–º–æ–Ω–∏—á–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã* –ø—Ä–µ–æ–±–ª–∞–¥–∞—é—Ç –Ω–∞–¥ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω—ã–º–∏

‚ú® *–í–¢–û–†–ê–Ø –î–ï–ö–ê–î–ê (11-20 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –¥–∏—Ä–µ–∫—Ç–Ω—ã–π* - —è—Å–Ω–æ—Å—Ç—å –≤ –ª—é–±–æ–≤–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–∞—Ö
‚Ä¢ *–ú–∞—Ä—Å –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç 5-–π –¥–æ–º* - —Å–º–µ–ª–æ—Å—Ç—å –≤ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–∏ —á—É–≤—Å—Ç–≤
‚Ä¢ *–Æ–ø–∏—Ç–µ—Ä —Ä–∞—Å—à–∏—Ä—è–µ—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏* –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤

‚ú® *–¢–†–ï–¢–¨–Ø –î–ï–ö–ê–î–ê (21-30 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* - –æ–ø—Ç–∏–º–∏–∑–º –∏ –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* - —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ *–°–∞—Ç—É—Ä–Ω –¥–∞–µ—Ç —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å* —Å–µ—Ä—å–µ–∑–Ω—ã–º –æ—Ç–Ω–æ—à–µ–Ω–∏—è–º

---

*üîÆ –í–ï–†–û–Ø–¢–ù–´–ï –°–û–ë–´–¢–ò–Ø:*

*–î–ª—è –æ–¥–∏–Ω–æ–∫–∏—Ö:*
‚Ä¢ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º —á–µ—Ä–µ–∑ –¥—Ä—É–∑–µ–π (85%)
‚Ä¢ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏–µ –≤ –Ω–µ–æ–±—ã—á–Ω–æ–º –º–µ—Å—Ç–µ (70%)
‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ (90%)

*–î–ª—è –≤—Å—Ç—Ä–µ—á–∞—é—â–∏—Ö—Å—è:*
‚Ä¢ –ü–µ—Ä–µ—Ö–æ–¥ –æ—Ç–Ω–æ—à–µ–Ω–∏–π –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å (80%)
‚Ä¢ –í–∞–∂–Ω—ã–µ –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏—è –æ —á—É–≤—Å—Ç–≤–∞—Ö (95%)
‚Ä¢ –°–æ–≤–º–µ—Å—Ç–Ω—ã–µ –ø–ª–∞–Ω—ã –Ω–∞ –±—É–¥—É—â–µ–µ (75%)
"""
        
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –î–õ–Ø –õ–Æ–ë–í–ò –í –ù–û–Ø–ë–†–ï:*

*üíù –î–õ–Ø –ü–†–ò–í–õ–ï–ß–ï–ù–ò–Ø –õ–Æ–ë–í–ò:*
‚Ä¢ –ü–æ—Å–µ—â–∞–π—Ç–µ –∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è –∏ –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
‚Ä¢ –ù–æ—Å–∏—Ç–µ —Ä–æ–∑–æ–≤—ã–π –∫–≤–∞—Ä—Ü –¥–ª—è —É—Å–∏–ª–µ–Ω–∏—è –ª—é–±–æ–≤–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏: ¬´–Ø –¥–æ—Å—Ç–æ–π–Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–π –ª—é–±–≤–∏¬ª

*üîÑ –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–Ø –û–¢–ù–û–®–ï–ù–ò–ô:*
‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ 3 –ø–æ–≤–æ–¥–∞ –¥–ª—è –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—É
‚Ä¢ –°–æ–≤–º–µ—Å—Ç–Ω–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è –ø–æ –≤—Ç–æ—Ä–Ω–∏–∫–∞–º –∏ –ø—è—Ç–Ω–∏—Ü–∞–º
‚Ä¢ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω –ø—Ä–∏ —Å–≤–µ—á–∞—Ö 18 –Ω–æ—è–±—Ä—è

*üåü –û–°–û–ë–´–ï –î–ê–¢–´ –ù–û–Ø–ë–†–Ø:*
‚Ä¢ *7-10 –Ω–æ—è–±—Ä—è:* –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤
‚Ä¢ *15-18 –Ω–æ—è–±—Ä—è:* –ü–µ—Ä–∏–æ–¥ –≥–ª—É–±–æ–∫–∏—Ö —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–π
‚Ä¢ *22-25 –Ω–æ—è–±—Ä—è:* –í—Ä–µ–º—è –¥–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö —Ä–∞–∑–≥–æ–≤–æ—Ä–æ–≤
‚Ä¢ *28-30 –Ω–æ—è–±—Ä—è:* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã—Ö –≤—Å—Ç—Ä–µ—á"""

        return analysis, strategy

    def _get_help_response(self, chat_type):
        """–û—Ç–≤–µ—Ç-–ø–æ–º–æ—â—å"""
        if chat_type == "private":
            return f"""üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ò—Å–∫–∞—Ç–µ–ª—å!*

*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ:*
‚Ä¢ üíñ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å–∞—Ö –∏ –∏–∑–æ–±–∏–ª–∏–∏  
‚Ä¢ üíº –ö–∞—Ä—å–µ—Ä–µ –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏
‚Ä¢ üåå –ë—É–¥—É—â–µ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö

*–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:*
‚Ä¢ ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è?¬ª
‚Ä¢ ¬´–ë—É–¥—É—Ç –ª–∏ —É –º–µ–Ω—è –¥–µ–Ω—å–≥–∏ –¥–ª—è –ø–µ—Ä–µ–µ–∑–¥–∞?¬ª
‚Ä¢ ¬´–ö–∞–∫–æ–µ –º–æ–µ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ?¬ª

*–ò–ª–∏ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏*"""
        else:
            return f"""üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é –≤—Å–µ—Ö!*

üí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å*
üîí *–ò–ª–∏ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏*

*–ü—Ä–∏–º–µ—Ä—ã:*
‚Ä¢ ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏?¬ª
‚Ä¢ ¬´–õ–∏—á–Ω–æ–µ –ö–æ–≥–¥–∞ —è –≤—Å—Ç—Ä–µ—á—É —Å–≤–æ—é —Å—É–¥—å–±—É?¬ª
‚Ä¢ ¬´–ë—É–¥—É—Ç –ª–∏ —É –º–µ–Ω—è –¥–µ–Ω—å–≥–∏?¬ª"""

    def _get_not_question_response(self, chat_type):
        """–û—Ç–≤–µ—Ç –∫–æ–≥–¥–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –≤–æ–ø—Ä–æ—Å–æ–º"""
        if chat_type == "private":
            return """ü§î *–Ø –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å...*

*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ:*
‚Ä¢ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ –§–∏–Ω–∞–Ω—Å–∞—Ö –∏ –¥–µ–Ω—å–≥–∞—Ö
‚Ä¢ –ö–∞—Ä—å–µ—Ä–µ –∏ –±—É–¥—É—â–µ–º

*–ü—Ä–∏–º–µ—Ä:* ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏?¬ª
*–ò–ª–∏:* ¬´–ö–æ–≥–¥–∞ —è –≤—Å—Ç—Ä–µ—á—É —Å–≤–æ—é —Å—É–¥—å–±—É?¬ª"""
        else:
            return """ü§î *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ –ª—é–±–≤–∏, –¥–µ–Ω—å–≥–∞—Ö –∏–ª–∏ –±—É–¥—É—â–µ–º...*

*–ò–ª–∏ –Ω–∞–ø–∏—à–∏:* ¬´–õ–∏—á–Ω–æ–µ [—Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å]¬ª"""

# –°–æ–∑–¥–∞–µ–º –°–í–ï–†–•–£–ú–ù–û–ì–û –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞
emperor = SuperSmartEmperor()

@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    chat_type = "private" if message.chat.type == "private" else "group"
    response = emperor._get_help_response(chat_type)
    bot.reply_to(message, response, parse_mode='Markdown')

@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    try:
        user_id = message.from_user.id
        text = message.text.strip()
        chat_type = "private" if message.chat.type == "private" else "group"
        
        print(f"üß† –°–æ–æ–±—â–µ–Ω–∏–µ: '{text}'")

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –≥—Ä—É–ø–ø–µ
        if chat_type in ['group', 'supergroup'] and emperor.is_private_request(text):
            parts = text.split(' ', 1)
            if len(parts) > 1 and len(parts[1]) > 2:
                try:
                    response_type, content = emperor.generate_smart_response(parts[1], user_id)
                    
                    if response_type == "analysis":
                        analysis, strategy = content
                        private_response = f"üîí *–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó*\n\n{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}"
                    else:
                        private_response = emperor._get_help_response("private")
                    
                    bot.send_message(user_id, private_response, parse_mode='Markdown')
                    bot.reply_to(message, "‚úÖ *–û—Ç–≤–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è!*", parse_mode='Markdown')
                    return
                except Exception as e:
                    print(f"‚ùå –û—à–∏–±–∫–∞ –õ–°: {e}")
                    bot.reply_to(message, "üíå *–ù–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–°:* @HoraryEmperorBot", parse_mode='Markdown')
                    return

        # –£–ú–ù–ê–Ø –æ–±—Ä–∞–±–æ—Ç–∫–∞ –≤—Å–µ—Ö —Å–æ–æ–±—â–µ–Ω–∏–π
        response_type, content = emperor.generate_smart_response(text, user_id)
        
        if response_type == "help":
            response = emperor._get_help_response(chat_type)
        elif response_type == "not_question":
            response = emperor._get_not_question_response(chat_type)
        elif response_type == "analysis":
            analysis, strategy = content
            if chat_type == "private":
                response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}"
            else:
                response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüíå *–î–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª*"
        else:
            response = "üîÆ *–ß—Ç–æ-—Ç–æ –ø–æ—à–ª–æ –Ω–µ —Ç–∞–∫... –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!*"
        
        bot.reply_to(message, response, parse_mode='Markdown')
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        bot.reply_to(message, "üîÆ *–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—Ö–∏... –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!*", parse_mode='Markdown')

print("‚úÖ –°–í–ï–†–•–£–ú–ù–´–ô –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤!")
print("üåê Flask —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000")

def smart_launch():
    while True:
        try:
            print("üß† –ó–∞–ø—É—Å–∫–∞—é —Å–≤–µ—Ä—Ö—É–º–Ω—ã–π polling...")
            bot.polling(none_stop=True, interval=2, timeout=60)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            time.sleep(10)

if __name__ == "__main__":
    smart_launch()
