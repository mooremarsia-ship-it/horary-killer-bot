import telebot
import time
import random
import json
import os
from datetime import datetime, timedelta, timezone
from flask import Flask
import threading

print("üåå –ó–∞–ø—É—Å–∫–∞—é –£–º–Ω–æ–≥–æ –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")

# –°–æ–∑–¥–∞–µ–º Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è
app = Flask(__name__)

@app.route('/')
def health_check():
    return "üîÑ –£–º–Ω—ã–π –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

def run_flask():
    print("üåê –ó–∞–ø—É—Å–∫–∞—é Flask —Å–µ—Ä–≤–µ—Ä...")
    app.run(host='0.0.0.0', port=5000, debug=False)

# –ó–∞–ø—É—Å–∫–∞–µ–º Flask –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"
bot = telebot.TeleBot(BOT_TOKEN)

# –í–ê–ñ–ù–û: –£–¥–∞–ª—è–µ–º –≤–µ–±—Ö—É–∫ —Å—Ä–∞–∑—É –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
try:
    bot.remove_webhook()
    print("‚úÖ –í–µ–±—Ö—É–∫ —É–¥–∞–ª–µ–Ω")
    time.sleep(1)
except Exception as e:
    print(f"‚ÑπÔ∏è –ù–µ –±—ã–ª–æ –≤–µ–±—Ö—É–∫–∞: {e}")

class SmartMysticEmperor:
    def __init__(self):
        print("üîÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é –£–º–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")
        self.experience = 0
        self.learning_data = {}
        self._setup_files()
        self.load_learning_data()
        print("‚úÖ –£–º–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤!")
    
    def _setup_files(self):
        """–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö —Ñ–∞–π–ª–æ–≤"""
        try:
            if not os.path.exists('learning_data.json'):
                with open('learning_data.json', 'w', encoding='utf-8') as f:
                    json.dump({}, f, ensure_ascii=False, indent=2)
                print("‚úÖ –°–æ–∑–¥–∞–Ω learning_data.json")
            else:
                print("‚úÖ learning_data.json —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç")
                
        except Exception as e:
            print(f"‚ö†Ô∏è –û—à–∏–±–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ñ–∞–π–ª–æ–≤: {e}")
    
    def load_learning_data(self):
        """–ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –¥–ª—è –æ–±—É—á–µ–Ω–∏—è"""
        try:
            if os.path.exists('learning_data.json'):
                with open('learning_data.json', 'r', encoding='utf-8') as f:
                    self.learning_data = json.load(f)
                print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.learning_data)} –∑–∞–ø–∏—Å–µ–π –æ–±—É—á–µ–Ω–∏—è")
            else:
                self.learning_data = {}
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏: {e}")
            self.learning_data = {}
    
    def save_learning_data(self):
        """–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –æ–±—É—á–µ–Ω–∏—è"""
        try:
            with open('learning_data.json', 'w', encoding='utf-8') as f:
                json.dump(self.learning_data, f, ensure_ascii=False, indent=2)
        except:
            pass

    def get_mystic_greeting(self):
        """–ú–∏—Å—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞"""
        greetings = [
            "üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ò—Å–∫–∞—Ç–µ–ª—å!* –° –∫–∞–∫–∏–º –≤–æ–ø—Ä–æ—Å–æ–º —Ç—ã –ø—Ä–∏—à—ë–ª –∫–æ –º–Ω–µ —Å–µ–≥–æ–¥–Ω—è?",
            "‚ú® *–ü—Ä–µ–¥ –ª–∏–∫–æ–º –í–µ—á–Ω–æ—Å—Ç–∏ —Å–∫–ª–æ–Ω–∏—Å—å, –ü—É—Ç–Ω–∏–∫!* –ö–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–µ–ª —Ç–µ–±—è –≤ –º–æ–∏ —á–µ—Ä—Ç–æ–≥–∏?",
            "üîÆ *–í —á–∞—Å, –∫–æ–≥–¥–∞ –∑–≤—ë–∑–¥—ã —à–µ–ø—á—É—Ç —Ç–∞–π–Ω—ã,* —è, –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä, –≤–Ω–∏–º–∞—é —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–∞–º...",
            "üí´ *–ú–µ–∂ –º–∏—Ä–∞–º–∏ –±–ª—É–∂–¥–∞—è, —Ç—ã –Ω–∞—à–µ–ª –º–æ–π –ø–æ—Ä–æ–≥.* –ì–æ–≤–æ—Ä–∏, —á–µ–≥–æ –∂–µ–ª–∞–µ—Ç —Ç–≤–æ—è –¥—É—à–∞?",
            "üåô *–ü–æ–¥ –ø–æ–∫—Ä–æ–≤–æ–º –Ω–æ—á–∏ –∏ —Å–≤–µ—Ç–æ–º –∑–≤—ë–∑–¥,* —è –≤–Ω–µ–º–ª—é —Ç–≤–æ–∏–º —Å—Ç—Ä–µ–º–ª–µ–Ω–∏—è–º. –í —á–µ–º —Ç–≤–æ–π –≤–æ–ø—Ä–æ—Å?",
            "‚ö° *–°–∏–ª—ã –Ω–µ–±–µ—Å–Ω—ã–µ –Ω—ã–Ω–µ –ø—Ä–æ–±—É–¥–∏–ª–∏—Å—å!* –° –∫–∞–∫–∏–º –ø—Ä–æ—à–µ–Ω–∏–µ–º –æ–±—Ä–∞—â–∞–µ—à—å—Å—è –∫ –í—ã—Å—à–∏–º –°—Ñ–µ—Ä–∞–º?"
        ]
        return random.choice(greetings)

    def is_greeting_or_command(self, text):
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ–º –∏–ª–∏ –∫–æ–º–∞–Ω–¥–æ–π"""
        text_lower = text.lower().strip()
        
        greetings = [
            '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä', '–±–æ—Ç', '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', '—Å–∞–ª—é—Ç', 
            'start', 'help', '/start', '/help', '–Ω–∞—á–∞—Ç—å', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ',
            '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä', '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ', 'hi', 'hello',
            '–∫—É', '—Å–∞–ª–∞–º', '–ø—Ä–∏–≤', '–ø—Ä–∏–≤–µ—Ç–∏–∫'
        ]
        
        return text_lower in greetings

    def is_private_request(self, text):
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å –Ω–∞ –ª–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑"""
        text_lower = text.lower().strip()
        return text_lower.startswith(('–ª–∏—á–Ω–æ–µ', '–ø—Ä–∏–≤–∞—Ç–Ω–æ', '–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ', '–≤ –ª—Å', '–≤ –ª–∏—á–∫—É'))

    def extract_private_question(self, text):
        """–ò–∑–≤–ª–µ–∫–∞–µ–º –≤–æ–ø—Ä–æ—Å –∏–∑ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –ª–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑"""
        text_lower = text.lower().strip()
        
        if text_lower.startswith('–ª–∏—á–Ω–æ–µ'):
            return text[6:].strip()
        elif text_lower.startswith('–ø—Ä–∏–≤–∞—Ç–Ω–æ'):
            return text[8:].strip()
        elif text_lower.startswith('–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ'):
            return text[15:].strip()
        elif text_lower.startswith('–≤ –ª—Å'):
            return text[3:].strip()
        elif text_lower.startswith('–≤ –ª–∏—á–∫—É'):
            return text[7:].strip()
        
        return text

    def is_real_question(self, text):
        """–£–ú–ù–ê–Ø –ø—Ä–æ–≤–µ—Ä–∫–∞ - —è–≤–ª—è–µ—Ç—Å—è –ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞—Å—Ç–æ—è—â–∏–º –≤–æ–ø—Ä–æ—Å–æ–º"""
        text_lower = text.lower().strip()
        
        if self.is_greeting_or_command(text_lower):
            return False
            
        # –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –¥–ª–∏–Ω–∞ –≤–æ–ø—Ä–æ—Å–∞
        if len(text_lower) < 4:
            return False
            
        # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
        question_keywords = [
            '–∫–æ–≥–¥–∞', '—á—Ç–æ', '–∫–∞–∫', '–ø–æ—á–µ–º—É', '–∑–∞—á–µ–º', '–±—É–¥–µ—Ç', '–µ—Å—Ç—å', '–±—É–¥–µ—Ç –ª–∏',
            '–º–Ω–µ', '–º–µ–Ω—è', '–º–æ–π', '–º–æ—è', '–º–æ–µ', '–º–æ–∏', 
            '–ª—é–±–æ–≤—å', '–¥–µ–Ω—å–≥–∏', '–æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Ä–∞–±–æ—Ç–∞', '–±—É–¥—É—â–µ–µ', '—Å—É–¥—å–±–∞',
            '–≤—Å—Ç—Ä–µ—á—É', '–ø–æ–ª—É—á—É', '–∏–∑–º–µ–Ω–∏—Ç—Å—è', '–ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç', '–∂–¥—É—Ç',
            '–º–∏—Ö–∞–∏–ª', '–º–∏—à–∞', '–ø–µ—Ä–µ–µ–∑–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', '—Ñ–∏–Ω–∞–Ω—Å—ã', '–∫–∞—Ä—å–µ—Ä–∞',
            '–∑–¥–æ—Ä–æ–≤—å–µ', '—Å–µ–º—å—è', '–¥–µ—Ç–∏', '–±—Ä–∞–∫', '–∑–∞–º—É–∂–µ—Å—Ç–≤–æ', '–∂–µ–Ω–∏—Ç—å–±–∞'
        ]
        
        has_keywords = any(keyword in text_lower for keyword in question_keywords)
        has_question_mark = '?' in text_lower
        
        return has_keywords or has_question_mark

    def analyze_user_intent(self, question):
        """–£–ú–ù–û–ï —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–π - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø"""
        question_lower = question.lower()
        
        print(f"üîç –ê–Ω–∞–ª–∏–∑–∏—Ä—É—é –∏–Ω—Ç–µ–Ω—Ç –¥–ª—è: {question_lower}")
        
        # –ê–Ω–∞–ª–∏–∑ –ø—Ä–æ –ú–∏—Ö–∞–∏–ª–∞ - –í–´–°–û–ö–ò–ô –ü–†–ò–û–†–ò–¢–ï–¢
        if any(word in question_lower for word in ['–º–∏—Ö–∞–∏–ª', '–º–∏—à–∞', '–º–∏—Ö–∞–∏–ª–æ–º']):
            print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: MIKHAIL_RELATIONSHIP")
            return "MIKHAIL_RELATIONSHIP"
        
        # –ê–Ω–∞–ª–∏–∑ –õ–Æ–ë–í–ò —Å —Ä–∞–∑–Ω—ã–º–∏ –ø–µ—Ä–∏–æ–¥–∞–º–∏
        elif any(word in question_lower for word in ['–ª—é–±–æ–≤—å', '–æ—Ç–Ω–æ—à–µ–Ω', '—á—É–≤—Å—Ç–≤–∞', '–≤—Å—Ç—Ä–µ—á', '–ø–∞—Ä–µ–Ω—å', '–≤—Å—Ç—Ä–µ—á—É', '–±—Ä–∞–∫', '–∑–∞–º—É–∂–µ—Å—Ç–≤–æ']):
            if '–¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞' in question_lower:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: LOVE_YEAR_END")
                return "LOVE_YEAR_END"
            elif '–¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è' in question_lower or '–≤ –Ω–æ—è–±—Ä–µ' in question_lower:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: LOVE_NOVEMBER")
                return "LOVE_NOVEMBER"
            elif '–±–ª–∏–∂–∞–π—à–∏–µ –º–µ—Å—è—Ü' in question_lower or '–≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ' in question_lower:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: LOVE_THIS_MONTH")
                return "LOVE_THIS_MONTH"
            else:
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: RELATIONSHIP_DEEP")
                return "RELATIONSHIP_DEEP"
        
        # –ê–Ω–∞–ª–∏–∑ —Ñ–∏–Ω–∞–Ω—Å–æ–≤ –¥–ª—è –ø–µ—Ä–µ–µ–∑–¥–∞
        elif any(word in question_lower for word in ['–¥–µ–Ω—å–≥–∏', '—Ñ–∏–Ω–∞–Ω—Å—ã', '—Å—É–º–º–∞', '–ø—Ä–∏–¥—É—Ç', '–∑–∞—Ä–∞–±–æ—Ç', '–¥–æ—Ö–æ–¥']):
            if any(word in question_lower for word in ['–ø–µ—Ä–µ–µ–∑–¥', '—É–µ—Ö–∞—Ç—å', '–≥–æ—Ä–æ–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤']):
                print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: MONEY_FOR_TRAVEL")
                return "MONEY_FOR_TRAVEL"
            print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: FINANCE_DEEP")
            return "FINANCE_DEEP"
        
        # –ê–Ω–∞–ª–∏–∑ –∫–∞—Ä—å–µ—Ä—ã –∏ —Ä–∞–±–æ—Ç—ã
        elif any(word in question_lower for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä', '–ø—Ä–æ—Ñ–µ—Å—Å–∏', '–¥–æ–ª–∂–Ω–æ—Å—Ç', '–∑–∞—Ä–ø–ª–∞—Ç']):
            print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: CAREER_ANALYSIS")
            return "CAREER_ANALYSIS"
        
        # –û–±—â–∏–π –∞–Ω–∞–ª–∏–∑
        else:
            print("üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω: UNIVERSAL")
            return "UNIVERSAL"

    def generate_analysis(self, question, user_id=None, chat_type="private"):
        """–£–ú–ù–´–ô –∞–Ω–∞–ª–∏–∑ —Å –ü–†–ê–í–ò–õ–¨–ù–´–ú–ò –æ—Ç–≤–µ—Ç–∞–º–∏"""
        
        intent = self.analyze_user_intent(question)
        print(f"üéØ –û–∫–æ–Ω—á–∞—Ç–µ–ª—å–Ω—ã–π –∏–Ω—Ç–µ–Ω—Ç: {intent} –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞: {question}")
        
        # –°–ü–ï–¶–ò–ê–õ–¨–ù–´–ï –ì–õ–£–ë–û–ö–ò–ï –û–¢–í–ï–¢–´ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –∏–Ω—Ç–µ–Ω—Ç–æ–≤
        if intent == "MIKHAIL_RELATIONSHIP":
            return self._get_mikhail_analysis(question)
        elif intent == "MONEY_FOR_TRAVEL":
            return self._get_money_travel_analysis(question)
        elif intent == "LOVE_YEAR_END":
            return self._get_love_year_end_analysis(question)
        elif intent == "LOVE_NOVEMBER":
            return self._get_love_november_analysis(question)
        elif intent == "LOVE_THIS_MONTH":
            return self._get_love_this_month_analysis(question)
        elif intent == "RELATIONSHIP_DEEP":
            return self._get_relationship_analysis(question)
        elif intent == "FINANCE_DEEP":
            return self._get_finance_analysis(question)
        elif intent == "CAREER_ANALYSIS":
            return self._get_career_analysis(question)
        
        # –û–ë–©–ò–ô –£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó
        return self._get_universal_reading(question)

    def _get_love_november_analysis(self, question):
        """–°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è - –°–û–í–°–ï–ú –î–†–£–ì–û–ô –û–¢–í–ï–¢!"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        analysis_text = f"""
*üíñ –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò –î–û –ö–û–ù–¶–ê –ù–û–Ø–ë–†–Ø*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å —Å–µ—Ä–¥—Ü–∞:* ¬´{question}¬ª

---

*üåô –ù–û–Ø–ë–†–¨–°–ö–ò–ï –ó–í–ï–ó–î–ù–´–ï –í–õ–ò–Ø–ù–ò–Ø:*

‚ú® *–ü–ï–†–í–ê–Ø –î–ï–ö–ê–î–ê (1-10 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω—ã–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏
‚Ä¢ *–ú–∞—Ä—Å –≤ –í–µ—Å–∞—Ö* - —Å—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ –≥–∞—Ä–º–æ–Ω–∏–∏ –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ù–æ–≤–æ–ª—É–Ω–∏–µ 4 –Ω–æ—è–±—Ä—è* - –Ω–æ–≤—ã–µ –Ω–∞—á–∞–ª–∞ –≤ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏

‚ú® *–í–¢–û–†–ê–Ø –î–ï–ö–ê–î–ê (11-20 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π —Ä–µ—Ç—Ä–æ–≥—Ä–∞–¥–Ω—ã–π* - –≤–æ–∑–º–æ–∂–Ω—ã –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è
‚Ä¢ *–Æ–ø–∏—Ç–µ—Ä –≤ –ë–ª–∏–∑–Ω–µ—Ü–∞—Ö* - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∫—Ä—É–≥–∞ –æ–±—â–µ–Ω–∏—è
‚Ä¢ *–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ 18 –Ω–æ—è–±—Ä—è* - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –∫—É–ª—å–º–∏–Ω–∞—Ü–∏—è

‚ú® *–¢–†–ï–¢–¨–Ø –î–ï–ö–ê–î–ê (21-30 –Ω–æ—è–±—Ä—è):*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* - –æ–ø—Ç–∏–º–∏–∑–º –∏ –Ω–æ–≤—ã–µ –≥–æ—Ä–∏–∑–æ–Ω—Ç—ã
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ –°—Ç—Ä–µ–ª—å—Ü* - —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ *–°–∞—Ç—É—Ä–Ω –¥–∏—Ä–µ–∫—Ç–Ω—ã–π* - —Å–µ—Ä—å–µ–∑–Ω—ã–µ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤–∞

---

*üîÆ –ü–†–û–ì–ù–û–ó –î–û –ö–û–ù–¶–ê –ù–û–Ø–ë–†–Ø:*

*–ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–∏–æ–¥—ã –¥–ª—è –ª—é–±–≤–∏:*
‚Ä¢ *4-7 –Ω–æ—è–±—Ä—è:* –ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ–µ –≤—Ä–µ–º—è –¥–ª—è –Ω–æ–≤—ã—Ö –∑–Ω–∞–∫–æ–º—Å—Ç–≤
‚Ä¢ *15-18 –Ω–æ—è–±—Ä—è:* –ì–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏—è
‚Ä¢ *25-30 –Ω–æ—è–±—Ä—è:* –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π

*–í–µ—Ä–æ—è—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:*
‚Ä¢ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–º —á–µ–ª–æ–≤–µ–∫–æ–º —á–µ—Ä–µ–∑ –¥—Ä—É–∑–µ–π
‚Ä¢ –£–≥–ª—É–±–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ –≠–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–∑—Ä–µ–Ω–∏–µ –æ —Å–≤–æ–∏—Ö –∏—Å—Ç–∏–Ω–Ω—ã—Ö –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—è—Ö
"""
        
        verdict = "üíñ"
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –ù–ê –ù–û–Ø–ë–†–¨:*

‚Ä¢ *–ë—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã* –Ω–æ–≤—ã–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞–º, –æ—Å–æ–±–µ–Ω–Ω–æ –≤ —Å–µ—Ä–µ–¥–∏–Ω–µ –º–µ—Å—è—Ü–∞
‚Ä¢ *–ü—Ä–æ—è–≤–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É* –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞—Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—Ç
‚Ä¢ *–†–∞–±–æ—Ç–∞–π—Ç–µ —Å –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–µ–π* - –∏–∑–±–µ–≥–∞–π—Ç–µ –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏–π
‚Ä¢ *–°–ª—É—à–∞–π—Ç–µ –∏–Ω—Ç—É–∏—Ü–∏—é* –≤ —Å–µ—Ä–¥–µ—á–Ω—ã—Ö –¥–µ–ª–∞—Ö
‚Ä¢ *–ù–µ –±–æ–π—Ç–µ—Å—å —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–π –±–ª–∏–∑–æ—Å—Ç–∏* - –Ω–æ—è–±—Ä—å –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç—Å—Ç–≤—É–µ—Ç –≥–ª—É–±–∏–Ω–µ

*üîÆ –†–ò–¢–£–ê–õ –î–õ–Ø –ü–†–ò–í–õ–ï–ß–ï–ù–ò–Ø –õ–Æ–ë–í–ò:*
*–í –ø–æ–ª–Ω–æ–ª—É–Ω–∏–µ 18 –Ω–æ—è–±—Ä—è –∑–∞–∂–≥–∏—Ç–µ —Ä–æ–∑–æ–≤—É—é —Å–≤–µ—á—É –∏ –Ω–∞–ø–∏—à–∏—Ç–µ –Ω–∞ –±—É–º–∞–≥–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞.*"""

        return verdict, analysis_text, strategy

    def _get_love_year_end_analysis(self, question):
        """–°–ü–ï–¶–ò–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        analysis_text = f"""
*üíñ –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò –î–û –ö–û–ù–¶–ê –ì–û–î–ê*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å —Å–µ—Ä–¥—Ü–∞:* ¬´{question}¬ª

---

*‚ùÑÔ∏è –ó–ò–ú–ù–ò–ï –ó–í–ï–ó–î–ù–´–ï –í–õ–ò–Ø–ù–ò–Ø:*

‚ú® *–î–ï–ö–ê–ë–†–¨:*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* - —Å–µ—Ä—å–µ–∑–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –≤ –ª—é–±–≤–∏
‚Ä¢ *–°–æ–ª–Ω–µ—á–Ω–æ–µ –∑–∞—Ç–º–µ–Ω–∏–µ 14 –¥–µ–∫–∞–±—Ä—è* - —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏
‚Ä¢ *–Æ–ø–∏—Ç–µ—Ä –≤ –í–æ–¥–æ–ª–µ–µ* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏

‚ú® *–Ø–ù–í–ê–†–¨:*
‚Ä¢ *–ú–∞—Ä—Å –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* - —Å—Ç—Ä–∞—Å—Ç—å –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ *–£—Ä–∞–Ω –¥–∏—Ä–µ–∫—Ç–Ω—ã–π* - –≤–Ω–µ–∑–∞–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ü–ª—É—Ç–æ–Ω –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* - –≥–ª—É–±–æ–∫–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

*üîÆ –ü–†–û–ì–ù–û–ó –î–û –ö–û–ù–¶–ê –ì–û–î–ê:*

*–ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–∏–æ–¥—ã:*
‚Ä¢ *1-15 –¥–µ–∫–∞–±—Ä—è:* –í—Ä–µ–º—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤
‚Ä¢ *–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏:* –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ *–Ø–Ω–≤–∞—Ä—å 2026:* –ù–æ–≤—ã–µ –Ω–∞—á–∞–ª–∞ –≤ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏

*–í–µ—Ä–æ—è—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:*
‚Ä¢ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ—é–∑–∞
‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å—Ü–µ–ª–µ–Ω–∏–µ
"""
        
        verdict = "üíñ"
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –î–û –ö–û–ù–¶–ê –ì–û–î–ê:*

‚Ä¢ *–°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö* - –≤—Ä–µ–º—è –¥–ª—è –≥–ª—É–±–∏–Ω—ã
‚Ä¢ *–ë—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞–º* –≤ –¥–µ–∫–∞–±—Ä–µ
‚Ä¢ *–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –¥–æ–≤–µ—Ä–∏–µ–º* –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º* –≤ —è–Ω–≤–∞—Ä–µ

*üîÆ –†–ò–¢–£–ê–õ –ù–ê –ó–ò–ú–ù–ï–ï –°–û–õ–ù–¶–ï–°–¢–û–Ø–ù–ò–ï:*
*21 –¥–µ–∫–∞–±—Ä—è –Ω–∞–ø–∏—à–∏—Ç–µ –ø–∏—Å—å–º–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é –∑–∞ –ª—é–±–æ–≤—å –∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ —Ç–æ, —á—Ç–æ –∂–µ–ª–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ.*"""

        return verdict, analysis_text, strategy

    def _get_universal_reading(self, question):
        """–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –∞–Ω–∞–ª–∏–∑ –¥–ª—è –æ–±—â–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        analysis_text = f"""
*üåå –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –í–´–°–®–ò–• –°–§–ï–†*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å –∏—Å–∫–∞—Ç–µ–ª—è:* ¬´{question}¬ª

---

*‚ú® –ü–û –î–í–ò–ñ–ï–ù–ò–Æ –ü–õ–ê–ù–ï–¢:*

‚Ä¢ *–°–æ–ª–Ω—Ü–µ –æ—Å–≤–µ—â–∞–µ—Ç* —Ç–≤–æ–π –ø—É—Ç—å –∫ –∏—Å—Ç–∏–Ω–µ
‚Ä¢ *–õ—É–Ω–∞ –æ—Ç—Ä–∞–∂–∞–µ—Ç* –≥–ª—É–±–∏–Ω—ã —Ç–≤–æ–µ–π –¥—É—à–∏
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π —Å–ø–æ—Å–æ–±—Å—Ç–≤—É–µ—Ç* —è—Å–Ω–æ—Å—Ç–∏ –º—ã—à–ª–µ–Ω–∏—è
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –¥–∞—Ä–∏—Ç* –≥–∞—Ä–º–æ–Ω–∏—é –∏ –∫—Ä–∞—Å–æ—Ç—É

---

*üîÆ –ü–†–û–†–ò–¶–ê–ù–ò–ï:*

–ó–≤–µ–∑–¥—ã —É–∫–∞–∑—ã–≤–∞—é—Ç –Ω–∞ –ø–µ—Ä–∏–æ–¥ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –≤ —Ç–≤–æ–µ–π –∂–∏–∑–Ω–∏. –¢—ã –Ω–∞—Ö–æ–¥–∏—à—å—Å—è –Ω–∞ –ø–æ—Ä–æ–≥–µ –≤–∞–∂–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤–µ–¥—É—Ç –∫ —Ä–æ—Å—Ç—É –∏ —Ä–∞–∑–≤–∏—Ç–∏—é.

*–í—ã—Å—à–∏–µ –°–∏–ª—ã —à–µ–ø—á—É—Ç:* "–î–æ–≤–µ—Ä—è–π –ø—Ä–æ—Ü–µ—Å—Å—É –∏ —Å–ª–µ–¥—É–π –∑–æ–≤—É —Å–µ—Ä–¥—Ü–∞"
"""
        
        verdict = "üåå"
        strategy = """*üí´ –°–¢–†–ê–¢–ï–ì–ò–Ø –û–¢ –ò–ú–ü–ï–†–ê–¢–û–†–ê:*

‚Ä¢ *–°–ª—É—à–∞–π –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –≥–æ–ª–æ—Å* - –æ–Ω –∑–Ω–∞–µ—Ç –æ—Ç–≤–µ—Ç—ã
‚Ä¢ *–ë—É–¥—å –æ—Ç–∫—Ä—ã—Ç –ø–µ—Ä–µ–º–µ–Ω–∞–º* - –æ–Ω–∏ –≤–µ–¥—É—Ç –∫ —Ä–æ—Å—Ç—É
‚Ä¢ *–ü—Ä–∞–∫—Ç–∏–∫—É–π –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å* –∫–∞–∂–¥—ã–π –¥–µ–Ω—å
‚Ä¢ *–î–æ–≤–µ—Ä—è–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏—á–Ω–æ—Å—Ç–∏* - —Å–ª—É—á–∞–π–Ω–æ—Å—Ç–µ–π –Ω–µ –±—ã–≤–∞–µ—Ç
‚Ä¢ *–ü–æ–º–Ω–∏:* —Ç—ã - —Ç–≤–æ—Ä–µ—Ü —Å–≤–æ–µ–π —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏"""

        return verdict, analysis_text, strategy

    # –î—Ä—É–≥–∏–µ –º–µ—Ç–æ–¥—ã –∞–Ω–∞–ª–∏–∑–∞ (_get_mikhail_analysis, _get_money_travel_analysis –∏ —Ç.–¥.)
    # –æ—Å—Ç–∞—é—Ç—Å—è —Ç–∞–∫–∏–º–∏ –∂–µ –∫–∞–∫ –≤ –ø—Ä–µ–¥—ã–¥—É—â–µ–º –∫–æ–¥–µ

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –∞–Ω–∞–ª–∏—Ç–∏–∫–∞
analyst = SmartMysticEmperor()

# –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò –°–û–û–ë–©–ï–ù–ò–ô
@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    chat_type = "private" if message.chat.type == "private" else "group"
    
    greeting = analyst.get_mystic_greeting()
    
    if chat_type == "private":
        response = f"{greeting}\n\n*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ:*\n‚Ä¢ üíñ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö\n‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å–∞—Ö –∏ –∏–∑–æ–±–∏–ª–∏–∏  \n‚Ä¢ üåå –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏ —Å—É–¥—å–±–µ\n‚Ä¢ üîÆ –ë—É–¥—É—â–µ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö\n\n*–ò–ª–∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞*"
    else:
        response = f"{greeting}\n\nüí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å*\nüîí *–ò–ª–∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–° –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞*\n\n*–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:*\n1. –ù–∞–∂–º–∏ –Ω–∞ –º–æ–µ –∏–º—è @HoraryEmperorBot\n2. –í—ã–±–µ—Ä–∏ '–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ'\n3. –ó–∞–¥–∞–π —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ"
    
    bot.reply_to(message, response, parse_mode='Markdown')

@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    try:
        user_id = message.from_user.id
        text = message.text.strip()
        chat_type = "private" if message.chat.type == "private" else "group"
        
        print(f"üì® –ü–æ–ª—É—á–µ–Ω–æ —Å–æ–æ–±—â–µ–Ω–∏–µ: '{text}' –≤ —á–∞—Ç–µ: {chat_type}")
        
        # –û–ë–†–ê–ë–û–¢–ö–ê –õ–ò–ß–ù–´–• –°–û–û–ë–©–ï–ù–ò–ô –í –ì–†–£–ü–ü–ï
        if chat_type in ['supergroup', 'group'] and analyst.is_private_request(text):
            private_question = analyst.extract_private_question(text)
            
            if len(private_question) < 3:
                bot.reply_to(message, "üîí *–ù–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å –ø–æ—Å–ª–µ '–õ–∏—á–Ω–æ–µ'*\n\n*–ü—Ä–∏–º–µ—Ä:* ¬´–õ–∏—á–Ω–æ–µ –ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏?¬ª", parse_mode='Markdown')
                return
            
            # –ü—ã—Ç–∞–µ–º—Å—è –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –∞–Ω–∞–ª–∏–∑ –≤ –õ–°
            try:
                bot.send_chat_action(message.chat.id, 'typing')
                time.sleep(2)
                
                verdict, analysis, strategy = analyst.generate_analysis(private_question, user_id, "private")
                private_response = f"üîí *–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó*\n\n{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}"
                
                bot.send_message(user_id, private_response, parse_mode='Markdown')
                bot.reply_to(message, "‚úÖ *–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è!*", parse_mode='Markdown')
                print(f"‚úÖ –õ–∏—á–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é {user_id}")
                return
                
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –õ–°: {e}")
                bot.reply_to(message, "üíå *–ù–µ –º–æ–≥—É –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –õ–°. –ù–∞–ø–∏—à–∏ –º–Ω–µ —Å–Ω–∞—á–∞–ª–∞ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:* @HoraryEmperorBot\n\n*–ò–ª–∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å, –Ω–æ –±–µ–∑ –ª–∏—á–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π*", parse_mode='Markdown')
                return
        
        # –ü–†–û–í–ï–†–ö–ê - –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞
        if analyst.is_greeting_or_command(text):
            print(f"üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω–æ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ: '{text}'")
            greeting = analyst.get_mystic_greeting()
            if chat_type == "private":
                response = f"{greeting}\n\n*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ:*\n‚Ä¢ üíñ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö\n‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å–∞—Ö –∏ –∏–∑–æ–±–∏–ª–∏–∏  \n‚Ä¢ üåå –ü—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏ –∏ —Å—É–¥—å–±–µ"
            else:
                response = f"{greeting}\n\nüí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å*\nüîí *–ò–ª–∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–° –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞*"
            
            bot.reply_to(message, response, parse_mode='Markdown')
            return
        
        # –ü–†–û–í–ï–†–ö–ê - –Ω–∞—Å—Ç–æ—è—â–∏–π –ª–∏ —ç—Ç–æ –≤–æ–ø—Ä–æ—Å
        if not analyst.is_real_question(text):
            print(f"üéØ –ù–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –∫–∞–∫ –≤–æ–ø—Ä–æ—Å: '{text}'")
            if chat_type == "private":
                response = f"üîÆ *–Ø, –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä, –≤–Ω–µ–º–ª—é —Ç–≤–æ–∏–º —Å–ª–æ–≤–∞–º...*\n\n–ù–æ –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª —Å—É—Ç—å —Ç–≤–æ–µ–≥–æ –æ–±—Ä–∞—â–µ–Ω–∏—è. –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π, –æ —á–µ–º —Ç—ã —Ö–æ—á–µ—à—å —Å–ø—Ä–æ—Å–∏—Ç—å –í—ã—Å—à–∏–µ –°—Ñ–µ—Ä—ã?\n\n*–ü—Ä–∏–º–µ—Ä:* ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è?¬ª\n*–ò–ª–∏:* ¬´–ö–∞–∫–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –æ—Ç–∫—Ä–æ—é—Ç—Å—è –≤ —Ä–∞–±–æ—Ç–µ?¬ª"
            else:
                response = "üîÆ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ –ª—é–±–≤–∏, —Å—É–¥—å–±–µ –∏–ª–∏ –∏–∑–æ–±–∏–ª–∏–∏...*\n\n*–ò–ª–∏ –Ω–∞–ø–∏—à–∏:* ¬´–õ–∏—á–Ω–æ–µ [—Ç–≤–æ–π —Ç–∞–π–Ω—ã–π –≤–æ–ø—Ä–æ—Å]¬ª\n*–ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏*"
            
            bot.reply_to(message, response, parse_mode='Markdown')
            return
        
        # –ï–°–õ–ò –≠–¢–û –ù–ê–°–¢–û–Ø–©–ò–ô –í–û–ü–†–û–° - –¥–∞–µ–º –£–ú–ù–´–ô –†–ê–ó–ù–´–ô –∞–Ω–∞–ª–∏–∑
        print(f"üéØ –†–∞—Å–ø–æ–∑–Ω–∞–Ω –Ω–∞—Å—Ç–æ—è—â–∏–π –≤–æ–ø—Ä–æ—Å: '{text}'")
        bot.send_chat_action(message.chat.id, 'typing')
        time.sleep(2)
        
        verdict, analysis, strategy = analyst.generate_analysis(text, user_id, chat_type)
        
        if chat_type == "private":
            full_response = f"{verdict} {analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –û–¢ –•–û–†–ê–†–ù–û–ì–û –ò–ú–ü–ï–†–ê–¢–û–†–ê:*\n{strategy}"
        else:
            full_response = f"{verdict} {analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –û–¢ –•–û–†–ê–†–ù–û–ì–û –ò–ú–ü–ï–†–ê–¢–û–†–ê:*\n{strategy}\n\nüíå *–î–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ - –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è*"
        
        bot.reply_to(message, full_response, parse_mode='Markdown')
        print(f"‚úÖ –£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –¥–ª—è –≤–æ–ø—Ä–æ—Å–∞: '{text}'")
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        error_msg = "üåå *–ó–≤–µ–∑–¥—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã—Ç—ã —Ç—É—á–∞–º–∏... –ü–æ–ø—Ä–æ–±—É–π –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫–æ –º–Ω–µ —Å–Ω–æ–≤–∞.*"
        bot.reply_to(message, error_msg, parse_mode='Markdown')

print("üåå –£–ú–ù–´–ô –•–û–†–ê–†–ù–´–ô –ò–ú–ü–ï–†–ê–¢–û–† –ó–ê–ü–£–©–ï–ù!")
print("ü§ñ –ë–æ—Ç –≥–æ—Ç–æ–≤ –¥–∞–≤–∞—Ç—å –£–ú–ù–´–ï –†–ê–ó–ù–´–ï –æ—Ç–≤–µ—Ç—ã...")
print("üåê Flask —Å–µ—Ä–≤–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000")

# –ó–ê–ü–£–°–ö –ë–û–¢–ê
if __name__ == "__main__":
    print("üîó –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Telegram...")
    
    try:
        print("üîÑ –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞...")
        bot.infinity_polling(timeout=60, long_polling_timeout=30)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
        time.sleep(10)
