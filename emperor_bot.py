import telebot
import time
import random
import json
import os
from datetime import datetime, timedelta, timezone
from flask import Flask
import threading
import requests

print("üåå –ó–∞–ø—É—Å–∫–∞—é –°–∞–º–æ–æ–±—É—á–∞—é—â–µ–≥–æ—Å—è –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")

# –ü—Ä–æ—Å—Ç–æ–π Flask
app = Flask(__name__)
@app.route('/')
def home():
    return "üîÑ –°–∞–º–æ–æ–±—É—á–∞—é—â–∏–π—Å—è –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

def run_flask():
    app.run(host='0.0.0.0', port=5000, debug=False)

flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"

# –£–¥–∞–ª—è–µ–º –≤–µ–±—Ö—É–∫–∏ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º
try:
    response = requests.get(f"https://api.telegram.org/bot{BOT_TOKEN}/deleteWebhook")
    print("‚úÖ –í–µ–±—Ö—É–∫–∏ —É–¥–∞–ª–µ–Ω—ã")
    time.sleep(2)
except Exception as e:
    print(f"‚ÑπÔ∏è –û—à–∏–±–∫–∞ —É–¥–∞–ª–µ–Ω–∏—è –≤–µ–±—Ö—É–∫–æ–≤: {e}")

bot = telebot.TeleBot(BOT_TOKEN)

class LearningHoraryEmperor:
    def __init__(self):
        print("üîÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é —Å–∞–º–æ–æ–±—É—á–∞—é—â–µ–≥–æ—Å—è –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")
        self.learning_file = 'emperor_memory.json'
        self.load_memory()
        
    def load_memory(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞–º—è—Ç—å –±–æ—Ç–∞"""
        try:
            if os.path.exists(self.learning_file):
                with open(self.learning_file, 'r', encoding='utf-8') as f:
                    self.memory = json.load(f)
                print(f"‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.memory.get('patterns', []))} –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤")
            else:
                self.memory = {
                    'patterns': [],
                    'user_preferences': {},
                    'conversation_history': []
                }
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–∞–º—è—Ç–∏: {e}")
            self.memory = {
                'patterns': [],
                'user_preferences': {},
                'conversation_history': []
            }
    
    def save_memory(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞–º—è—Ç—å –±–æ—Ç–∞"""
        try:
            with open(self.learning_file, 'w', encoding='utf-8') as f:
                json.dump(self.memory, f, ensure_ascii=False, indent=2)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏: {e}")
    
    def learn_from_interaction(self, question, response, user_id):
        """–£—á–∏–º—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏"""
        pattern = {
            'question': question.lower(),
            'response_type': response['type'],
            'timestamp': datetime.now().isoformat(),
            'user_id': user_id
        }
        
        self.memory['patterns'].append(pattern)
        # –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 1000 –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
        if len(self.memory['patterns']) > 1000:
            self.memory['patterns'] = self.memory['patterns'][-1000:]
        
        self.save_memory()
        print(f"üß† –í—ã—É—á–∏–ª –Ω–æ–≤—ã–π –ø–∞—Ç—Ç–µ—Ä–Ω: {question[:50]}...")

    def get_greeting(self):
        return random.choice([
            "üåå *–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –ò—Å–∫–∞—Ç–µ–ª—å!* –Ø - –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä, –∏ —è —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å –º—É–¥—Ä–µ–µ —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!",
            "‚ú® *–ü—Ä–µ–¥ –ª–∏–∫–æ–º –í–µ—á–Ω–æ—Å—Ç–∏ —Å–∫–ª–æ–Ω–∏—Å—å!* –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å - –∏ —è –æ—Ç–∫—Ä–æ—é —Ç–∞–π–Ω—ã –∑–≤–µ–∑–¥!",
            "üîÆ *–í —á–∞—Å, –∫–æ–≥–¥–∞ –∑–≤—ë–∑–¥—ã —à–µ–ø—á—É—Ç,* —è –≤–Ω–∏–º–∞—é —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–∞–º...",
        ])

    def analyze_question_depth(self, question):
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –≥–ª—É–±–∏–Ω—É –≤–æ–ø—Ä–æ—Å–∞"""
        q = question.lower()
        words_count = len(q.split())
        
        if words_count < 3:
            return "short"
        elif words_count < 6:
            return "medium" 
        else:
            return "detailed"

    def generate_deep_analysis(self, question, question_type, depth):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        if question_type == "day":
            return self._deep_day_analysis(question, time_str, depth)
        elif question_type == "love":
            return self._deep_love_analysis(question, time_str, depth)
        elif question_type == "money":
            return self._deep_money_analysis(question, time_str, depth)
        elif question_type == "career":
            return self._deep_career_analysis(question, time_str, depth)
        else:
            return self._deep_general_analysis(question, time_str, depth)

    def _deep_day_analysis(self, question, time_str, depth):
        """–ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑ –¥–Ω—è"""
        
        analysis = f"""
*üåå –î–ï–¢–ê–õ–¨–ù–´–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –î–ù–Ø*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å:* ¬´{question}¬ª

---

*ü™ê –¢–ï–ö–£–©–ê–Ø –ü–õ–ê–ù–ï–¢–ê–†–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:*

‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* (12¬∞45') - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* (8¬∞22') - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å  
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* (5¬∞18') - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* (22¬∞10') - –≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ú–∞—Ä—Å –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* (3¬∞45') - —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å

---

*üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–°–ü–ï–ö–¢–û–í:*

*–£–¢–†–û (6:00-12:00):*
‚Ä¢ *–õ—É–Ω–∞ –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏–Ω –∫ –í–µ–Ω–µ—Ä–µ* - –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –∫–≤–∞–¥—Ä–∞—Ç –ù–µ–ø—Ç—É–Ω* - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ù–∞—á–∞–ª–æ –¥–Ω—è —Ç—Ä–µ–±—É–µ—Ç —è—Å–Ω–æ—Å—Ç–∏ –≤ –æ–±—â–µ–Ω–∏–∏

*–î–ï–ù–¨ (12:00-18:00):*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ —Å–µ–∫—Å—Ç–∏–ª—å –Æ–ø–∏—Ç–µ—Ä* - —É–¥–∞—á–∞ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–µ–ª–∞—Ö
‚Ä¢ *–ú–∞—Ä—Å —Ç—Ä–∏–Ω –£—Ä–∞–Ω* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ü–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –≤—Ä–µ–º—è –¥–ª—è —Å–º–µ–ª—ã—Ö —Ä–µ—à–µ–Ω–∏–π

*–í–ï–ß–ï–† (18:00-24:00):*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤—Ö–æ–¥–∏—Ç –≤ –æ–ø–ø–æ–∑–∏—Ü–∏—é —Å –ü–ª—É—Ç–æ–Ω–æ–º* - –≥–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
‚Ä¢ *–õ—É–Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç –ü–ª—É—Ç–æ–Ω* - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —á–µ—Ä–µ–∑ —ç–º–æ—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –í—Ä–µ–º—è –¥–ª—è –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏–∏ –∏ –≥–ª—É–±–æ–∫–∏—Ö —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π

---

*üí´ –ö–õ–Æ–ß–ï–í–´–ï –ü–ï–†–ò–û–î–´ –î–ù–Ø:*

‚ú® *–ë–õ–ê–ì–û–ü–†–ò–Ø–¢–ù–´–ï –ß–ê–°–´:*
‚Ä¢ 9:00-11:00 - —Ä–µ—à–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
‚Ä¢ 14:00-16:00 - –≤–∞–∂–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ –∏ –ø–µ—Ä–µ–≥–æ–≤–æ—Ä—ã
‚Ä¢ 19:00-21:00 - —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞

‚ö° *–°–õ–û–ñ–ù–´–ï –ü–ï–†–ò–û–î–´:*
‚Ä¢ 7:00-8:00 - –≤–æ–∑–º–æ–∂–Ω—ã –Ω–µ–¥–æ–ø–æ–Ω–∏–º–∞–Ω–∏—è
‚Ä¢ 13:00-14:00 - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –Ω–µ—Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å
‚Ä¢ 22:00-23:00 - –≤—Ä–µ–º—è —É–µ–¥–∏–Ω–µ–Ω–∏—è –∏ –æ—Ç–¥—ã—Ö–∞

---

*üåü –°–§–ï–†–´-–ü–†–ò–û–†–ò–¢–ï–¢–´ –°–ï–ì–û–î–ù–Ø:*

1. *–ü–†–û–§–ï–°–°–ò–û–ù–ê–õ–¨–ù–ê–Ø* (9/10 –±–∞–ª–ª–æ–≤) - –∑–≤–µ–∑–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∫–∞—Ä—å–µ—Ä–Ω—ã–π —Ä–æ—Å—Ç
2. *–°–û–¶–ò–ê–õ–¨–ù–ê–Ø* (7/10 –±–∞–ª–ª–æ–≤) - –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è networking
3. *–õ–ò–ß–ù–´–ï –û–¢–ù–û–®–ï–ù–ò–Ø* (6/10 –±–∞–ª–ª–æ–≤) - —Ç—Ä–µ–±—É–µ—Ç—Å—è –±–∞–ª–∞–Ω—Å
4. *–§–ò–ù–ê–ù–°–û–í–ê–Ø* (8/10 –±–∞–ª–ª–æ–≤) - —Ö–æ—Ä–æ—à–∏–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã
"""
        
        strategy = """*üéØ –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø –ù–ê –î–ï–ù–¨:*

*üåÖ –£–¢–†–ï–ù–ù–ò–ô –†–ò–¢–£–ê–õ (6:00-9:00):*
‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ —è—Å–Ω–æ—Å—Ç—å –º—ã—Å–ª–µ–π (5-10 –º–∏–Ω—É—Ç)
‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω—è —Å —É—á–µ—Ç–æ–º –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
‚Ä¢ –ó–µ–ª–µ–Ω—ã–π —á–∞–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ú–µ—Ä–∫—É—Ä–∏—è

*üèô –î–ù–ï–í–ù–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨ (9:00-18:00):*
‚Ä¢ 9:00-11:00 - —Ä–µ—à–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
‚Ä¢ 11:00-13:00 - —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –∏ –º–æ–∑–≥–æ–≤—ã–µ —à—Ç—É—Ä–º—ã
‚Ä¢ 14:00-16:00 - –≤–∞–∂–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ (–∑–≤–µ–∑–¥—ã –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç—Å—Ç–≤—É—é—Ç)
‚Ä¢ 16:00-18:00 - –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤

*üåÉ –í–ï–ß–ï–†–ù–ò–ô –û–¢–î–´–• (18:00-24:00):*
‚Ä¢ 19:00-21:00 - —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∏
‚Ä¢ 21:00-23:00 - –≤—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è –∏ –æ–±—É—á–µ–Ω–∏—è
‚Ä¢ 23:00+ - –æ—Ç–¥—ã—Ö –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ —Å–Ω—É

*üíé –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
‚Ä¢ –ù–æ—Å–∏—Ç–µ –±–∏—Ä—é–∑–æ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –ø–µ—Ä–∏–æ–¥ 13:00-14:00
‚Ä¢ –ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä–µ

*üîÆ –ú–ê–ù–¢–†–ê –î–ù–Ø:* 
¬´–Ø –ø—Ä–∏–Ω–∏–º–∞—é –ø–æ—Ç–æ–∫ –∏–∑–æ–±–∏–ª–∏—è –∏ —Å–ª–µ–¥—É—é –∑–æ–≤—É —Å–µ—Ä–¥—Ü–∞¬ª"""

        return analysis, strategy

    def _deep_love_analysis(self, question, time_str, depth):
        """–ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑ –ª—é–±–≤–∏"""
        analysis = f"""
*üíñ –î–ï–¢–ê–õ–¨–ù–´–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å:* ¬´{question}¬ª

---

*ü™ê –°–ò–ì–ù–ò–§–ò–ö–ê–¢–û–†–´ –õ–Æ–ë–í–ò:*

*üí´ –û–°–ù–û–í–ù–´–ï –°–ò–ì–ù–ò–§–ò–ö–ê–¢–û–†–´:*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* (22¬∞10') - –≥–∞—Ä–º–æ–Ω–∏—è, –∫—Ä–∞—Å–æ—Ç–∞, –ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* (8¬∞22') - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å
‚Ä¢ *5-–π –¥–æ–º* (–ª—é–±–æ–≤—å, —Ä–æ–º–∞–Ω—Ç–∏–∫–∞) - —É–ø—Ä–∞–≤–∏—Ç–µ–ª—å –í–µ–Ω–µ—Ä–∞
‚Ä¢ *7-–π –¥–æ–º* (–ø–∞—Ä—Ç–Ω–µ—Ä—Å—Ç–≤–æ) - —É–ø—Ä–∞–≤–∏—Ç–µ–ª—å –ú–∞—Ä—Å

*üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–°–ü–ï–ö–¢–û–í:*

*–ì–ê–†–ú–û–ù–ò–ß–ù–´–ï –ê–°–ü–ï–ö–¢–´:*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ —Ç—Ä–∏–Ω –Æ–ø–∏—Ç–µ—Ä* - —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª—é–±–æ–≤–Ω—ã—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
‚Ä¢ *–õ—É–Ω–∞ —Å–µ–∫—Å—Ç–∏–ª—å –í–µ–Ω–µ—Ä–∞* - —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –≥–∞—Ä–º–æ–Ω–∏—è
‚Ä¢ *–°–æ–ª–Ω—Ü–µ —Ç—Ä–∏–Ω –ù–µ–ø—Ç—É–Ω* - –¥—É—Ö–æ–≤–Ω–∞—è —Å–≤—è–∑—å –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö

*–í–´–ó–û–í–´:*
‚Ä¢ *–ú–∞—Ä—Å –∫–≤–∞–¥—Ä–∞—Ç –°–∞—Ç—É—Ä–Ω* - –≤–æ–∑–º–æ–∂–Ω—ã –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –æ–ø–ø–æ–∑–∏—Ü–∏—è –£—Ä–∞–Ω* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã

---

*üíû –õ–Æ–ë–û–í–ù–´–ï –ü–ï–†–°–ü–ï–ö–¢–ò–í–´:*

*üë§ –î–õ–Ø –û–î–ò–ù–û–ö–ò–•:*
‚Ä¢ –í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –≤—Å—Ç—Ä–µ—á–∏: 85% –≤ —Ç–µ—á–µ–Ω–∏–µ 2 –Ω–µ–¥–µ–ª—å
‚Ä¢ –ì–¥–µ –≤—Å—Ç—Ä–µ—á–∞—Ç—å: –∫—É–ª—å—Ç—É—Ä–Ω—ã–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è, –æ–±—Ä–∞–∑–æ–≤–∞—Ç–µ–ª—å–Ω—ã–µ –∫—É—Ä—Å—ã
‚Ä¢ –¢–∏–ø –ø–∞—Ä—Ç–Ω–µ—Ä–∞: –∏–Ω—Ç–µ–ª–ª–µ–∫—Ç—É–∞–ª—å–Ω—ã–π, —Å —á—É–≤—Å—Ç–≤–æ–º —é–º–æ—Ä–∞

*üíë –î–õ–Ø –í–°–¢–†–ï–ß–ê–Æ–©–ò–•–°–Ø:*
‚Ä¢ –ì–ª—É–±–∏–Ω–∞ —Å–≤—è–∑–∏: —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è –Ω–∞ 40% –≤ –±–ª–∏–∂–∞–π—à–∏–π –º–µ—Å—è—Ü
‚Ä¢ –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Ç–æ—á–∫–∏: 15-17 –Ω–æ—è–±—Ä—è (—Ç—Ä–µ–±—É–µ—Ç—Å—è —Ç–µ—Ä–ø–µ–Ω–∏–µ)
‚Ä¢ –†–∞–∑–≤–∏—Ç–∏–µ: –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –¥–æ–≤–µ—Ä–∏—è

*‚ù§Ô∏è –î–õ–Ø –°–ï–ú–ï–ô–ù–´–•:*
‚Ä¢ –ì–∞—Ä–º–æ–Ω–∏—è: 8/10 –±–∞–ª–ª–æ–≤
‚Ä¢ –†–æ–º–∞–Ω—Ç–∏–∫–∞: —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è —Å–æ–≤–º–µ—Å—Ç–Ω–æ–µ –ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ
‚Ä¢ –û–±—â–µ–Ω–∏–µ: –≤–∞–∂–Ω—ã –≥–ª—É–±–æ–∫–∏–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã –æ —á—É–≤—Å—Ç–≤–∞—Ö
"""
        
        strategy = """*üéØ –ì–õ–£–ë–û–ö–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø –î–õ–Ø –õ–Æ–ë–í–ò:*

*üíù –î–õ–Ø –ü–†–ò–í–õ–ï–ß–ï–ù–ò–Ø –õ–Æ–ë–í–ò:*
‚Ä¢ –ü–æ—Å–µ—â–∞–π—Ç–µ –º–µ—Å—Ç–∞, —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Å –∏—Å–∫—É—Å—Å—Ç–≤–æ–º –∏ –∫—É–ª—å—Ç—É—Ä–æ–π
‚Ä¢ –ù–æ—Å–∏—Ç–µ —Ä–æ–∑–æ–≤—ã–π –∫–≤–∞—Ä—Ü –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ª—é–±–æ–≤–Ω–æ–π —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ü—Ä–∞–∫—Ç–∏–∫—É–π—Ç–µ –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏: ¬´–Ø –¥–æ—Å—Ç–æ–π–Ω–∞ –Ω–∞—Å—Ç–æ—è—â–µ–π –ª—é–±–≤–∏¬ª

*üîÑ –î–õ–Ø –£–õ–£–ß–®–ï–ù–ò–Ø –û–¢–ù–û–®–ï–ù–ò–ô:*
‚Ä¢ –ï–∂–µ–¥–Ω–µ–≤–Ω–æ –Ω–∞—Ö–æ–¥–∏—Ç–µ 3 –ø–æ–≤–æ–¥–∞ –¥–ª—è –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Ç–Ω–µ—Ä—É
‚Ä¢ –°–æ–≤–º–µ—Å—Ç–Ω–∞—è –º–µ–¥–∏—Ç–∞—Ü–∏—è –ø–æ –≤—Ç–æ—Ä–Ω–∏–∫–∞–º –∏ –ø—è—Ç–Ω–∏—Ü–∞–º
‚Ä¢ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–π —É–∂–∏–Ω –ø—Ä–∏ —Å–≤–µ—á–∞—Ö –≤ –±–ª–∏–∂–∞–π—à—É—é –ø—è—Ç–Ω–∏—Ü—É

*üåü –õ–£–ù–ù–´–ï –†–ò–¢–£–ê–õ–´:*
*–ü–æ–ª–Ω–æ–ª—É–Ω–∏–µ 18 –Ω–æ—è–±—Ä—è:* 
- –ù–∞–ø–∏—à–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∫–∞—á–µ—Å—Ç–≤ –∏–¥–µ–∞–ª—å–Ω–æ–≥–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞
- –°–æ–∂–≥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –ø—Ä–æ—à–ª—ã—Ö –æ–±–∏–¥
- –ó–∞–∂–≥–∏—Ç–µ —Ä–æ–∑–æ–≤—É—é —Å–≤–µ—á—É

*üí´ –≠–ù–ï–†–ì–ï–¢–ò–ß–ï–°–ö–ò–ï –ü–†–ê–ö–¢–ò–ö–ò:*
‚Ä¢ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Å—á–∞—Å—Ç–ª–∏–≤—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –ø–µ—Ä–µ–¥ —Å–Ω–æ–º
‚Ä¢ –¢–∞–Ω—Ü—ã –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Å–µ—Ä–¥–µ—á–Ω–æ–π —á–∞–∫—Ä—ã
‚Ä¢ –ê—Ä–æ–º–∞—Ç–µ—Ä–∞–ø–∏—è —Å –º–∞—Å–ª–æ–º —Ä–æ–∑—ã –∏ –∏–ª–∞–Ω–≥-–∏–ª–∞–Ω–≥–∞

*üìÖ –ö–õ–Æ–ß–ï–í–´–ï –î–ê–¢–´:*
‚Ä¢ 15-17 –Ω–æ—è–±—Ä—è: –ø–µ—Ä–∏–æ–¥ –≥–ª—É–±–æ–∫–∏—Ö –æ—Ç–∫—Ä–æ–≤–µ–Ω–∏–π
‚Ä¢ 22-25 –Ω–æ—è–±—Ä—è: –≤—Ä–µ–º—è –¥–ª—è –Ω–æ–≤—ã—Ö –Ω–∞—á–∏–Ω–∞–Ω–∏–π
‚Ä¢ 30 –Ω–æ—è–±—Ä—è: –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å—É–¥—å–±–æ–Ω–æ—Å–Ω–æ–π –≤—Å—Ç—Ä–µ—á–∏"""

        return analysis, strategy

    def analyze_question_type(self, question):
        """–£–º–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞"""
        q = question.lower()
        
        if any(word in q for word in ['–¥–µ–Ω—å', '—Å–µ–≥–æ–¥–Ω—è', '–∑–∞–≤—Ç—Ä–∞', '–Ω–µ–¥–µ–ª—è']):
            return "day"
        elif any(word in q for word in ['–ª—é–±–æ–≤', '–æ—Ç–Ω–æ—à–µ–Ω', '—á—É–≤—Å—Ç–≤', '–ø–∞—Ä–µ–Ω—å', '–º—É–∂—á–∏–Ω', '–∂–µ–Ω—â–∏–Ω']):
            return "love"
        elif any(word in q for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥', '–±–æ–≥–∞—Ç—Å—Ç–≤']):
            return "money"
        elif any(word in q for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä', '–ø—Ä–æ—Ñ–µ—Å—Å–∏', '–±–∏–∑–Ω–µ—Å']):
            return "career"
        else:
            return "general"

# –°–æ–∑–¥–∞–µ–º —É–º–Ω–æ–≥–æ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞
emperor = LearningHoraryEmperor()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
@bot.message_handler(commands=['start', 'help', '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä'])
def send_welcome(message):
    chat_type = "private" if message.chat.type == "private" else "group"
    
    greeting = emperor.get_greeting()
    
    if chat_type == "private":
        response = f"""{greeting}

*–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–æ–º –∏ —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å –º—É–¥—Ä–µ–µ!* üß†

*–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –æ–±—â–µ–Ω–∏—è:*
üí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å* - –ø–æ–ª—É—á–∏—à—å –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑
üîí *–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ* - —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É –Ω–∞–º–∏

*–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏ –∑–∞–¥–∞–≤–∞—Ç—å –≤–æ–ø—Ä–æ—Å—ã - —è –Ω–∞—É—á—É—Å—å –ø–æ–Ω–∏–º–∞—Ç—å —Ç–µ–±—è –ª—É—á—à–µ!*"""
    else:
        response = f"""{greeting}

*–Ø —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å —É–º–Ω–µ–µ —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!* üß†

*–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–±:*
üí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å* 
üîí *–ù–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª* –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏
üë§ *–ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è* –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

*–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –õ–°:*
1. –ù–∞–∂–º–∏ –Ω–∞ –º–æ–µ –∏–º—è @HoraryEmperorBot  
2. –í—ã–±–µ—Ä–∏ ¬´–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª
3. –ó–∞–¥–∞–π –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å - —è –Ω–∞—É—á—É—Å—å –ø–æ–Ω–∏–º–∞—Ç—å —Ç–µ–±—è –ª—É—á—à–µ!"""

    bot.reply_to(message, response, parse_mode='Markdown')

@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    try:
        user_id = message.from_user.id
        text = message.text.strip()
        chat_type = "private" if message.chat.type == "private" else "group"
        
        print(f"üì® –í–æ–ø—Ä–æ—Å –æ—Ç {user_id}: {text}")

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤ –≥—Ä—É–ø–ø–µ
        if chat_type in ['group', 'supergroup'] and text.lower().startswith('–ª–∏—á–Ω–æ–µ'):
            parts = text.split(' ', 1)
            if len(parts) > 1 and len(parts[1]) > 2:
                try:
                    question_type = emperor.analyze_question_type(parts[1])
                    depth = emperor.analyze_question_depth(parts[1])
                    analysis, strategy = emperor.generate_deep_analysis(parts[1], question_type, depth)
                    
                    # –£—á–∏–º—Å—è –Ω–∞ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ
                    emperor.learn_from_interaction(parts[1], {'type': question_type}, user_id)
                    
                    private_response = f"üîí *–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–´–ô –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó*\n\n{analysis}\n\n*üéØ –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}"
                    
                    bot.send_message(user_id, private_response, parse_mode='Markdown')
                    bot.reply_to(message, "‚úÖ *–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è!* üß†", parse_mode='Markdown')
                    return
                except Exception as e:
                    print(f"‚ùå –û—à–∏–±–∫–∞ –õ–°: {e}")
                    bot.reply_to(message, "üíå *–ù–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–°:* @HoraryEmperorBot\n*–Ø —Ç–∞–º —Å—Ç–∞–Ω—É –µ—â–µ —É–º–Ω–µ–µ!* üß†", parse_mode='Markdown')
                    return

        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        if text.lower() in ['–ø—Ä–∏–≤–µ—Ç', '–Ω–∞—á–∞—Ç—å', '–±–æ—Ç', '—Ö–æ—Ä–∞—Ä–Ω—ã–π']:
            greeting = emperor.get_greeting()
            response = f"{greeting}\n\n–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å - –∏ —è –¥–∞–º —Ç–µ–±–µ –ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑! üß†"
            bot.reply_to(message, response, parse_mode='Markdown')
            return

        # –û–±—ã—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã —Å –ì–õ–£–ë–û–ö–ò–ú –∞–Ω–∞–ª–∏–∑–æ–º
        time.sleep(1)
        
        question_type = emperor.analyze_question_type(text)
        depth = emperor.analyze_question_depth(text)
        analysis, strategy = emperor.generate_deep_analysis(text, question_type, depth)
        
        # –£—á–∏–º—Å—è –Ω–∞ —ç—Ç–æ–º –≤–æ–ø—Ä–æ—Å–µ
        emperor.learn_from_interaction(text, {'type': question_type}, user_id)
        
        if chat_type == "private":
            full_response = f"{analysis}\n\n*üéØ –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüß† *–Ø —Å—Ç–∞–ª –Ω–µ–º–Ω–æ–≥–æ —É–º–Ω–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–≤–æ–µ–º—É –≤–æ–ø—Ä–æ—Å—É!*"
        else:
            full_response = f"{analysis}\n\n*üéØ –î–ï–¢–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüíå *–î–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏: ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª*\nüß† *–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!*"
        
        bot.reply_to(message, full_response, parse_mode='Markdown')
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        bot.reply_to(message, "üîÆ *–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—Ö–∏... –ù–æ —è —É—á—É—Å—å –Ω–∞ –æ—à–∏–±–∫–∞—Ö!* üß†", parse_mode='Markdown')

print("‚úÖ –°–∞–º–æ–æ–±—É—á–∞—é—â–∏–π—Å—è –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤!")
print("üåê Flask —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000")

def run_bot():
    while True:
        try:
            print("üîó –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Telegram...")
            bot.infinity_polling(timeout=60, long_polling_timeout=30)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            print("üîÑ –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
            time.sleep(10)

if __name__ == "__main__":
    run_bot()
