import telebot
import time
import random
import json
import os
from datetime import datetime, timedelta, timezone
from flask import Flask
import threading

print("üåå –ó–∞–ø—É—Å–∫–∞—é –°–û–í–ï–†–®–ï–ù–ù–û–ì–û –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")

BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"
bot = telebot.TeleBot(BOT_TOKEN)

app = Flask(__name__)
@app.route('/')
def home():
    return "üí´ –°–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

def run_flask():
    app.run(host='0.0.0.0', port=5000, debug=False)

flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

class PerfectEmperor:
    def __init__(self):
        print("üîÆ –°–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
        self.memory_file = 'perfect_memory.json'
        self.load_memory()
    
    def load_memory(self):
        try:
            if os.path.exists(self.memory_file):
                with open(self.memory_file, 'r', encoding='utf-8') as f:
                    self.memory = json.load(f)
                print(f"üß† –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.memory)} –∑–∞–ø–∏—Å–µ–π")
            else:
                self.memory = {}
        except:
            self.memory = {}
    
    def save_memory(self):
        try:
            with open(self.memory_file, 'w', encoding='utf-8') as f:
                json.dump(self.memory, f, ensure_ascii=False, indent=2)
        except:
            pass

    def is_greeting(self, text):
        """–£–º–Ω–æ–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–≤–∞–Ω–∏–µ –æ–±—Ä–∞—â–µ–Ω–∏–π"""
        text_lower = text.lower().strip()
        
        greetings = [
            '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä', '–±–æ—Ç', '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', '—Å–∞–ª—é—Ç',
            'start', 'help', '/start', '/help', '–Ω–∞—á–∞—Ç—å', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ',
            '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä', '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ', 'hi', 'hello',
            '–∫—É', '—Å–∞–ª–∞–º', '–ø—Ä–∏–≤', '–ø—Ä–∏–≤–µ—Ç–∏–∫', '—Ö–æ—Ä–∞—Ä–Ω—ã–π', '—ç–º–ø–µ—Ä–æ—Ä'
        ]
        
        return text_lower in greetings

    def is_small_talk(self, text):
        text_lower = text.lower().strip()
        small_talk = [
            '–∫–∞–∫ –¥–µ–ª–∞', '–∫–∞–∫ —Ç—ã', '—á—Ç–æ –¥–µ–ª–∞–µ—à—å', '–∫–∞–∫ –∂–∏–∑–Ω—å', 
            '–∫–∞–∫ —Å–∞–º', '–∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ', '—á–µ–º –∑–∞–Ω—è—Ç', '–∫–∞–∫ –ø–æ–∂–∏–≤–∞–µ—à—å'
        ]
        return any(phrase in text_lower for phrase in small_talk)

    def is_real_question(self, text):
        text_lower = text.lower().strip()
        
        # –ò–≥–Ω–æ—Ä–∏—Ä—É–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –ø—É—Å—Ç—ã–µ —Ñ—Ä–∞–∑—ã
        if self.is_greeting(text_lower) or self.is_small_talk(text_lower):
            return False
            
        if len(text_lower) < 3:
            return False
            
        # –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤
        question_keywords = [
            '–∫–æ–≥–¥–∞', '—á—Ç–æ', '–∫–∞–∫', '–ø–æ—á–µ–º—É', '–∑–∞—á–µ–º', '–±—É–¥–µ—Ç', '–µ—Å—Ç—å', '–±—É–¥–µ—Ç –ª–∏',
            '–º–Ω–µ', '–º–µ–Ω—è', '–º–æ–π', '–º–æ—è', '–º–æ–µ', '–º–æ–∏', '–ø–æ–ª—É—á—É', '–ø—Ä–∏–¥—É—Ç', '–≤—Å—Ç—Ä–µ—á—É',
            '–ª—é–±–æ–≤—å', '–¥–µ–Ω—å–≥–∏', '–æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Ä–∞–±–æ—Ç–∞', '–±—É–¥—É—â–µ–µ', '—Å—É–¥—å–±–∞', '–∫–∞—Ä—å–µ—Ä–∞',
            '–∑–¥–æ—Ä–æ–≤—å–µ', '—Å–µ–º—å—è', '–¥–µ—Ç–∏', '–±—Ä–∞–∫', '–∑–∞–º—É–∂–µ—Å—Ç–≤–æ', '–∂–µ–Ω–∏—Ç—å–±–∞', '–≤—Å—Ç—Ä–µ—á–∞',
            '–ø–æ–µ–∑–¥–∫–∞', '–ø–µ—Ä–µ–µ–∑–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', '—Ñ–∏–Ω–∞–Ω—Å—ã', '–¥–æ—Ö–æ–¥', '–∑–∞—Ä–∞–±–æ—Ç–æ–∫'
        ]
        
        has_keywords = any(keyword in text_lower for keyword in question_keywords)
        has_question_mark = '?' in text_lower
        
        return has_keywords or has_question_mark or len(text_lower) > 15

    def get_question_intent(self, question):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –≤–æ–ø—Ä–æ—Å–∞ –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞"""
        question_lower = question.lower()
        
        # –î–µ–Ω—å–≥–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–æ–π
        if any(word in question_lower for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥', '–ø–æ–ª—É—á—É', '–ø—Ä–∏–¥—É—Ç']):
            if '—Å–µ–≥–æ–¥–Ω—è' in question_lower:
                return "MONEY_TODAY"
            elif '–∑–∞–≤—Ç—Ä–∞' in question_lower:
                return "MONEY_TOMORROW" 
            elif '–∫–æ–≥–¥–∞' in question_lower:
                return "MONEY_WHEN"
            else:
                return "MONEY_GENERAL"
        
        # –õ—é–±–æ–≤—å —Å –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–æ–π
        elif any(word in question_lower for word in ['–ª—é–±–æ–≤', '–æ—Ç–Ω–æ—à–µ–Ω', '—á—É–≤—Å—Ç–≤–∞', '–≤—Å—Ç—Ä–µ—á', '–ø–∞—Ä–µ–Ω—å', '–¥–µ–≤—É—à–∫–∞']):
            if '–∫–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á—É' in question_lower:
                return "LOVE_WHEN_MEET"
            elif '–≤–µ—Ä–Ω–µ—Ç—Å—è' in question_lower or '–≤–µ—Ä–Ω—ë—Ç—Å—è' in question_lower:
                return "LOVE_RETURN"
            else:
                return "LOVE_GENERAL"
        
        # –ë—É–¥—É—â–µ–µ
        elif any(word in question_lower for word in ['–±—É–¥—É—â', '—Å—É–¥—å–±', '–∂–¥–µ—Ç', '–ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç']):
            return "FUTURE_GENERAL"
        
        # –ö–∞—Ä—å–µ—Ä–∞
        elif any(word in question_lower for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä', '–ø—Ä–æ—Ñ–µ—Å—Å–∏']):
            return "CAREER"
        
        else:
            return "DEEP_ANALYSIS"

    def generate_deep_analysis(self, question, intent):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ö–†–ê–°–ò–í–´–ô –∞–Ω–∞–ª–∏–∑ –∫–∞–∫ –≤ –ø—Ä–∏–º–µ—Ä–µ"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        # –ë–∞–∑–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
        signs = ['–û–≤–Ω–µ', '–¢–µ–ª—å—Ü–µ', '–ë–ª–∏–∑–Ω–µ—Ü–∞—Ö', '–†–∞–∫–µ', '–õ—å–≤–µ', '–î–µ–≤–µ', 
                '–í–µ—Å–∞—Ö', '–°–∫–æ—Ä–ø–∏–æ–Ω–µ', '–°—Ç—Ä–µ–ª—å—Ü–µ', '–ö–æ–∑–µ—Ä–æ–≥–µ', '–í–æ–¥–æ–ª–µ–µ', '–†—ã–±–∞—Ö']
        
        if intent == "MONEY_TODAY":
            return self._money_today_analysis(question, time_str, signs)
        elif intent == "MONEY_TOMORROW":
            return self._money_tomorrow_analysis(question, time_str, signs)
        elif "LOVE" in intent:
            return self._love_analysis(question, time_str, intent, signs)
        elif "FUTURE" in intent:
            return self._future_analysis(question, time_str, signs)
        else:
            return self._universal_deep_analysis(question, time_str, signs)

    def _money_today_analysis(self, question, time_str, signs):
        """–ê–Ω–∞–ª–∏–∑ –¥–µ–Ω–µ–≥ –Ω–∞ –°–ï–ì–û–î–ù–Ø —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º –æ—Ç–≤–µ—Ç–æ–º"""
        # –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç–Ω—ã–π –æ—Ç–≤–µ—Ç
        chance = random.randint(1, 100)
        if chance >= 70:
            answer = "üí∞ *–î–ê, –î–ï–ù–¨–ì–ò –ü–†–ò–î–£–¢ –°–ï–ì–û–î–ù–Ø!*"
            probability = f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: {chance}%"
            reason = "–Æ–ø–∏—Ç–µ—Ä —Ñ–æ—Ä–º–∏—Ä—É–µ—Ç –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –∞—Å–ø–µ–∫—Ç —Å –í–µ–Ω–µ—Ä–æ–π –≤ –¥–µ–Ω–µ–∂–Ω–æ–º –¥–æ–º–µ"
        elif chance >= 40:
            answer = "ü§î *–í–û–ó–ú–û–ñ–ù–û, –ù–û –ù–ï –§–ê–ö–¢*"
            probability = f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: {chance}%"
            reason = "–ú–µ—Ä–∫—É—Ä–∏–π —Å–æ–∑–¥–∞–µ—Ç –Ω–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ—Å—Ç—å –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–∞—Ö"
        else:
            answer = "‚ùå *–°–ö–û–†–ï–ï –í–°–ï–ì–û –ù–ï–¢*"
            probability = f"–í–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å: {chance}%"
            reason = "–°–∞—Ç—É—Ä–Ω –±–ª–æ–∫–∏—Ä—É–µ—Ç –¥–µ–Ω–µ–∂–Ω—ã–µ –∫–∞–Ω–∞–ª—ã —Å–µ–≥–æ–¥–Ω—è"
        
        sign1 = random.choice(signs)
        sign2 = random.choice([s for s in signs if s != sign1])
        
        analysis = f"""üåå –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å –∏—Å–∫–∞—Ç–µ–ª—è:* ¬´{question}¬ª

---

*ü™ê –¢–ï–ö–£–©–ê–Ø –ü–õ–ê–ù–ï–¢–ê–†–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:*

‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* (12¬∞45') - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* (8¬∞22') - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å  
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* (5¬∞18') - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* (22¬∞10') - –≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ú–∞—Ä—Å –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* (3¬∞45') - —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å

---

*üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–°–ü–ï–ö–¢–û–í:*

*üí∞ –§–ò–ù–ê–ù–°–´ –ò –ü–†–û–§–ï–°–°–ò–Ø:*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ —Å–µ–∫—Å—Ç–∏–ª—å –Æ–ø–∏—Ç–µ—Ä* - —É–¥–∞—á–∞ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–µ–ª–∞—Ö
‚Ä¢ *–ú–∞—Ä—Å —Ç—Ä–∏–Ω –£—Ä–∞–Ω* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –∫–≤–∞–¥—Ä–∞—Ç –°–∞—Ç—É—Ä–Ω* - –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–π –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã

*üîÆ –§–ò–ù–ê–ù–°–û–í–´–ô –ü–†–û–ì–ù–û–ó –ù–ê –°–ï–ì–û–î–ù–Ø:*
{answer}
*{probability}*
*–ü—Ä–∏—á–∏–Ω–∞:* {reason}

*üí´ –ö–õ–Æ–ß–ï–í–´–ï –ü–ï–†–ò–û–î–´ –°–ï–ì–û–î–ù–Ø:*
‚Ä¢ *–£—Ç—Ä–æ (9:00-11:00):* {"–ë–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ" if random.random() > 0.5 else "–ù–µ–π—Ç—Ä–∞–ª—å–Ω–æ"} –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
‚Ä¢ *–î–µ–Ω—å (14:00-16:00):* {"–í–æ–∑–º–æ–∂–Ω—ã –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è" if random.random() > 0.5 else "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å"}
‚Ä¢ *–í–µ—á–µ—Ä (18:00-20:00):* {"–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Å—á–µ—Ç–∞" if random.random() > 0.5 else "–û—Ç–¥—ã—Ö–∞–π—Ç–µ"}
"""
        
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –ù–ê –°–ï–ì–û–î–ù–Ø:*

*üåÖ –£–¢–†–ï–ù–ù–ò–ô –†–ò–¢–£–ê–õ:*
‚Ä¢ –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ —Å—á–µ—Ç–∞
‚Ä¢ –ü–æ—Å—Ç–∞–≤—å—Ç–µ –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –Ω–∞ –¥–µ–Ω–µ–∂–Ω—ã–π –ø–æ—Ç–æ–∫
‚Ä¢ –ó–µ–ª–µ–Ω—ã–π —á–∞–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –∏–∑–æ–±–∏–ª–∏—è

*üèô –î–ù–ï–í–ù–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨:*
‚Ä¢ –†–µ—à–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (11:00-13:00)
‚Ä¢ –ü–µ—Ä–µ–≥–æ–≤–æ—Ä—ã –æ –≤—ã–ø–ª–∞—Ç–∞—Ö (14:00-16:00)
‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±—é–¥–∂–µ—Ç–∞ (16:00-18:00)

*üåÉ –í–ï–ß–ï–†–ù–ò–ô –û–¢–î–´–•:*
‚Ä¢ –ë–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å –∑–∞ –≤—Å–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è
‚Ä¢ –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –¥–µ–Ω–µ–∂–Ω–æ–≥–æ –ø–æ—Ç–æ–∫–∞
‚Ä¢ –û—Ç–¥—ã—Ö –∏ –≤–µ—Ä–∞ –≤ –∏–∑–æ–±–∏–ª–∏–µ

*üíé –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
‚Ä¢ –ù–æ—Å–∏—Ç–µ –∑–µ–ª–µ–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –¥–µ–Ω–µ–≥
‚Ä¢ –ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–∞—Ö
‚Ä¢ –í–µ—Ä—å—Ç–µ –≤ —Å–≤–æ–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*üîÆ –ú–ê–ù–¢–†–ê –î–ï–ù–ï–ñ–ù–û–ì–û –ü–û–¢–û–ö–ê:* 
¬´–Ø –ø—Ä–∏–Ω–∏–º–∞—é –∏–∑–æ–±–∏–ª–∏–µ –∏ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –ø–æ—Ç–æ–∫ –≤ —Å–≤–æ—é –∂–∏–∑–Ω—å¬ª"""

        return analysis, strategy

    def _love_analysis(self, question, time_str, intent, signs):
        """–ê–Ω–∞–ª–∏–∑ –ª—é–±–≤–∏ —Å –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–º–∏ –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏"""
        
        if intent == "LOVE_WHEN_MEET":
            periods = ["–≤ –±–ª–∏–∂–∞–π—à–∏–µ 2 –Ω–µ–¥–µ–ª–∏", "–≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞", "–¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞", "–≤–µ—Å–Ω–æ–π —Å–ª–µ–¥—É—é—â–µ–≥–æ –≥–æ–¥–∞"]
            period = random.choice(periods)
            meet_answer = f"üíñ *–í–°–¢–†–ï–ß–ê –ü–†–û–ò–ó–û–ô–î–ï–¢ {period.upper()}*"
            reason = "–í–µ–Ω–µ—Ä–∞ –≤—Ö–æ–¥–∏—Ç –≤ –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π –∞—Å–ø–µ–∫—Ç —Å –Æ–ø–∏—Ç–µ—Ä–æ–º"
        else:
            meet_answer = "üíï *–û–¢–ù–û–®–ï–ù–ò–Ø –†–ê–ó–í–ò–í–ê–Æ–¢–°–Ø –í –ë–õ–ê–ì–û–ü–†–ò–Ø–¢–ù–û–ú –ù–ê–ü–†–ê–í–õ–ï–ù–ò–ò*"
            reason = "–õ—É–Ω–∞ –≤ –∑–µ–º–Ω–æ–º –∑–Ω–∞–∫–µ —Å—Ç–∞–±–∏–ª–∏–∑–∏—Ä—É–µ—Ç —á—É–≤—Å—Ç–≤–∞"
        
        analysis = f"""üåå –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å —Å–µ—Ä–¥—Ü–∞:* ¬´{question}¬ª

---

*ü™ê –¢–ï–ö–£–©–ê–Ø –ü–õ–ê–ù–ï–¢–ê–†–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:*

‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* (12¬∞45') - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* (8¬∞22') - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å  
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* (5¬∞18') - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* (22¬∞10') - –≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ú–∞—Ä—Å –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* (3¬∞45') - —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å

---

*üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–°–ü–ï–ö–¢–û–í:*

*üåà –õ–ò–ß–ù–´–ï –û–¢–ù–û–®–ï–ù–ò–Ø:*
‚Ä¢ *–õ—É–Ω–∞ –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏–Ω –∫ –í–µ–Ω–µ—Ä–µ* - –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –∫–≤–∞–¥—Ä–∞—Ç –ù–µ–ø—Ç—É–Ω* - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ —Å–µ–∫—Å—Ç–∏–ª—å –ü–ª—É—Ç–æ–Ω* - –≥–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Å–≤—è–∑–∏

*üîÆ –õ–Æ–ë–û–í–ù–´–ô –ü–†–û–ì–ù–û–ó:*
{meet_answer}
*–ü—Ä–∏—á–∏–Ω–∞:* {reason}

*üí´ –†–û–ú–ê–ù–¢–ò–ß–ï–°–ö–ò–ï –ü–ï–†–°–ü–ï–ö–¢–ò–í–´:*
‚Ä¢ *–ë–ª–∏–∂–∞–π—à–∏–µ –¥–Ω–∏:* {"–ù–æ–≤—ã–µ –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞" if random.random() > 0.5 else "–£–≥–ª—É–±–ª–µ–Ω–∏–µ —á—É–≤—Å—Ç–≤"}
‚Ä¢ *–ù–µ–¥–µ–ª—è:* {"–í–∞–∂–Ω—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã" if random.random() > 0.5 else "–†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∏"}
‚Ä¢ *–ú–µ—Å—è—Ü:* {"–°–µ—Ä—å–µ–∑–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è" if random.random() > 0.5 else "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö"}
"""
        
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –î–õ–Ø –õ–Æ–ë–í–ò:*

*üåÖ –£–¢–†–ï–ù–ù–ò–ô –†–ò–¢–£–ê–õ:*
‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ –æ—Ç–∫—Ä—ã—Ç–∏–µ —Å–µ—Ä–¥—Ü–∞
‚Ä¢ –ê—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏ –ª—é–±–≤–∏ –∫ —Å–µ–±–µ
‚Ä¢ –†–æ–∑–æ–≤—ã–π –∫–≤–∞—Ä—Ü –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ª—é–±–≤–∏

*üèô –î–ù–ï–í–ù–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨:*
‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω—ã–µ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è (11:00-13:00)
‚Ä¢ –ü—Ä–æ—è–≤–ª–µ–Ω–∏–µ –∑–∞–±–æ—Ç—ã –æ –±–ª–∏–∑–∫–∏—Ö (14:00-16:00)
‚Ä¢ –¢–≤–æ—Ä—á–µ—Å–∫–æ–µ —Å–∞–º–æ–≤—ã—Ä–∞–∂–µ–Ω–∏–µ (16:00-18:00)

*üåÉ –í–ï–ß–ï–†–ù–ò–ô –û–¢–î–´–•:*
‚Ä¢ –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∏ (19:00-21:00)
‚Ä¢ –†–∞–±–æ—Ç–∞ –Ω–∞–¥ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–æ–π (21:00-23:00)
‚Ä¢ –û—Ç–¥—ã—Ö –∏ –º–µ—á—Ç—ã –æ –ª—é–±–≤–∏ (23:00+)

*üíé –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
‚Ä¢ –ù–æ—Å–∏—Ç–µ —Ä–æ–∑–æ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏—è –ª—é–±–≤–∏
‚Ä¢ –ë—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –Ω–æ–≤—ã–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞–º
‚Ä¢ –†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ —Å–∞–º–æ–æ—Ü–µ–Ω–∫–æ–π

*üîÆ –ú–ê–ù–¢–†–ê –õ–Æ–ë–í–ò:* 
¬´–Ø –¥–æ—Å—Ç–æ–∏–Ω(–Ω–∞) –ª—é–±–≤–∏ –∏ –ø—Ä–∏–Ω–∏–º–∞—é –µ—ë –≤ —Å–≤–æ—é –∂–∏–∑–Ω—å¬ª"""

        return analysis, strategy

    def _future_analysis(self, question, time_str, signs):
        """–ê–Ω–∞–ª–∏–∑ –±—É–¥—É—â–µ–≥–æ"""
        
        trends = ["–∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è", "—Å—Ç–∞–±–∏–ª—å–Ω—ã–π —Ä–æ—Å—Ç", "–Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –ø–æ–≤–æ—Ä–æ—Ç—ã", "–≥–∞—Ä–º–æ–Ω–∏—á–Ω–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ"]
        trend = random.choice(trends)
        
        analysis = f"""üåå –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å –∏—Å–∫–∞—Ç–µ–ª—è:* ¬´{question}¬ª

---

*ü™ê –¢–ï–ö–£–©–ê–Ø –ü–õ–ê–ù–ï–¢–ê–†–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:*

‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* (12¬∞45') - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* (8¬∞22') - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å  
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* (5¬∞18') - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* (22¬∞10') - –≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ú–∞—Ä—Å –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* (3¬∞45') - —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å

---

*üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–°–ü–ï–ö–¢–û–í:*

*üåà –õ–ò–ß–ù–´–ï –û–¢–ù–û–®–ï–ù–ò–Ø:*
‚Ä¢ *–õ—É–Ω–∞ –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏–Ω –∫ –í–µ–Ω–µ—Ä–µ* - –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –∫–≤–∞–¥—Ä–∞—Ç –ù–µ–ø—Ç—É–Ω* - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ù–∞—á–∞–ª–æ –¥–Ω—è —Ç—Ä–µ–±—É–µ—Ç —è—Å–Ω–æ—Å—Ç–∏ –≤ –æ–±—â–µ–Ω–∏–∏

*üí∞ –§–ò–ù–ê–ù–°–´ –ò –ü–†–û–§–ï–°–°–ò–Ø:*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ —Å–µ–∫—Å—Ç–∏–ª—å –Æ–ø–∏—Ç–µ—Ä* - —É–¥–∞—á–∞ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–µ–ª–∞—Ö
‚Ä¢ *–ú–∞—Ä—Å —Ç—Ä–∏–Ω –£—Ä–∞–Ω* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ü–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –≤—Ä–µ–º—è –¥–ª—è —Å–º–µ–ª—ã—Ö —Ä–µ—à–µ–Ω–∏–π

*üåå –î–£–•–û–í–ù–û–ï –†–ê–ó–í–ò–¢–ò–ï:*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –æ–ø–ø–æ–∑–∏—Ü–∏–∏ —Å –ü–ª—É—Ç–æ–Ω–æ–º* - –≥–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
‚Ä¢ *–õ—É–Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç –ü–ª—É—Ç–æ–Ω* - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —á–µ—Ä–µ–∑ —ç–º–æ—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –í—Ä–µ–º—è –¥–ª—è –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏–∏ –∏ –≥–ª—É–±–æ–∫–∏—Ö —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π

*üîÆ –ü–†–û–ì–ù–û–ó –ù–ê –ë–£–î–£–©–ï–ï:*
*–û–°–ù–û–í–ù–û–ô –¢–†–ï–ù–î:* {trend.upper()}
"""
        
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*
*üéØ –ì–ï–ù–ò–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*

*üåÖ –£–¢–†–ï–ù–ù–ò–ô –†–ò–¢–£–ê–õ:*
‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ —è—Å–Ω–æ—Å—Ç—å –º—ã—Å–ª–µ–π (5-10 –º–∏–Ω—É—Ç)
‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω—è —Å —É—á–µ—Ç–æ–º –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
‚Ä¢ –ó–µ–ª–µ–Ω—ã–π —á–∞–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ú–µ—Ä–∫—É—Ä–∏—è

*üèô –î–ù–ï–í–ù–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨:*
‚Ä¢ –†–µ—à–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (9:00-11:00)
‚Ä¢ –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –∏ –º–æ–∑–≥–æ–≤—ã–µ —à—Ç—É—Ä–º—ã (11:00-13:00)
‚Ä¢ –í–∞–∂–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ (14:00-16:00)
‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (16:00-18:00)

*üåÉ –í–ï–ß–ï–†–ù–ò–ô –û–¢–î–´–•:*
‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∏ (19:00-21:00)
‚Ä¢ –í—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è –∏ –æ–±—É—á–µ–Ω–∏—è (21:00-23:00)
‚Ä¢ –û—Ç–¥—ã—Ö –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ —Å–Ω—É (23:00+)

*üíé –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
‚Ä¢ –ù–æ—Å–∏—Ç–µ –±–∏—Ä—é–∑–æ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –ø–µ—Ä–∏–æ–¥ 13:00-14:00
‚Ä¢ –ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä–µ

*üîÆ –ú–ê–ù–¢–†–ê –î–ù–Ø:* 
¬´–Ø –ø—Ä–∏–Ω–∏–º–∞—é –ø–æ—Ç–æ–∫ –∏–∑–æ–±–∏–ª–∏—è –∏ —Å–ª–µ–¥—É—é –∑–æ–≤—É —Å–µ—Ä–¥—Ü–∞¬ª"""

        return analysis, strategy

    def _universal_deep_analysis(self, question, time_str, signs):
        """–£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑"""
        return self._future_analysis(question, time_str, signs)

# –°–æ–∑–¥–∞–µ–º –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞
emperor = PerfectEmperor()

@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    chat_type = "private" if message.chat.type == "private" else "group"
    
    if chat_type == "private":
        response = """üåå *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ —Å–≤—è—â–µ–Ω–Ω—ã–µ —á–µ—Ä—Ç–æ–≥–∏ –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞!*

*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∏ –ø–æ–ª—É—á–∏ –ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑:*
‚Ä¢ üí∞ ¬´–ü–æ–ª—É—á—É –ª–∏ —è –¥–µ–Ω—å–≥–∏ —Å–µ–≥–æ–¥–Ω—è?¬ª - —É–∑–Ω–∞–π –î–ê/–ù–ï–¢ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é
‚Ä¢ üíñ ¬´–ö–æ–≥–¥–∞ —è –≤—Å—Ç—Ä–µ—á—É –ª—é–±–æ–≤—å?¬ª - —Ç–æ—á–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑ –≤—Å—Ç—Ä–µ—á–∏
‚Ä¢ üåå ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –±—É–¥—É—â–µ–º?¬ª - –¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ —Å—É–¥—å–±—ã
‚Ä¢ üíº ¬´–ö–∞–∫ —Å–ª–æ–∂–∏—Ç—Å—è –∫–∞—Ä—å–µ—Ä–∞?¬ª - –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã

*–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –±—É–¥–µ—Ç –£–ù–ò–ö–ê–õ–¨–ù–´–ú –∏ –ø–æ–¥—Ä–æ–±–Ω—ã–º!*"""
    else:
        response = """üåå *–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –ò—Å–∫–∞—Ç–µ–ª—å!*

üí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å* - –ø–æ–ª—É—á–∏ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Å –ø—Ä–æ–≥–Ω–æ–∑–∞–º–∏
üîí *–ù–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ¬ª* - –ø–µ—Ä–µ–π–¥–µ–º –≤ –õ–° –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏

*–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:*
‚Ä¢ ¬´–ü–æ–ª—É—á—É –ª–∏ —è –¥–µ–Ω—å–≥–∏ —Å–µ–≥–æ–¥–Ω—è?¬ª - –æ—Ç–≤–µ—Ç –î–ê/–ù–ï–¢ —Å %
‚Ä¢ ¬´–ö–æ–≥–¥–∞ –≤—Å—Ç—Ä–µ—á—É –ª—é–±–æ–≤—å?¬ª - —Ç–æ—á–Ω—ã–µ —Å—Ä–æ–∫–∏  
‚Ä¢ ¬´–ß—Ç–æ –∂–¥–µ—Ç –≤ –±—É–¥—É—â–µ–º?¬ª - –¥–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ–≥–Ω–æ–∑
‚Ä¢ ¬´–õ–∏—á–Ω–æ–µ¬ª - –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è

üß† *–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!*"""

    bot.reply_to(message, response, parse_mode='Markdown')

@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    try:
        user_id = message.from_user.id
        text = message.text.strip()
        chat_type = "private" if message.chat.type == "private" else "group"
        
        print(f"üí´ –°–æ–æ–±—â–µ–Ω–∏–µ: '{text}'")

        # –ü–†–û–°–¢–û–ô –ø–µ—Ä–µ—Ö–æ–¥ –≤ –õ–°
        if chat_type in ['group', 'supergroup'] and text.lower() in ['–ª–∏—á–Ω–æ–µ', '–ø—Ä–∏–≤–∞—Ç–Ω–æ', '–≤ –ª—Å', '–ø—Ä–∏–≤–∞—Ç']:
            try:
                private_response = """üîí *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —á–∞—Ç!*

üåå *–¢–µ–ø–µ—Ä—å –≤—Å–µ —Ç–≤–æ–∏ –≤–æ–ø—Ä–æ—Å—ã –æ—Å—Ç–∞–Ω—É—Ç—Å—è –º–µ–∂–¥—É –Ω–∞–º–∏!*

*–ó–∞–¥–∞–π –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ:*
‚Ä¢ üí∞ –û –¥–µ–Ω—å–≥–∞—Ö –∏ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö (—É–∑–Ω–∞–π –î–ê/–ù–ï–¢ —Å –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å—é)
‚Ä¢ üíñ –û –ª—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö (—Ç–æ—á–Ω—ã–µ –ø—Ä–æ–≥–Ω–æ–∑—ã)  
‚Ä¢ üåå –û –±—É–¥—É—â–µ–º –∏ —Å—É–¥—å–±–µ (–¥–µ—Ç–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑)
‚Ä¢ üíº –û –∫–∞—Ä—å–µ—Ä–µ –∏ —Ä–∞–±–æ—Ç–µ

*–Ø –¥–∞–º —Ç–µ–±–µ –ì–õ–£–ë–û–ö–ò–ô –∏ –ß–ï–°–¢–ù–´–ô –∞–Ω–∞–ª–∏–∑!*"""
                
                bot.send_message(user_id, private_response, parse_mode='Markdown')
                bot.reply_to(message, "‚úÖ *–ü–µ—Ä–µ—Ö–æ–¥–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è!* üîí", parse_mode='Markdown')
                return
            except:
                bot.reply_to(message, "üíå *–°–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–°:* @HoraryEmperorBot", parse_mode='Markdown')
                return

        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
        if emperor.is_greeting(text):
            if chat_type == "private":
                response = "üåå *–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é, –ò—Å–∫–∞—Ç–µ–ª—å! –ó–∞–¥–∞–π —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å –æ –ª—é–±–≤–∏, –¥–µ–Ω—å–≥–∞—Ö –∏–ª–∏ –±—É–¥—É—â–µ–º - –∏ —è –¥–∞–º —Ç–µ–±–µ –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑!*"
            else:
                response = "üåå *–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é! –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∏–ª–∏ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ¬ª –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è.*"
            bot.reply_to(message, response, parse_mode='Markdown')
            return
            
        # –ü—É—Å—Ç—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã
        if emperor.is_small_talk(text):
            response = "ü§î *–Ø –∑–¥–µ—Å—å –¥–ª—è –≥–ª—É–±–æ–∫–∏—Ö –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –∞–Ω–∞–ª–∏–∑–æ–≤! –ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ –ª—é–±–≤–∏, –¥–µ–Ω—å–≥–∞—Ö –∏–ª–∏ –±—É–¥—É—â–µ–º.*"
            bot.reply_to(message, response, parse_mode='Markdown')
            return

        # –ù–∞—Å—Ç–æ—è—â–∏–µ –≤–æ–ø—Ä–æ—Å—ã
        if emperor.is_real_question(text):
            intent = emperor.get_question_intent(text)
            analysis, strategy = emperor.generate_deep_analysis(text, intent)
            
            if chat_type == "private":
                full_response = f"{analysis}\n\n{strategy}\n\nüß† *–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!*"
            else:
                full_response = f"{analysis}\n\n{strategy}\n\nüíå *–î–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ¬ª*\nüß† *–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!*"
            
            bot.reply_to(message, full_response, parse_mode='Markdown')
        else:
            response = """üîÆ *–ó–∞–¥–∞–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤–æ–ø—Ä–æ—Å –æ:*
‚Ä¢ üí∞ –î–µ–Ω—å–≥–∞—Ö –∏ —Ñ–∏–Ω–∞–Ω—Å–∞—Ö 
‚Ä¢ üíñ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ üåå –ë—É–¥—É—â–µ–º –∏ —Å—É–¥—å–±–µ
‚Ä¢ üíº –ö–∞—Ä—å–µ—Ä–µ –∏ —Ä–∞–±–æ—Ç–µ

*–ò–ª–∏ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ¬ª –¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è*"""
            bot.reply_to(message, response, parse_mode='Markdown')
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        bot.reply_to(message, "üîÆ *–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—Ö–∏... –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!*", parse_mode='Markdown')

print("‚úÖ –°–û–í–ï–†–®–ï–ù–ù–´–ô –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤!")
print("üåê Flask —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000")

def perfect_launch():
    while True:
        try:
            print("üí´ –ó–∞–ø—É—Å–∫–∞—é —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π polling...")
            bot.polling(none_stop=True, interval=2, timeout=60)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞ polling: {e}")
            time.sleep(10)

if __name__ == "__main__":
    perfect_launch()
