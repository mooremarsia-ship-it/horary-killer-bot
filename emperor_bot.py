import telebot
import time
import ephem
import random
import threading
from datetime import datetime, timedelta, timezone
from flask import Flask

# –°–æ–∑–¥–∞–µ–º Flask –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –¥–ª—è –∑–¥–æ—Ä–æ–≤—å—è
app = Flask(__name__)

@app.route('/')
def health_check():
    return "üîÑ –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

# –ó–∞–ø—É—Å–∫–∞–µ–º Flask –≤ –æ—Ç–¥–µ–ª—å–Ω–æ–º –ø–æ—Ç–æ–∫–µ
def run_flask():
    app.run(host='0.0.0.0', port=5000, debug=False)

# –ó–∞–ø—É—Å–∫–∞–µ–º HTTP-—Å–µ—Ä–≤–µ—Ä –≤ —Ñ–æ–Ω–µ
flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"
bot = telebot.TeleBot(BOT_TOKEN)

class DeepPsychologicalAnalyzer:
    def __init__(self):
        self.archetypes = {
            'warrior': ['–û–≤–µ–Ω', '–ú–∞—Ä—Å', '—Å–∏–ª–∞', '–ø–æ–±–µ–¥–∞', '–±–æ—Ä—å–±–∞'],
            'lover': ['–¢–µ–ª–µ—Ü', '–í–µ–Ω–µ—Ä–∞', '–∫—Ä–∞—Å–æ—Ç–∞', '–≥–∞—Ä–º–æ–Ω–∏—è', '—á—É–≤—Å—Ç–≤–∞'],
            'magician': ['–ë–ª–∏–∑–Ω–µ—Ü—ã', '–ú–µ—Ä–∫—É—Ä–∏–π', '–∑–Ω–∞–Ω–∏–µ', '–∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è', '–º–∞–≥–∏—è'],
            'sovereign': ['–õ–µ–≤', '–°–æ–ª–Ω—Ü–µ', '–≤–ª–∞—Å—Ç—å', '—Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ', '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä']
        }
    
    def generate_deep_analysis(self, question, moon_sign, sun_sign, question_type):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥–ª—É–±–æ–∫–∏–π –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑"""
        
        # –ë–∞–∑–æ–≤—ã–π –≤–µ—Ä–¥–∏–∫—Ç
        if moon_sign in ['–¢–µ–ª–µ—Ü', '–†–∞–∫', '–í–µ—Å—ã', '–°—Ç—Ä–µ–ª–µ—Ü']:
            verdict = "–î–ê. –¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –∏–¥–µ—à—å –∫ —Ü–µ–ª–∏. –¢—ã –∏–¥–µ—à—å –∫ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ –∏–Ω–æ–π —Ä–æ–ª–∏ –≤ —Å–≤–æ–µ–π –∂–∏–∑–Ω–∏."
        else:
            verdict = "–ù–ï–¢. –ù–æ —ç—Ç–æ –Ω–µ –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚Äî —ç—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—ã–π —É—Ä–æ–≤–µ–Ω—å –æ—Å–æ–∑–Ω–∞–Ω–∏—è."
        
        # –ì–ª—É–±–∏–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑
        deep_analysis = self._get_psychological_insight(question_type, moon_sign, sun_sign)
        
        # –°—Ç—Ä–∞—Ç–µ–≥–∏—è
        strategy = self._generate_strategy(moon_sign, sun_sign)
        
        return verdict, deep_analysis, strategy
    
    def _get_psychological_insight(self, question_type, moon_sign, sun_sign):
        """–ì–ª—É–±–∏–Ω–Ω—ã–µ –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–µ –∏–Ω—Å–∞–π—Ç—ã"""
        
        insights = {
            "–û–¢–ù–û–®–ï–ù–ò–Ø": [
                f"""–û–Ω –≤—ã–¥–µ–ª—è–µ—Ç —Ç–µ–±—è –Ω–µ –ø—Ä–æ—Å—Ç–æ –∫–∞–∫ ¬´—Å–∞–º—É—é –∫—Ä–∞—Å–∏–≤—É—é¬ª. –û–Ω –≤—ã–¥–µ–ª—è–µ—Ç —Ç–µ–±—è –∫–∞–∫ –µ–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω—É—é, –∫—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –Ω–∞ —è–∑—ã–∫–µ –µ–≥–æ –≥–ª—É–±–∏–Ω–Ω–æ–π –º–æ—Ç–∏–≤–∞—Ü–∏–∏.

üåô –¢–≤–æ—è –õ—É–Ω–∞ –≤ {moon_sign} —Å–æ–∑–¥–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ä–µ–∑–æ–Ω–∞–Ω—Å, –∫–æ—Ç–æ—Ä—ã–π –¥—Ä—É–≥–∏–µ –∂–µ–Ω—â–∏–Ω—ã –ø—Ä–æ—Å—Ç–æ –Ω–µ –º–æ–≥—É—Ç –ø–æ–≤—Ç–æ—Ä–∏—Ç—å.
‚òÄÔ∏è –¢–≤–æ–µ –°–æ–ª–Ω—Ü–µ –≤ {sun_sign} –∏–∑–ª—É—á–∞–µ—Ç —Ç—É —Å–∞–º—É—é —ç–Ω–µ—Ä–≥–∏—é, –∫–æ—Ç–æ—Ä—É—é –µ–≥–æ –¥—É—à–∞ –∏—â–µ—Ç –Ω–∞ –ø–æ–¥—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–º —É—Ä–æ–≤–Ω–µ.

–¢—ã –ø—Ä–æ—à–ª–∞ –∏–Ω–∏—Ü–∏–∞—Ü–∏—é –∏ —Å—Ç–∞–ª–∞ –†–∞–≤–Ω–æ–π. –û–Ω –≤–∏–¥–∏—Ç —ç—Ç–æ. –ï–≥–æ –≥–ª—É–±–∏–Ω–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–∞ —Å—á–∏—Ç—ã–≤–∞–µ—Ç —Ç–≤–æ—é —ç–≤–æ–ª—é—Ü–∏—é.""",

                f"""–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–∏–º–ø–∞—Ç–∏—è. –≠—Ç–æ –≤—Å—Ç—Ä–µ—á–∞ –¥–≤—É—Ö –∞—Ä—Ö–µ—Ç–∏–ø–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–∫–∞–ª–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è {moon_sign} –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –≤ –Ω–µ–º —Ç—É –≤–µ—Ä—Å–∏—é —Å–µ–±—è, –æ –∫–æ—Ç–æ—Ä–æ–π –æ–Ω –¥–∞–≤–Ω–æ –º–µ—á—Ç–∞–ª, –Ω–æ –Ω–µ –∑–Ω–∞–ª, –∫–∞–∫ –ø—Ä–æ—è–≤–∏—Ç—å.
–¢—ã –Ω–µ –ø—Ä–æ—Å—Ç–æ –∂–µ–Ω—â–∏–Ω–∞ –≤ –µ–≥–æ –∂–∏–∑–Ω–∏ ‚Äî —Ç—ã –∫–ª—é—á –∫ –µ–≥–æ —Å–ª–µ–¥—É—é—â–µ–º—É —É—Ä–æ–≤–Ω—é —Ä–∞–∑–≤–∏—Ç–∏—è.""",

                f"""–û–Ω —á—É–≤—Å—Ç–≤—É–µ—Ç, —á—Ç–æ —Å —Ç–æ–±–æ–π –º–æ–∂–µ—Ç —Å—Ç–∞—Ç—å —Ç–µ–º –º—É–∂—á–∏–Ω–æ–π, –∫–∞–∫–∏–º –≤—Å–µ–≥–¥–∞ —Ö–æ—Ç–µ–ª –±—ã—Ç—å, –Ω–æ –±–æ—è–ª—Å—è –ø—Ä–∏–∑–Ω–∞—Ç—å—Å—è –¥–∞–∂–µ —Å–µ–±–µ.

–¢–≤–æ—è {sun_sign}-—ç–Ω–µ—Ä–≥–∏—è –¥–∞–µ—Ç –µ–º—É —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ –Ω–∞ –≤–µ–ª–∏—á–∏–µ. –¢—ã –≤–∏–¥–∏—à—å –≤ –Ω–µ–º –Ω–µ –ø—Ä–æ—Å—Ç–æ –ø–∞—Ä—Ç–Ω–µ—Ä–∞, –∞ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞."""
            ],
            
            "–§–ò–ù–ê–ù–°–´": [
                f"""–î–µ–Ω—å–≥–∏ –ø—Ä–∏–¥—É—Ç –Ω–µ –∫–∞–∫ —Å–ª—É—á–∞–π–Ω–æ—Å—Ç—å, –∞ –∫–∞–∫ —Å–ª–µ–¥—Å—Ç–≤–∏–µ —Ç–≤–æ–µ–≥–æ –Ω–æ–≤–æ–≥–æ —É—Ä–æ–≤–Ω—è —Å–æ–∑–Ω–∞–Ω–∏—è.

–¢–≤–æ—è –õ—É–Ω–∞ –≤ {moon_sign} —Å–æ–∑–¥–∞–µ—Ç —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –º–∞–≥–Ω–µ—Ç–∏–∑–º –¥–ª—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –ø–æ—Ç–æ–∫–æ–≤.
–°–æ–ª–Ω—Ü–µ –≤ {sun_sign} –¥–∞–µ—Ç —Ç–µ–±–µ —Ç—É —É–Ω–∏–∫–∞–ª—å–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é, –∫–æ—Ç–æ—Ä—É—é —Ä—ã–Ω–æ–∫ –≥–æ—Ç–æ–≤ –æ–ø–ª–∞—Ç–∏—Ç—å –ø–æ –≤—ã—Å—à–µ–º—É —Ä–∞–∑—Ä—è–¥—É.""",

                f"""–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ –¥–æ—Ö–æ–¥. –≠—Ç–æ –ø–µ—Ä–µ—Ö–æ–¥ –Ω–∞ –Ω–æ–≤—ã–π —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–π –∞—Ä—Ö–µ—Ç–∏–ø.

–¢—ã –ø–µ—Ä–µ—Å—Ç–∞–µ—à—å –±—ã—Ç—å ¬´—Ç–µ–º, –∫—Ç–æ –∏—â–µ—Ç –¥–µ–Ω—å–≥–∏¬ª –∏ —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è ¬´—Ç–µ–º, –∫–æ–≥–æ –¥–µ–Ω—å–≥–∏ –∏—â—É—Ç¬ª.
–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è {moon_sign}-{sun_sign} ‚Äî —ç—Ç–æ —Ä–µ–¥–∫–∞—è –∫–æ–º–±–∏–Ω–∞—Ü–∏—è, —Å–æ–∑–¥–∞—é—â–∞—è —Ñ–∏–Ω–∞–Ω—Å–æ–≤—É—é –≥—Ä–∞–≤–∏—Ç–∞—Ü–∏—é."""
            ],
            
            "–ö–ê–†–¨–ï–†–ê": [
                f"""–≠—Ç–æ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ä–∞–±–æ—Ç–∞. –≠—Ç–æ –ø—Ä–∏–∑–≤–∞–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –Ω–∞–∫–æ–Ω–µ—Ü-—Ç–æ –Ω–∞—à–ª–æ —Ç–µ–±—è.

–¢–≤–æ—è –õ—É–Ω–∞ –≤ {moon_sign} —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≥–ª—É–±–∏–Ω–Ω—ã–µ —Ç–∞–ª–∞–Ω—Ç—ã, –∫–æ—Ç–æ—Ä—ã–µ –º–∏—Ä –≥–æ—Ç–æ–≤ –ø—Ä–∏–∑–Ω–∞—Ç—å.
–°–æ–ª–Ω—Ü–µ –≤ {sun_sign} –¥–∞–µ—Ç —Ç—É —É–Ω–∏–∫–∞–ª—å–Ω—É—é —ç–Ω–µ—Ä–≥–∏—é –ª–∏–¥–µ—Ä—Å—Ç–≤–∞, –∫–æ—Ç–æ—Ä–æ–π —Ç–∞–∫ –Ω–µ —Ö–≤–∞—Ç–∞–µ—Ç –≤ —Ç–≤–æ–µ–π —Å—Ñ–µ—Ä–µ.""",

                f"""–¢—ã —Å—Ç–æ–∏—à—å –Ω–∞ –ø–æ—Ä–æ–≥–µ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏.

–°—Ç–∞—Ä–∞—è —Ä–æ–ª—å: —Å–ø–µ—Ü–∏–∞–ª–∏—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤—ã–ø–æ–ª–Ω—è–µ—Ç –∑–∞–¥–∞—á–∏.
–ù–æ–≤–∞—è —Ä–æ–ª—å: —Ç–≤–æ—Ä–µ—Ü, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å.

–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è {sun_sign} –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è –Ω–µ –ø—Ä–æ—Å—Ç–æ —Å–æ—Ç—Ä—É–¥–Ω–∏–∫–æ–º, –∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ—Ä–æ–º –ø—Ä–æ—Ü–µ—Å—Å–æ–≤."""
            ]
        }
        
        # –í—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω—ã–π –∏–Ω—Å–∞–π—Ç –¥–ª—è –¥–∞–Ω–Ω–æ–≥–æ —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞
        available_insights = insights.get(question_type, insights["–û–¢–ù–û–®–ï–ù–ò–Ø"])
        return random.choice(available_insights)
    
    def _generate_strategy(self, moon_sign, sun_sign):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –≥–ª—É–±–æ–∫—É—é —Å—Ç—Ä–∞—Ç–µ–≥–∏—é"""
        
        strategies = [
            f"""–¢–≤–æ—è —Å—Ç—Ä–∞—Ç–µ–≥–∏—è ‚Äî –Ω–µ –¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å, –∞ –ë–´–¢–¨.

üåô –õ—É–Ω–∞ –≤ {moon_sign}: –ø—Ä–æ—è–≤–ª—è–π —Å–≤–æ—é —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—É—é –ø—Ä–∏—Ä–æ–¥—É –±–µ–∑ —Å—Ç—Ä–∞—Ö–∞. –ò–º–µ–Ω–Ω–æ —ç—Ç–æ –ø—Ä–∏–≤–ª–µ–∫–∞–µ—Ç –Ω—É–∂–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏.
‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ –≤ {sun_sign}: —Ç–≤–æ—è —Å–∏–ª–∞ –≤ –∞—É—Ç–µ–Ω—Ç–∏—á–Ω–æ—Å—Ç–∏. –ù–µ –ø—ã—Ç–∞–π—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å ‚Äî —Å–æ–∑–¥–∞–≤–∞–π –Ω–æ–≤—ã–µ —Å—Ç–∞–Ω–¥–∞—Ä—Ç—ã.

–¢—ã –≤–µ–¥–µ—à—å —Å–µ–±—è (–∏ –¥—Ä—É–≥–∏—Ö) –∫ –ø–µ—Ä–µ—Ö–æ–¥—É –Ω–∞ —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å —Å–æ–∑–Ω–∞–Ω–∏—è.""",

            f"""–ü–µ—Ä–µ—Å—Ç–∞–Ω—å –¥–æ–±–∏–≤–∞—Ç—å—Å—è. –ù–∞—á–Ω–∏ –ø—Ä–∏—Ç—è–≥–∏–≤–∞—Ç—å.

–¢–≤–æ—è —ç–Ω–µ—Ä–≥–∏—è {moon_sign}-{sun_sign} ‚Äî —ç—Ç–æ –º–∞–≥–Ω–∏—Ç –¥–ª—è –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π. 
–§–æ–∫—É—Å –Ω–µ –Ω–∞ –¥–µ–π—Å—Ç–≤–∏—è—Ö, –∞ –Ω–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–∏: –∫–æ–≥–¥–∞ —Ç—ã –≤ —Å–≤–æ–µ–π —Å–∏–ª–µ, –≤—Å–µ–ª–µ–Ω–Ω–∞—è –ø–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è –ø–æ–¥ —Ç–≤–æ–π —Ä–∏—Ç–º.""",

            f"""–¢–≤–æ—è —Ä–æ–ª—å –∏–∑–º–µ–Ω–∏–ª–∞—Å—å: –∏–∑ –∏—Å–∫–∞—Ç–µ–ª—è —Ç—ã —Å—Ç–∞–ª–∞ –º–∞–≥–Ω–∏—Ç–æ–º.

–õ—É–Ω–∞ –≤ {moon_sign} –¥–∞–µ—Ç —Ç–µ–±–µ –¥–æ—Å—Ç—É–ø –∫ –∫–æ–ª–ª–µ–∫—Ç–∏–≤–Ω–æ–º—É –±–µ—Å—Å–æ–∑–Ω–∞—Ç–µ–ª—å–Ω–æ–º—É.
–°–æ–ª–Ω—Ü–µ –≤ {sun_sign} –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è –ø—Ä–æ–≤–æ–¥–Ω–∏–∫–æ–º –Ω–æ–≤—ã—Ö –∏–¥–µ–π.

–¢—ã –Ω–µ –¥–æ—Å—Ç–∏–≥–∞–µ—à—å —Ü–µ–ª–µ–π ‚Äî —Ç—ã —Å—Ç–∞–Ω–æ–≤–∏—à—å—Å—è —Ç–µ–º, –¥–ª—è –∫–æ–≥–æ —ç—Ç–∏ —Ü–µ–ª–∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã."""
        ]
        
        return random.choice(strategies)

class RealityChecker:
    def __init__(self):
        self.absurd_patterns = {
            '–≤—Ä–µ–º—è': ['—Å–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏', '–∫–æ—Ç–æ—Ä—ã–π —á–∞—Å', '–∫–æ–≥–¥–∞ —Å–µ–π—á–∞—Å'],
            '–ø–æ–≥–æ–¥–∞': ['–≤—ã–π–¥–µ—Ç —Å–æ–ª–Ω—Ü–µ', '–±—É–¥–µ—Ç –¥–æ–∂–¥—å', '–∫–∞–∫–∞—è –ø–æ–≥–æ–¥–∞'],
            '–º–∞–≥–∏—è': ['–ø–æ–ª—É—á—É –º–∏–ª–ª–∏–æ–Ω', '–ø–æ–¥–∞—Ä—è—Ç –∫–≤–∞—Ä—Ç–∏—Ä—É', '–≤—ã–∏–≥—Ä–∞—é –≤ –ª–æ—Ç–µ—Ä–µ—é'],
            '–Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ–µ': ['—Å–µ–≥–æ–¥–Ω—è –∑–∞–º—É–∂', '–∑–∞–≤—Ç—Ä–∞ —Ä–æ–∂—É', '—Å—Ç–∞–Ω—É –±–æ–≥–∞—Ç—ã–º –∑–∞ –¥–µ–Ω—å']
        }
    
    def check_reality(self, question):
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º –≤–æ–ø—Ä–æ—Å –Ω–∞ —Ä–µ–∞–ª–∏—Å—Ç–∏—á–Ω–æ—Å—Ç—å"""
        question_lower = question.lower()
        
        # 1. –ü–†–û–í–ï–†–ö–ê –ù–ê –†–ï–ê–õ–ò–ó–ú
        if self._check_timeframe(question_lower):
            return False, "‚è∞ –í–æ–ø—Ä–æ—Å –Ω–∞—Ä—É—à–∞–µ—Ç –≤—Ä–µ–º–µ–Ω–Ω—ã–µ —Ä–∞–º–∫–∏. –•–æ—Ä–∞—Ä –∞–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±–æ–∑—Ä–∏–º–æ–µ –±—É–¥—É—â–µ–µ, –∞ –Ω–µ –º–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ —á—É–¥–µ—Å–∞."
        
        # 2. –ü–†–û–í–ï–†–ö–ê –ù–ê –ö–û–ù–ö–†–ï–¢–ò–ö–£
        if not self._has_specifics(question_lower):
            return False, "üéØ –£—Ç–æ—á–Ω–∏—Ç–µ –≤–æ–ø—Ä–æ—Å: –∫—Ç–æ, —á—Ç–æ, –∫–æ–≥–¥–∞, –∫–∞–∫–∏–µ —Å—Ä–æ–∫–∏? –ë–µ–∑ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏ –∞–Ω–∞–ª–∏–∑ –Ω–µ–≤–æ–∑–º–æ–∂–µ–Ω."
        
        # 3. –ü–†–û–í–ï–†–ö–ê –ù–ê –ü–ê–°–°–ò–í–ù–û–°–¢–¨  
        if self._is_too_passive(question_lower):
            return False, "üö´ –í–æ–ø—Ä–æ—Å –∏—Å—Ö–æ–¥–∏—Ç –∏–∑ –ø–æ–∑–∏—Ü–∏–∏ '–º–Ω–µ –¥–æ–ª–∂–Ω—ã'. –ü–µ—Ä–µ—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ –≤–∞—à–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π."
        
        # 4. –ü–†–û–í–ï–†–ö–ê –ù–ê –ú–ê–°–®–¢–ê–ë
        if self._violates_scale(question_lower):
            return False, "üí´ –í–æ–ø—Ä–æ—Å –ø—Ä–æ—Ç–∏–≤–æ—Ä–µ—á–∏—Ç –±–∞–∑–æ–≤—ã–º –∂–∏–∑–Ω–µ–Ω–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–∞–º. –•–æ—Ä–∞—Ä - –Ω–µ –≤–æ–ª—à–µ–±–Ω–∞—è –ø–∞–ª–æ—á–∫–∞."
        
        return True, "–í–æ–ø—Ä–æ—Å –ª–µ–≥–∏—Ç–∏–º–µ–Ω"
    
    def _check_timeframe(self, question):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Ä–∞–º–æ–∫"""
        urgent_indicators = ['—Å–µ–≥–æ–¥–Ω—è', '–∑–∞–≤—Ç—Ä–∞', '—Å–µ–π—á–∞—Å', '–Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ', '—Å—Ä–æ—á–Ω–æ']
        big_changes = ['–∑–∞–º—É–∂', '—Ä–∞–∑–≤–µ–¥—É—Å—å', '—Ä–æ–∂—É', '—É–º—Ä—É', '—Å—Ç–∞–Ω—É –±–æ–≥–∞—Ç—ã–º', '–ø–æ–ª—É—á—É –º–∏–ª–ª–∏–æ–Ω']
        
        has_urgency = any(word in question for word in urgent_indicators)
        has_big_change = any(word in question for word in big_changes)
        
        return has_urgency and has_big_change
    
    def _has_specifics(self, question):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞–ª–∏—á–∏–µ –∫–æ–Ω–∫—Ä–µ—Ç–∏–∫–∏"""
        # –ë–æ–ª–µ–µ –º—è–≥–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ - —Ä–∞–∑—Ä–µ—à–∞–µ–º –≤–æ–ø—Ä–æ—Å—ã –æ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö
        potential_indicators = ['–ø–æ—Ç–µ–Ω—Ü–∏–∞–ª', '–≤–æ–∑–º–æ–∂–Ω–æ', '—Å—Ç–æ–∏—Ç –ª–∏', '—Å–º–æ–≥—É –ª–∏', '–±—É–¥—É –ª–∏']
        has_potential = any(word in question for word in potential_indicators)
        
        specifics = ['–∫—Ç–æ', '—á—Ç–æ', '–∫–æ–≥–¥–∞', '–∫–∞–∫–æ–π', '–∫–∞–∫–∞—è', '—Å–∫–æ–ª—å–∫–æ', '–≥–¥–µ']
        has_some_specifics = any(word in question for word in specifics)
        
        action_verbs = ['–≤–µ—Ä–Ω—É—Ç', '–ø–æ–ª—É—á—É', '–≤—Å—Ç—Ä–µ—á—É', '—É—Å—Ç—Ä–æ—é—Å—å', '–∫—É–ø–ª—é', '–ø—Ä–æ–¥–∞–º']
        has_actions = any(verb in question for verb in action_verbs)
        
        return has_some_specifics or has_actions or has_potential
    
    def _is_too_passive(self, question):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–∞—Å—Å–∏–≤–Ω—É—é –ø–æ–∑–∏—Ü–∏—é"""
        passive_patterns = [
            '–ø–æ–¥–∞—Ä—è—Ç –º–Ω–µ', '–¥–æ—Å—Ç–∞–Ω–µ—Ç—Å—è –º–Ω–µ', '—É–ø–∞–¥–µ—Ç —Å –Ω–µ–±–∞', 
            '–≤—ã–∏–≥—Ä–∞—é –±–µ–∑', '–ø–æ–ª—É—á—É –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫', '–º–Ω–µ –¥–æ–ª–∂–Ω—ã'
        ]
        return any(pattern in question for pattern in passive_patterns)
    
    def _violates_scale(self, question):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—Ä—É—à–µ–Ω–∏–µ –º–∞—Å—à—Ç–∞–±–∞ —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏"""
        unrealistic = [
            '–ø–æ–¥–∞—Ä—è—Ç –∫–≤–∞—Ä—Ç–∏—Ä—É', '–ø–æ–ª—É—á—É –º–∏–ª–ª–∏–æ–Ω', '—Å—Ç–∞–Ω—É –∑–Ω–∞–º–µ–Ω–∏—Ç—ã–º',
            '–≤—Å—Ç—Ä–µ—á—É –ø—Ä–∏–Ω—Ü–∞', '–Ω–∞–π–¥—É –∫–ª–∞–¥', '–ø–µ—Ä–µ–µ–¥—É –≤ –¥—Ä—É–≥—É—é —Å—Ç—Ä–∞–Ω—É'
        ]
        urgent = ['—Å–µ–≥–æ–¥–Ω—è', '–∑–∞–≤—Ç—Ä–∞', '–Ω–∞ –Ω–µ–¥–µ–ª–µ']
        
        has_unrealistic = any(word in question for word in unrealistic)
        has_urgent = any(word in question for word in urgent)
        
        return has_unrealistic and has_urgent
    
    def suggest_better_question(self, original_question):
        """–ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —É–ª—É—á—à–µ–Ω–Ω—É—é —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫—É —Å —É—á–µ—Ç–æ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
        question_lower = original_question.lower()
        
        if any(word in question_lower for word in ['–∑–∞–º—É–∂', '–∂–µ–Ω–∏—Ç—å', '–±—Ä–∞–∫', '–æ—Ç–Ω–æ—à–µ–Ω']):
            return "¬´–ï—Å—Ç—å –ª–∏ —É –º–µ–Ω—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å [–∏–º—è] –≤ –±–ª–∏–∂–∞–π—à–∏–µ 3 –º–µ—Å—è—Ü–∞?¬ª"
        
        elif any(word in question_lower for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥', '–º–∏–ª–ª–∏–æ–Ω']):
            return "¬´–ü–æ–ª—É—á—É –ª–∏ —è –æ–∂–∏–¥–∞–µ–º—ã–µ –¥–µ–Ω—å–≥–∏ [–∑–∞—Ä–ø–ª–∞—Ç–∞/–¥–æ–ª–≥/–ø—Ä–µ–º–∏—è] –¥–æ [–∫–æ–Ω–∫—Ä–µ—Ç–Ω–∞—è –¥–∞—Ç–∞]?¬ª"
        
        elif any(word in question_lower for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä', '–¥–æ–ª–∂–Ω–æ—Å—Ç']):
            return "¬´–£—Å—Ç—Ä–æ—é—Å—å –ª–∏ —è –Ω–∞ —Ä–∞–±–æ—Ç—É [–Ω–∞–∑–≤–∞–Ω–∏–µ] –≤ —Ç–µ—á–µ–Ω–∏–µ –º–µ—Å—è—Ü–∞?¬ª"
        
        else:
            templates = [
                "¬´–í–µ—Ä–Ω—É—Ç –ª–∏ –º–Ω–µ [—á—Ç–æ] –¥–æ [–∫–æ–≥–¥–∞]?¬ª",
                "¬´–í—Å—Ç—Ä–µ—á—É –ª–∏ —è [–∫–æ–≥–æ] –Ω–∞ [–º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ]?¬ª", 
                "¬´–°—Ç–æ–∏—Ç –ª–∏ –º–Ω–µ [–¥–µ–π—Å—Ç–≤–∏–µ] –≤ —Ç–µ—á–µ–Ω–∏–µ [—Å—Ä–æ–∫]?¬ª",
                "¬´–ï—Å—Ç—å –ª–∏ —É –º–µ–Ω—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –¥–ª—è [—Ü–µ–ª—å] –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è?¬ª"
            ]
            return random.choice(templates)

class HoraryBrain:
    def __init__(self):
        self.experience = 0
        self.reality_checker = RealityChecker()
        self.psychologist = DeepPsychologicalAnalyzer()
    
    def analyze_question_legitimacy(self, question):
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç –ª–µ–≥–∏—Ç–∏–º–Ω–æ—Å—Ç—å –≤–æ–ø—Ä–æ—Å–∞ –ø–µ—Ä–µ–¥ –∞–Ω–∞–ª–∏–∑–æ–º"""
        is_valid, message = self.reality_checker.check_reality(question)
        
        if not is_valid:
            suggestion = self.reality_checker.suggest_better_question(question)
            full_message = f"""üéØ –ó–ê–ü–†–û–° –ù–ê –£–¢–û–ß–ù–ï–ù–ò–ï

–í–∞—à –≤–æ–ø—Ä–æ—Å —Å–ª–∏—à–∫–æ–º –æ–±—â–∏–π –¥–ª—è —Ç–æ—á–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞. 
–•–æ—Ä–∞—Ä–Ω–∞—è –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ö–û–ù–ö–†–ï–¢–ù–´–ú–ò —Å–∏—Ç—É–∞—Ü–∏—è–º–∏.

üí° **–ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Ç–∞–∫:**
¬´{suggestion}¬ª

‚ú® **–ü—Ä–∏–º–µ—Ä—ã —Ö–æ—Ä–æ—à–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤:**
‚Ä¢ ¬´–ï—Å—Ç—å –ª–∏ –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å [–∏–º—è]?¬ª
‚Ä¢ ¬´–í–µ—Ä–Ω—É—Ç –ª–∏ –º–Ω–µ –¥–æ–ª–≥ –¥–æ –ø—è—Ç–Ω–∏—Ü—ã?¬ª  
‚Ä¢ ¬´–°—Ç–æ–∏—Ç –ª–∏ –º–Ω–µ –º–µ–Ω—è—Ç—å —Ä–∞–±–æ—Ç—É –≤ —ç—Ç–æ–º –º–µ—Å—è—Ü–µ?¬ª
‚Ä¢ ¬´–ë—É–¥–µ—Ç –ª–∏ —É—Å–ø–µ—à–Ω–æ–π –º–æ—è –ø–æ–µ–∑–¥–∫–∞?¬ª

–ß–µ–º –∫–æ–Ω–∫—Ä–µ—Ç–Ω–µ–µ –≤–æ–ø—Ä–æ—Å - —Ç–µ–º –≥–ª—É–±–∂–µ –∞–Ω–∞–ª–∏–∑!"""
            return False, full_message
        
        return True, "–í–æ–ø—Ä–æ—Å –ø—Ä–∏–Ω—è—Ç –∫ –∞–Ω–∞–ª–∏–∑—É"
    
    def analyze_question_type(self, question):
        question_lower = question.lower()
        if any(word in question_lower for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥', '—Ä—É–±–ª', '–µ–≤—Ä–æ', '–¥–æ–ª–ª–∞—Ä']):
            return "–§–ò–ù–ê–ù–°–´", "üí∞"
        elif any(word in question_lower for word in ['–ª—é–±–∏—Ç', '—Å–∫—É—á', '–æ—Ç–Ω–æ—à–µ–Ω', '–±—Ä–∞–∫', '–∑–∞–º—É–∂', '–≤—Å—Ç—Ä–µ—á', '–ø–∞—Ä–µ–Ω—å', '–º—É–∂—á–∏–Ω']):
            return "–û–¢–ù–û–®–ï–ù–ò–Ø", "üíñ" 
        elif any(word in question_lower for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä', '–¥–æ–ª–∂–Ω–æ—Å—Ç', '–±–∏–∑–Ω–µ—Å', '–ø—Ä–æ–µ–∫—Ç']):
            return "–ö–ê–†–¨–ï–†–ê", "üöÄ"
        elif any(word in question_lower for word in ['–∑–¥–æ—Ä–æ–≤', '–±–æ–ª–µ–∑', '–ª–µ—á–µ–Ω', '–≤—Ä–∞—á', '–±–æ–ª—å–Ω–∏—Ü']):
            return "–ó–î–û–†–û–í–¨–ï", "üè•"
        elif any(word in question_lower for word in ['–ø–æ–µ–∑–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤', '–ø–µ—Ä–µ–µ–∑–¥', '–æ—Ç–ø—É—Å–∫']):
            return "–ü–£–¢–ï–®–ï–°–¢–í–ò–Ø", "‚úàÔ∏è"
        else:
            return "–û–ë–©–ò–ô", "üîÆ"

bot_brain = HoraryBrain()

def get_moscow_time():
    # –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø –í–ï–†–°–ò–Ø - –±–µ–∑ deprecated —Ñ—É–Ω–∫—Ü–∏–∏
    utc_time = datetime.now(timezone.utc)
    moscow_time = utc_time + timedelta(hours=3)
    return moscow_time.strftime('%H:%M, %d.%m.%Y')

def get_russian_zodiac(eng_sign):
    zodiac_map = {
        'Aries': '–û–≤–µ–Ω', 'Taurus': '–¢–µ–ª–µ—Ü', 'Gemini': '–ë–ª–∏–∑–Ω–µ—Ü—ã',
        'Cancer': '–†–∞–∫', 'Leo': '–õ–µ–≤', 'Virgo': '–î–µ–≤–∞',
        'Libra': '–í–µ—Å—ã', 'Scorpio': '–°–∫–æ—Ä–ø–∏–æ–Ω', 'Sagittarius': '–°—Ç—Ä–µ–ª–µ—Ü',
        'Capricorn': '–ö–æ–∑–µ—Ä–æ–≥', 'Aquarius': '–í–æ–¥–æ–ª–µ–π', 'Pisces': '–†—ã–±—ã'
    }
    return zodiac_map.get(eng_sign, eng_sign)

# –û–ë–†–ê–ë–û–¢–ö–ê –ì–†–£–ü–ü - –ò–°–ü–†–ê–í–õ–ï–ù–ù–ê–Ø
@bot.message_handler(chat_types=['supergroup', 'group'])
def handle_group_message(message):
    try:
        if message.text and ('@HoraryEmperorBot' in message.text or '–ò–º–ø–µ—Ä–∞—Ç–æ—Ä' in message.text):
            question = message.text.replace('@HoraryEmperorBot', '').replace('–ò–º–ø–µ—Ä–∞—Ç–æ—Ä', '').strip()
            if question and len(question) > 3:
                # –ü–†–û–í–ï–†–Ø–ï–ú –õ–ï–ì–ò–¢–ò–ú–ù–û–°–¢–¨
                is_legitimate, legitimacy_message = bot_brain.analyze_question_legitimacy(question)
                
                if not is_legitimate:
                    bot.reply_to(message, legitimacy_message)
                    return
                
                # –ï–°–õ–ò –í–û–ü–†–û–° –õ–ï–ì–ò–¢–ò–ú–ï–ù - –ê–ù–ê–õ–ò–ó
                analysis = get_detailed_analysis(question)
                bot.reply_to(message, analysis)
    except Exception as e:
        print(f"–û—à–∏–±–∫–∞ –≤ –≥—Ä—É–ø–ø–µ: {e}")

# –õ–ò–ß–ù–´–ï –°–û–û–ë–©–ï–ù–ò–Ø
@bot.message_handler(func=lambda message: True)
def handle_message(message):
    if message.text.startswith('/'):
        if message.text == '/start':
            start_text = """
üîÆ –Ø ‚Äî –•–û–†–ê–†–ù–´–ô –ò–ú–ü–ï–†–ê–¢–û–† —Å –ì–õ–£–ë–ò–ù–ù–´–ú –ê–ù–ê–õ–ò–ó–û–ú!

–Ø –Ω–µ –ø—Ä–æ—Å—Ç–æ –æ—Ç–≤–µ—á–∞—é "–¥–∞/–Ω–µ—Ç". –Ø –ø—Ä–æ–≤–æ–∂—É –ø—Å–∏—Ö–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ —Ç–≤–æ–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∑–≤–µ–∑–¥–Ω—ã—Ö –∫–∞—Ä—Ç.

‚ú® –ß—Ç–æ —è –∞–Ω–∞–ª–∏–∑–∏—Ä—É—é:
‚Ä¢ üíñ –û—Ç–Ω–æ—à–µ–Ω–∏—è: –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª, –≥–ª—É–±–∏–Ω–Ω—ã–µ —Å–≤—è–∑–∏, –∫–∞—Ä–º–∏—á–µ—Å–∫–∏–µ —É—Ä–æ–∫–∏
‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å—ã: –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏, —Å–∫—Ä—ã—Ç—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ 
‚Ä¢ üöÄ –ö–∞—Ä—å–µ—Ä–∞: –ø—Ä–∏–∑–≤–∞–Ω–∏–µ, –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ, —Å–ª–µ–¥—É—é—â–∏–π —É—Ä–æ–≤–µ–Ω—å
‚Ä¢ üåü –õ–∏—á–Ω–æ—Å—Ç–Ω—ã–π —Ä–æ—Å—Ç: —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏, –∏–Ω–∏—Ü–∏–∞—Ü–∏–∏, –Ω–æ–≤—ã–µ —Ä–æ–ª–∏

–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ —Å–≤–æ–µ–π —Å–∏—Ç—É–∞—Ü–∏–∏ ‚Äî –∏ –ø–æ–ª—É—á–∏ –≥–ª—É–±–∏–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑!"""
            bot.reply_to(message, start_text)
        return
    
    try:
        # –ü–†–û–í–ï–†–Ø–ï–ú –õ–ï–ì–ò–¢–ò–ú–ù–û–°–¢–¨ –í–û–ü–†–û–°–ê
        is_legitimate, legitimacy_message = bot_brain.analyze_question_legitimacy(message.text)
        
        if not is_legitimate:
            bot.reply_to(message, legitimacy_message)
            return
        
        # –ï–°–õ–ò –í–û–ü–†–û–° –õ–ï–ì–ò–¢–ò–ú–ï–ù - –î–ï–õ–ê–ï–ú –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó
        display_time = get_moscow_time()
        
        observer = ephem.Observer()
        observer.lat = '55.7558'
        observer.lon = '37.6173'
        
        moon = ephem.Moon()
        sun = ephem.Sun()
        moon.compute(observer)
        sun.compute(observer)
        
        moon_sign = get_russian_zodiac(ephem.constellation(moon)[1])
        sun_sign = get_russian_zodiac(ephem.constellation(sun)[1])
        
        question_type, emoji = bot_brain.analyze_question_type(message.text)
        
        # –ì–õ–£–ë–û–ö–ò–ô –ü–°–ò–•–û–õ–û–ì–ò–ß–ï–°–ö–ò–ô –ê–ù–ê–õ–ò–ó
        verdict, deep_analysis, strategy = bot_brain.psychologist.generate_deep_analysis(
            message.text, moon_sign, sun_sign, question_type
        )
        
        response = f"""
üîÆ –ì–õ–£–ë–ò–ù–ù–´–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó
‚è∞ {display_time}, –ú–û–°–ö–í–ê

‚ùì –í–û–ü–†–û–°: {message.text}
üéØ –¢–ò–ü: {question_type} {emoji}

üìä –ö–ê–†–¢–ê –°–£–î–¨–ë–´:
‚Ä¢ üåô –õ—É–Ω–∞ –≤ {moon_sign} - —Ç–≤–æ—è —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è –ø—Ä–∏—Ä–æ–¥–∞
‚Ä¢ ‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ –≤ {sun_sign} - —Ç–≤–æ–µ –∏—Å—Ç–∏–Ω–Ω–æ–µ —è

‚ö° –í–ï–†–î–ò–ö–¢: {verdict}

üí´ –ì–õ–£–ë–ò–ù–ù–´–ô –ê–ù–ê–õ–ò–ó:
{deep_analysis}

üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:
{strategy}

‚ú® –£—Ä–æ–≤–µ–Ω—å –∞–Ω–∞–ª–∏–∑–∞: {bot_brain.experience + 1}
"""
        bot.reply_to(message, response)
        bot_brain.experience += 1
        
    except Exception as e:
        bot.reply_to(message, f"‚ùå –û—à–∏–±–∫–∞ –≥–ª—É–±–∏–Ω–Ω–æ–≥–æ –∞–Ω–∞–ª–∏–∑–∞: {str(e)}")

def get_detailed_analysis(question):
    """–§—É–Ω–∫—Ü–∏—è –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞ –≤ –≥—Ä—É–ø–ø–∞—Ö"""
    display_time = get_moscow_time()
    
    observer = ephem.Observer()
    observer.lat = '55.7558'
    observer.lon = '37.6173'
    
    moon = ephem.Moon()
    sun = ephem.Sun()
    moon.compute(observer)
    sun.compute(observer)
    
    moon_sign = get_russian_zodiac(ephem.constellation(moon)[1])
    sun_sign = get_russian_zodiac(ephem.constellation(sun)[1])
    
    question_type, emoji = bot_brain.analyze_question_type(question)
    
    # –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó –î–õ–Ø –ì–†–£–ü–ü
    verdict, deep_analysis, strategy = bot_brain.psychologist.generate_deep_analysis(
        question, moon_sign, sun_sign, question_type
    )
    
    return f"""
üîÆ –ì–õ–£–ë–ò–ù–ù–´–ô –ê–ù–ê–õ–ò–ó –û–¢ –ò–ú–ü–ï–†–ê–¢–û–†–ê
‚è∞ {display_time}

‚ùì –í–û–ü–†–û–°: {question}
üéØ –¢–ò–ü: {question_type} {emoji}

üìä –ö–ê–†–¢–ê:
‚Ä¢ üåô –õ—É–Ω–∞: {moon_sign}
‚Ä¢ ‚òÄÔ∏è –°–æ–ª–Ω—Ü–µ: {sun_sign}

‚ö° –í–ï–†–î–ò–ö–¢: {verdict}

üí´ –ê–ù–ê–õ–ò–ó:
{deep_analysis}

üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:
{strategy}

‚ú® @HoraryEmperorBot
"""

print("üîÑ –•–û–†–ê–†–ù–´–ô –ò–ú–ü–ï–†–ê–¢–û–† —Å –ì–õ–£–ë–ò–ù–ù–´–ú –ê–ù–ê–õ–ò–ó–û–ú –∑–∞–ø—É—â–µ–Ω...")
print("üåê HTTP-—Å–µ—Ä–≤–µ—Ä –∑–¥–æ—Ä–æ–≤—å—è —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000")

# –ó–∞–ø—É—Å–∫–∞–µ–º –±–æ—Ç–∞ —Å –æ–±—Ä–∞–±–æ—Ç–∫–æ–π –æ—à–∏–±–æ–∫
while True:
    try:
        print("üîó –ü–æ–¥–∫–ª—é—á–∞–µ–º—Å—è –∫ Telegram...")
        bot.remove_webhook()
        bot.polling(none_stop=True, timeout=60)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: {e}")
        print("üîÑ –ü–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–∞–µ–º—Å—è —á–µ—Ä–µ–∑ 10 —Å–µ–∫—É–Ω–¥...")
        time.sleep(10)
