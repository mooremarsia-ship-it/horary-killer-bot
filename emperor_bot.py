import telebot
import time
import random
import json
import os
from datetime import datetime, timedelta, timezone
from flask import Flask
import threading
import requests

print("üåå –ó–∞–ø—É—Å–∫–∞—é –°–û–í–ï–†–®–ï–ù–ù–û–ì–û –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")

# –¢–æ–∫–µ–Ω –±–æ—Ç–∞
BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"

# –£–¥–∞–ª—è–µ–º –≤–µ–±—Ö—É–∫–∏
try:
    response = requests.get(f"https://api.telegram.org/bot{BOT_TOKEN}/deleteWebhook")
    print("‚úÖ –í–µ–±—Ö—É–∫–∏ —É–¥–∞–ª–µ–Ω—ã")
    time.sleep(2)
except:
    print("‚úÖ –í–µ–±—Ö—É–∫–æ–≤ –Ω–µ –±—ã–ª–æ")

bot = telebot.TeleBot(BOT_TOKEN)

# Flask
app = Flask(__name__)
@app.route('/')
def home():
    return "üí´ –°–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

def run_flask():
    app.run(host='0.0.0.0', port=5000, debug=False)

flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

class PerfectEmperor:
    def __init__(self):
        print("üîÆ –°–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω!")
        self.memory_file = 'perfect_memory.json'
        self.load_memory()
    
    def load_memory(self):
        """–ó–∞–≥—Ä—É–∂–∞–µ–º –ø–∞–º—è—Ç—å"""
        try:
            if os.path.exists(self.memory_file):
                with open(self.memory_file, 'r', encoding='utf-8') as f:
                    self.memory = json.load(f)
                print(f"üß† –ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(self.memory)} –∑–∞–ø–∏—Å–µ–π")
        except:
            self.memory = {}
    
    def save_memory(self):
        """–°–æ—Ö—Ä–∞–Ω—è–µ–º –ø–∞–º—è—Ç—å"""
        try:
            with open(self.memory_file, 'w', encoding='utf-8') as f:
                json.dump(self.memory, f, ensure_ascii=False, indent=2)
        except:
            pass
    
    def learn_interaction(self, question, response_type, user_id):
        """–£—á–∏–º—Å—è –Ω–∞ –∫–∞–∂–¥–æ–º –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–∏"""
        key = f"{user_id}_{question[:20].lower()}"
        self.memory[key] = {
            'question': question,
            'response_type': response_type,
            'timestamp': datetime.now().isoformat(),
            'count': self.memory.get(key, {}).get('count', 0) + 1
        }
        self.save_memory()
        print(f"üß† –í—ã—É—á–∏–ª: {question[:30]}...")

    def is_greeting_or_command(self, text):
        """–†–∞—Å–ø–æ–∑–Ω–∞–µ–º –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã"""
        text_lower = text.lower().strip()
        
        greetings = [
            '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä', '–±–æ—Ç', '–ø—Ä–∏–≤–µ—Ç', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π', '—Ö–∞–π', '—Å–∞–ª—é—Ç',
            'start', 'help', '/start', '/help', '–Ω–∞—á–∞—Ç—å', '–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ',
            '–¥–æ–±—Ä—ã–π –¥–µ–Ω—å', '–¥–æ–±—Ä—ã–π –≤–µ—á–µ—Ä', '–¥–æ–±—Ä–æ–µ —É—Ç—Ä–æ', 'hi', 'hello',
            '–∫—É', '—Å–∞–ª–∞–º', '–ø—Ä–∏–≤', '–ø—Ä–∏–≤–µ—Ç–∏–∫', '—Ö–æ—Ä–∞—Ä–Ω—ã–π'
        ]
        
        return text_lower in greetings

    def is_private_request(self, text):
        """–†–∞—Å–ø–æ–∑–Ω–∞–µ–º –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –ª–∏—á–Ω–æ–µ"""
        text_lower = text.lower().strip()
        return text_lower.startswith(('–ª–∏—á–Ω–æ–µ', '–ø—Ä–∏–≤–∞—Ç–Ω–æ', '–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ', '–≤ –ª—Å', '–≤ –ª–∏—á–∫—É'))

    def is_small_talk(self, text):
        """–†–∞—Å–ø–æ–∑–Ω–∞–µ–º –ø—É—Å—Ç—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã"""
        text_lower = text.lower().strip()
        small_talk = [
            '–∫–∞–∫ –¥–µ–ª–∞', '–∫–∞–∫ —Ç—ã', '—á—Ç–æ –¥–µ–ª–∞–µ—à—å', '–∫–∞–∫ –∂–∏–∑–Ω—å', 
            '–∫–∞–∫ —Å–∞–º', '–∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ', '—á–µ–º –∑–∞–Ω—è—Ç'
        ]
        return any(phrase in text_lower for phrase in small_talk)

    def is_real_question(self, text):
        """–ü—Ä–æ–≤–µ—Ä—è–µ–º –Ω–∞—Å—Ç–æ—è—â–∏–π –ª–∏ –≤–æ–ø—Ä–æ—Å"""
        text_lower = text.lower().strip()
        
        if self.is_greeting_or_command(text_lower) or self.is_small_talk(text_lower):
            return False
            
        if len(text_lower) < 4:
            return False
            
        question_keywords = [
            '–∫–æ–≥–¥–∞', '—á—Ç–æ', '–∫–∞–∫', '–ø–æ—á–µ–º—É', '–∑–∞—á–µ–º', '–±—É–¥–µ—Ç', '–µ—Å—Ç—å', '–±—É–¥–µ—Ç –ª–∏',
            '–º–Ω–µ', '–º–µ–Ω—è', '–º–æ–π', '–º–æ—è', '–º–æ–µ', '–º–æ–∏', 
            '–ª—é–±–æ–≤—å', '–¥–µ–Ω—å–≥–∏', '–æ—Ç–Ω–æ—à–µ–Ω–∏—è', '—Ä–∞–±–æ—Ç–∞', '–±—É–¥—É—â–µ–µ', '—Å—É–¥—å–±–∞',
            '–≤—Å—Ç—Ä–µ—á—É', '–ø–æ–ª—É—á—É', '–∏–∑–º–µ–Ω–∏—Ç—Å—è', '–ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç', '–∂–¥—É—Ç',
            '–º–∏—Ö–∞–∏–ª', '–º–∏—à–∞', '–ø–µ—Ä–µ–µ–∑–¥', '–ø—É—Ç–µ—à–µ—Å—Ç–≤–∏–µ', '—Ñ–∏–Ω–∞–Ω—Å—ã', '–∫–∞—Ä—å–µ—Ä–∞',
            '–∑–¥–æ—Ä–æ–≤—å–µ', '—Å–µ–º—å—è', '–¥–µ—Ç–∏', '–±—Ä–∞–∫', '–∑–∞–º—É–∂–µ—Å—Ç–≤–æ', '–∂–µ–Ω–∏—Ç—å–±–∞'
        ]
        
        has_keywords = any(keyword in text_lower for keyword in question_keywords)
        has_question_mark = '?' in text_lower
        
        return has_keywords or has_question_mark

    def analyze_question_intent(self, question):
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –Ω–∞–º–µ—Ä–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–∞"""
        question_lower = question.lower()
        
        if any(word in question_lower for word in ['–ª—é–±–æ–≤', '–æ—Ç–Ω–æ—à–µ–Ω', '—á—É–≤—Å—Ç–≤–∞', '–≤—Å—Ç—Ä–µ—á', '–ø–∞—Ä–µ–Ω—å']):
            if '–¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞' in question_lower:
                return "LOVE_YEAR_END"
            elif '–¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è' in question_lower:
                return "LOVE_NOVEMBER"
            else:
                return "LOVE_GENERAL"
        
        elif any(word in question_lower for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥']):
            if '–ø–µ—Ä–µ–µ–∑–¥' in question_lower:
                return "MONEY_TRAVEL"
            else:
                return "MONEY_GENERAL"
        
        elif any(word in question_lower for word in ['—Ä–∞–±–æ—Ç', '–∫–∞—Ä—å–µ—Ä']):
            return "CAREER"
        
        elif any(word in question_lower for word in ['–∑–¥–æ—Ä–æ–≤', '–±–æ–ª–µ–∑']):
            return "HEALTH"
        
        else:
            return "DEEP_GENERAL"

    def generate_deep_analysis(self, question, intent):
        """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ì–õ–£–ë–û–ö–ò–ô –∞–Ω–∞–ª–∏–∑"""
        current_time = datetime.now(timezone.utc) + timedelta(hours=3)
        time_str = current_time.strftime('%H:%M, %d %B %Y')
        
        if intent == "LOVE_YEAR_END":
            return self._deep_love_yearend(question, time_str)
        elif intent == "LOVE_NOVEMBER":
            return self._deep_love_november(question, time_str)
        elif intent == "LOVE_GENERAL":
            return self._deep_love_general(question, time_str)
        elif intent == "MONEY_TRAVEL":
            return self._deep_money_travel(question, time_str)
        elif intent == "MONEY_GENERAL":
            return self._deep_money_general(question, time_str)
        elif intent == "CAREER":
            return self._deep_career_analysis(question, time_str)
        else:
            return self._deep_universal_analysis(question, time_str)

    def _deep_universal_analysis(self, question, time_str):
        """–£–ù–ò–í–ï–†–°–ê–õ–¨–ù–´–ô –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑"""
        analysis = f"""
*üåå –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å –∏—Å–∫–∞—Ç–µ–ª—è:* ¬´{question}¬ª

---

*ü™ê –¢–ï–ö–£–©–ê–Ø –ü–õ–ê–ù–ï–¢–ê–†–ù–ê–Ø –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø:*

‚Ä¢ *–°–æ–ª–Ω—Ü–µ –≤ –°–∫–æ—Ä–ø–∏–æ–Ω–µ* (12¬∞45') - –∏–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ—Å—Ç—å –∏ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* (8¬∞22') - —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ —á—É–≤—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å  
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* (5¬∞18') - —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–µ —Å–æ–∑–Ω–∞–Ω–∏–µ
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* (22¬∞10') - –≥–∞—Ä–º–æ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ú–∞—Ä—Å –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* (3¬∞45') - —Ü–µ–ª–µ—É—Å—Ç—Ä–µ–º–ª–µ–Ω–Ω–æ—Å—Ç—å

---

*üîç –î–ï–¢–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó –ê–°–ü–ï–ö–¢–û–í:*

*üåà –õ–ò–ß–ù–´–ï –û–¢–ù–û–®–ï–ù–ò–Ø:*
‚Ä¢ *–õ—É–Ω–∞ –¥–µ–ª–∞–µ—Ç —Ç—Ä–∏–Ω –∫ –í–µ–Ω–µ—Ä–µ* - –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω–æ –¥–ª—è –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ *–ú–µ—Ä–∫—É—Ä–∏–π –∫–≤–∞–¥—Ä–∞—Ç –ù–µ–ø—Ç—É–Ω* - –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ—Å—Ç—å –≤ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ù–∞—á–∞–ª–æ –¥–Ω—è —Ç—Ä–µ–±—É–µ—Ç —è—Å–Ω–æ—Å—Ç–∏ –≤ –æ–±—â–µ–Ω–∏–∏

*üí∞ –§–ò–ù–ê–ù–°–´ –ò –ü–†–û–§–ï–°–°–ò–Ø:*
‚Ä¢ *–°–æ–ª–Ω—Ü–µ —Å–µ–∫—Å—Ç–∏–ª—å –Æ–ø–∏—Ç–µ—Ä* - —É–¥–∞—á–∞ –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –¥–µ–ª–∞—Ö
‚Ä¢ *–ú–∞—Ä—Å —Ç—Ä–∏–Ω –£—Ä–∞–Ω* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–µ–π—Å—Ç–≤–∏–π
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –ü–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏, –≤—Ä–µ–º—è –¥–ª—è —Å–º–µ–ª—ã—Ö —Ä–µ—à–µ–Ω–∏–π

*üåå –î–£–•–û–í–ù–û–ï –†–ê–ó–í–ò–¢–ò–ï:*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –æ–ø–ø–æ–∑–∏—Ü–∏–∏ —Å –ü–ª—É—Ç–æ–Ω–æ–º* - –≥–ª—É–±–æ–∫–∏–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø—Ä–æ—Ü–µ—Å—Å—ã
‚Ä¢ *–õ—É–Ω–∞ –∫–≤–∞–¥—Ä–∞—Ç –ü–ª—É—Ç–æ–Ω* - —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è —á–µ—Ä–µ–∑ —ç–º–æ—Ü–∏–∏
‚Ä¢ *–≠–Ω–µ—Ä–≥–∏—è:* –í—Ä–µ–º—è –¥–ª—è –∏–Ω—Ç—Ä–æ—Å–ø–µ–∫—Ü–∏–∏ –∏ –≥–ª—É–±–æ–∫–∏—Ö —Ä–∞–∑–º—ã—à–ª–µ–Ω–∏–π
"""
        
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*
*üéØ –ì–ï–ù–ò–ê–õ–¨–ù–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*

*üåÖ –£–¢–†–ï–ù–ù–ò–ô –†–ò–¢–£–ê–õ:*
‚Ä¢ –ú–µ–¥–∏—Ç–∞—Ü–∏—è –Ω–∞ —è—Å–Ω–æ—Å—Ç—å –º—ã—Å–ª–µ–π (5-10 –º–∏–Ω—É—Ç)
‚Ä¢ –ü–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–Ω—è —Å —É—á–µ—Ç–æ–º –ø–ª–∞–Ω–µ—Ç–∞—Ä–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
‚Ä¢ –ó–µ–ª–µ–Ω—ã–π —á–∞–π –¥–ª—è –∞–∫—Ç–∏–≤–∞—Ü–∏–∏ –ú–µ—Ä–∫—É—Ä–∏—è

*üèô –î–ù–ï–í–ù–ê–Ø –ê–ö–¢–ò–í–ù–û–°–¢–¨:*
‚Ä¢ –†–µ—à–µ–Ω–∏–µ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ (9:00-11:00)
‚Ä¢ –¢–≤–æ—Ä—á–µ—Å–∫–∏–µ –∑–∞–¥–∞—á–∏ –∏ –º–æ–∑–≥–æ–≤—ã–µ —à—Ç—É—Ä–º—ã (11:00-13:00)
‚Ä¢ –í–∞–∂–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏ (14:00-16:00)
‚Ä¢ –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ —Ä–∞–±–æ—á–∏—Ö –ø—Ä–æ–µ–∫—Ç–æ–≤ (16:00-18:00)

*üåÉ –í–ï–ß–ï–†–ù–ò–ô –û–¢–î–´–•:*
‚Ä¢ –°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å –∏–ª–∏ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –≤—Å—Ç—Ä–µ—á–∏ (19:00-21:00)
‚Ä¢ –í—Ä–µ–º—è –¥–ª—è —Å–∞–º–æ—Ä–∞–∑–≤–∏—Ç–∏—è –∏ –æ–±—É—á–µ–Ω–∏—è (21:00-23:00)
‚Ä¢ –û—Ç–¥—ã—Ö –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫–æ —Å–Ω—É (23:00+)

*üíé –û–°–û–ë–´–ï –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò:*
‚Ä¢ –ù–æ—Å–∏—Ç–µ –±–∏—Ä—é–∑–æ–≤—ã–π —Ü–≤–µ—Ç –¥–ª—è –≥–∞—Ä–º–æ–Ω–∏–∑–∞—Ü–∏–∏ —ç–Ω–µ—Ä–≥–∏–∏
‚Ä¢ –ò–∑–±–µ–≥–∞–π—Ç–µ –≤–∞–∂–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π –≤ –ø–µ—Ä–∏–æ–¥ 13:00-14:00
‚Ä¢ –ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π —Å—Ñ–µ—Ä–µ

*üîÆ –ú–ê–ù–¢–†–ê –î–ù–Ø:* 
¬´–Ø –ø—Ä–∏–Ω–∏–º–∞—é –ø–æ—Ç–æ–∫ –∏–∑–æ–±–∏–ª–∏—è –∏ —Å–ª–µ–¥—É—é –∑–æ–≤—É —Å–µ—Ä–¥—Ü–∞¬ª"""

        return analysis, strategy

    def _deep_love_yearend(self, question, time_str):
        """–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞"""
        analysis = f"""
*üíñ –ì–õ–£–ë–û–ö–ò–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò –î–û –ö–û–ù–¶–ê –ì–û–î–ê*

*–í—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞:* {time_str}
*–í–æ–ø—Ä–æ—Å —Å–µ—Ä–¥—Ü–∞:* ¬´{question}¬ª

---

*‚ùÑÔ∏è –ó–ò–ú–ù–ò–ï –ó–í–ï–ó–î–ù–´–ï –í–õ–ò–Ø–ù–ò–Ø:*

‚ú® *–î–ï–ö–ê–ë–†–¨:*
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* - —Å–µ—Ä—å–µ–∑–Ω—ã–µ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –≤ –ª—é–±–≤–∏
‚Ä¢ *–°–æ–ª–Ω–µ—á–Ω–æ–µ –∑–∞—Ç–º–µ–Ω–∏–µ 14 –¥–µ–∫–∞–±—Ä—è* - —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏
‚Ä¢ *–Æ–ø–∏—Ç–µ—Ä –≤ –í–æ–¥–æ–ª–µ–µ* - –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–µ —Ä–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ —Å–≤—è–∑–∏

‚ú® *–Ø–ù–í–ê–†–¨:*
‚Ä¢ *–ú–∞—Ä—Å –≤ –°—Ç—Ä–µ–ª—å—Ü–µ* - —Å—Ç—Ä–∞—Å—Ç—å –∏ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ *–£—Ä–∞–Ω –¥–∏—Ä–µ–∫—Ç–Ω—ã–π* - –≤–Ω–µ–∑–∞–ø–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ü–ª—É—Ç–æ–Ω –≤ –ö–æ–∑–µ—Ä–æ–≥–µ* - –≥–ª—É–±–æ–∫–∏–µ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏

---

*üîÆ –ü–†–û–ì–ù–û–ó –î–û –ö–û–ù–¶–ê –ì–û–î–ê:*

*–ö–ª—é—á–µ–≤—ã–µ –ø–µ—Ä–∏–æ–¥—ã:*
‚Ä¢ *1-15 –¥–µ–∫–∞–±—Ä—è:* –í—Ä–µ–º—è —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π –∏ –æ–±—è–∑–∞—Ç–µ–ª—å—Å—Ç–≤
‚Ä¢ *–ù–æ–≤–æ–≥–æ–¥–Ω–∏–µ –ø—Ä–∞–∑–¥–Ω–∏–∫–∏:* –†–æ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∏–µ –ø—Ä–∏–∫–ª—é—á–µ–Ω–∏—è
‚Ä¢ *–Ø–Ω–≤–∞—Ä—å 2026:* –ù–æ–≤—ã–µ –Ω–∞—á–∞–ª–∞ –≤ –ª–∏—á–Ω–æ–π –∂–∏–∑–Ω–∏

*–í–µ—Ä–æ—è—Ç–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è:*
‚Ä¢ –ó–Ω–∞–∫–æ–º—Å—Ç–≤–æ —Å –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–º –ø–∞—Ä—Ç–Ω–µ—Ä–æ–º –¥–ª—è –¥–æ–ª–≥–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏–π
‚Ä¢ –£–∫—Ä–µ–ø–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–µ–≥–æ —Å–æ—é–∑–∞
‚Ä¢ –ì–ª—É–±–æ–∫–æ–µ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –∏—Å—Ü–µ–ª–µ–Ω–∏–µ
"""
        
        strategy = """*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø –î–û –ö–û–ù–¶–ê –ì–û–î–ê:*

‚Ä¢ *–°—Ñ–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —Å–µ—Ä—å–µ–∑–Ω—ã—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö* - –≤—Ä–µ–º—è –¥–ª—è –≥–ª—É–±–∏–Ω—ã
‚Ä¢ *–ë—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞–º* –≤ –¥–µ–∫–∞–±—Ä–µ
‚Ä¢ *–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ –¥–æ–≤–µ—Ä–∏–µ–º* –≤ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ *–ì–æ—Ç–æ–≤—å—Ç–µ—Å—å –∫ —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—è–º* –≤ —è–Ω–≤–∞—Ä–µ

*üîÆ –†–ò–¢–£–ê–õ –ù–ê –ó–ò–ú–ù–ï–ï –°–û–õ–ù–¶–ï–°–¢–û–Ø–ù–ò–ï:*
*21 –¥–µ–∫–∞–±—Ä—è –Ω–∞–ø–∏—à–∏—Ç–µ –ø–∏—Å—å–º–æ –í—Å–µ–ª–µ–Ω–Ω–æ–π —Å –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç—å—é –∑–∞ –ª—é–±–æ–≤—å –∏ –ø–æ–ø—Ä–æ—Å–∏—Ç–µ —Ç–æ, —á—Ç–æ –∂–µ–ª–∞–µ—Ç —Å–µ—Ä–¥—Ü–µ.*"""

        return analysis, strategy

    def get_greeting(self):
        return random.choice([
            "üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ò—Å–∫–∞—Ç–µ–ª—å!* –° –∫–∞–∫–∏–º –≤–æ–ø—Ä–æ—Å–æ–º —Ç—ã –ø—Ä–∏—à—ë–ª –∫–æ –º–Ω–µ —Å–µ–≥–æ–¥–Ω—è?",
            "‚ú® *–ü—Ä–µ–¥ –ª–∏–∫–æ–º –í–µ—á–Ω–æ—Å—Ç–∏ —Å–∫–ª–æ–Ω–∏—Å—å, –ü—É—Ç–Ω–∏–∫!* –ö–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–µ–ª —Ç–µ–±—è –≤ –º–æ–∏ —á–µ—Ä—Ç–æ–≥–∏?",
            "üîÆ *–í —á–∞—Å, –∫–æ–≥–¥–∞ –∑–≤—ë–∑–¥—ã —à–µ–ø—á—É—Ç —Ç–∞–π–Ω—ã,* —è, –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä, –≤–Ω–∏–º–∞—é —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–∞–º...",
        ])

# –°–æ–∑–¥–∞–µ–º –°–û–í–ï–†–®–ï–ù–ù–û–ì–û –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞
emperor = PerfectEmperor()

@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    chat_type = "private" if message.chat.type == "private" else "group"
    
    greeting = emperor.get_greeting()
    
    if chat_type == "private":
        response = f"""{greeting}

*–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º —Ç–≤–æ–∏–º –≤–æ–ø—Ä–æ—Å–æ–º –∏ —Å—Ç–∞–Ω–æ–≤–ª—é—Å—å –º—É–¥—Ä–µ–µ!* üß†

*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ:*
‚Ä¢ üíñ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å–∞—Ö –∏ –∏–∑–æ–±–∏–ª–∏–∏  
‚Ä¢ üíº –ö–∞—Ä—å–µ—Ä–µ –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–∏
‚Ä¢ üåå –ë—É–¥—É—â–µ–º –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è—Ö

*–ò–ª–∏ –ø—Ä–æ—Å—Ç–æ –Ω–∞—á–Ω–∏ –æ–±—â–µ–Ω–∏–µ - —è –Ω–∞—É—á—É—Å—å –ø–æ–Ω–∏–º–∞—Ç—å —Ç–µ–±—è –ª—É—á—à–µ!*"""
    else:
        response = f"""{greeting}

*–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –æ–±—â–µ–Ω–∏—è:*

üí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å* (–ø—É–±–ª–∏—á–Ω–æ)
üîí *–ù–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ¬ª* (–ø–µ—Ä–µ–π–¥–µ–º –≤ –õ–° –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏)
üë§ *–ò–ª–∏ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è* (–ø–æ–ª–Ω–∞—è –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç—å)

*–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –õ–°:*
–ù–∞–∂–º–∏ –Ω–∞ –º–æ–µ –∏–º—è @HoraryEmperorBot ‚Üí ¬´–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª

*–ü—Ä–∏–º–µ—Ä—ã –≤–æ–ø—Ä–æ—Å–æ–≤:*
‚Ä¢ ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞?¬ª
‚Ä¢ ¬´–õ–∏—á–Ω–æ–µ¬ª (–¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è)
‚Ä¢ ¬´–ë—É–¥—É—Ç –ª–∏ —É –º–µ–Ω—è –¥–µ–Ω—å–≥–∏ –¥–ª—è –ø–µ—Ä–µ–µ–∑–¥–∞?¬ª"""

    bot.reply_to(message, response, parse_mode='Markdown')

@bot.message_handler(func=lambda message: True)
def handle_all_messages(message):
    try:
        user_id = message.from_user.id
        text = message.text.strip()
        chat_type = "private" if message.chat.type == "private" else "group"
        
        print(f"üí´ –°–æ–æ–±—â–µ–Ω–∏–µ: '{text}'")

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ü–†–û–°–¢–û–ì–û –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –õ–° (–±–µ–∑ –≤–æ–ø—Ä–æ—Å–∞)
        if chat_type in ['group', 'supergroup'] and text.lower() in ['–ª–∏—á–Ω–æ–µ', '–ø—Ä–∏–≤–∞—Ç–Ω–æ', '–≤ –ª—Å']:
            try:
                private_response = f"""üîí *–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å –≤ –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —á–∞—Ç!*

üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è –≤ –ª–∏—á–Ω—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏—è—Ö!*

–¢–µ–ø–µ—Ä—å —Ç—ã –º–æ–∂–µ—à—å –∑–∞–¥–∞—Ç—å –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ:

*–û —á–µ–º —Ö–æ—á–µ—à—å —Å–ø—Ä–æ—Å–∏—Ç—å?*
‚Ä¢ üíñ –õ—é–±–æ–≤—å –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è
‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å—ã –∏ –∏–∑–æ–±–∏–ª–∏–µ  
‚Ä¢ üíº –ö–∞—Ä—å–µ—Ä–∞ –∏ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏–µ
‚Ä¢ üåå –ë—É–¥—É—â–µ–µ –∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

*–ü—Ä–æ—Å—Ç–æ –Ω–∞–ø–∏—à–∏ —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å - –∏ —è –¥–∞–º –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑!*"""
                
                bot.send_message(user_id, private_response, parse_mode='Markdown')
                bot.reply_to(message, "‚úÖ *–ü–µ—Ä–µ—Ö–æ–¥–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è!* üëÜ", parse_mode='Markdown')
                return
            except:
                bot.reply_to(message, "üíå *–°–Ω–∞—á–∞–ª–∞ –Ω–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–°:* @HoraryEmperorBot", parse_mode='Markdown')
                return

        # –û–±—Ä–∞–±–æ—Ç–∫–∞ –ª–∏—á–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –° –í–û–ü–†–û–°–û–ú
        if chat_type in ['group', 'supergroup'] and emperor.is_private_request(text):
            parts = text.split(' ', 1)
            question = parts[1] if len(parts) > 1 else ""
            
            if len(question) > 2:
                try:
                    intent = emperor.analyze_question_intent(question)
                    analysis, strategy = emperor.generate_deep_analysis(question, intent)
                    
                    # –£—á–∏–º—Å—è
                    emperor.learn_interaction(question, intent, user_id)
                    
                    private_response = f"üîí *–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–´–ô –ê–ù–ê–õ–ò–ó*\n\n{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüß† *–Ø —Å—Ç–∞–ª –º—É–¥—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–≤–æ–µ–º—É –≤–æ–ø—Ä–æ—Å—É!*"
                    
                    bot.send_message(user_id, private_response, parse_mode='Markdown')
                    bot.reply_to(message, "‚úÖ *–ì–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è!* üß†", parse_mode='Markdown')
                    return
                except Exception as e:
                    print(f"‚ùå –û—à–∏–±–∫–∞ –õ–°: {e}")
                    bot.reply_to(message, "üíå *–ù–∞–ø–∏—à–∏ –º–Ω–µ –≤ –õ–°:* @HoraryEmperorBot", parse_mode='Markdown')
                    return

        # –ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è –∏ –∫–æ–º–∞–Ω–¥—ã
        if emperor.is_greeting_or_command(text):
            greeting = emperor.get_greeting()
            response = f"{greeting}\n\n*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ –ª—é–±–≤–∏, –¥–µ–Ω—å–≥–∞—Ö –∏–ª–∏ –±—É–¥—É—â–µ–º - –∏ —è –¥–∞–º –≥–ª—É–±–æ–∫–∏–π –∞–Ω–∞–ª–∏–∑!* üåå"
            bot.reply_to(message, response, parse_mode='Markdown')
            return
            
        # –ü—É—Å—Ç—ã–µ —Ä–∞–∑–≥–æ–≤–æ—Ä—ã
        elif emperor.is_small_talk(text):
            response = """ü§î *–Ø –∑–¥–µ—Å—å —á—Ç–æ–±—ã –æ—Ç–∫—Ä—ã–≤–∞—Ç—å —Ç–∞–π–Ω—ã –∑–≤–µ–∑–¥, –∞ –Ω–µ –æ–±—Å—É–∂–¥–∞—Ç—å –ø–æ–≥–æ–¥—É!* üåå

*–ó–∞–¥–∞–π –Ω–∞—Å—Ç–æ—è—â–∏–π –≤–æ–ø—Ä–æ—Å –æ:*
‚Ä¢ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ –§–∏–Ω–∞–Ω—Å–∞—Ö –∏ –∏–∑–æ–±–∏–ª–∏–∏  
‚Ä¢ –ö–∞—Ä—å–µ—Ä–µ –∏ –±—É–¥—É—â–µ–º

*–ü—Ä–∏–º–µ—Ä:* ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –≥–æ–¥–∞?¬ª
*–ò–ª–∏:* ¬´–õ–∏—á–Ω–æ–µ¬ª (–¥–ª—è –ø—Ä–∏–≤–∞—Ç–Ω–æ–≥–æ –æ–±—â–µ–Ω–∏—è)"""
            bot.reply_to(message, response, parse_mode='Markdown')
            return
            
        # –ù–µ –≤–æ–ø—Ä–æ—Å—ã
        elif not emperor.is_real_question(text):
            response = """üîÆ *–Ø –Ω–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª —Ç–≤–æ–π –∑–∞–ø—Ä–æ—Å...*

*–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –æ:*
‚Ä¢ üíñ –õ—é–±–≤–∏ –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö
‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å–∞—Ö –∏ –¥–µ–Ω—å–≥–∞—Ö
‚Ä¢ üíº –ö–∞—Ä—å–µ—Ä–µ –∏ –±—É–¥—É—â–µ–º

*–ò–ª–∏ –Ω–∞–ø–∏—à–∏:* ¬´–õ–∏—á–Ω–æ–µ¬ª (–¥–ª—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –≤ –ø—Ä–∏–≤–∞—Ç–Ω—ã–π —á–∞—Ç)
*–ü—Ä–∏–º–µ—Ä:* ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –∫–∞—Ä—å–µ—Ä–µ?¬ª"""
            bot.reply_to(message, response, parse_mode='Markdown')
            return
            
        # –ù–ê–°–¢–û–Ø–©–ò–ï –í–û–ü–†–û–°–´ - –ì–õ–£–ë–û–ö–ò–ô –ê–ù–ê–õ–ò–ó
        else:
            intent = emperor.analyze_question_intent(text)
            analysis, strategy = emperor.generate_deep_analysis(text, intent)
            
            # –£—á–∏–º—Å—è
            emperor.learn_interaction(text, intent, user_id)
            
            if chat_type == "private":
                full_response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüß† *–Ø —Å—Ç–∞–ª –º—É–¥—Ä–µ–µ –±–ª–∞–≥–æ–¥–∞—Ä—è —Ç–≤–æ–µ–º—É –≤–æ–ø—Ä–æ—Å—É!*"
            else:
                full_response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüíå *–î–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ¬ª*\nüß† *–Ø —É—á—É—Å—å —Å –∫–∞–∂–¥—ã–º –≤–æ–ø—Ä–æ—Å–æ–º!*"
            
            bot.reply_to(message, full_response, parse_mode='Markdown')
            
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        bot.reply_to(message, "üîÆ *–í—Ä–µ–º–µ–Ω–Ω—ã–µ –ø–æ–º–µ—Ö–∏... –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑!*", parse_mode='Markdown')

print("‚úÖ –°–û–í–ï–†–®–ï–ù–ù–´–ô –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä –≥–æ—Ç–æ–≤!")
print("üåê Flask —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –ø–æ—Ä—Ç—É 5000")

def perfect_launch():
    while True:
        try:
            print("üí´ –ó–∞–ø—É—Å–∫–∞—é —Å–æ–≤–µ—Ä—à–µ–Ω–Ω—ã–π polling...")
            bot.polling(none_stop=True, interval=2, timeout=60)
        except Exception as e:
            print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
            time.sleep(10)

if __name__ == "__main__":
    perfect_launch()
