import telebot
import time
import random
from datetime import datetime, timedelta, timezone
from flask import Flask
import threading

print("üåå –ó–∞–ø—É—Å–∫–∞—é –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")

app = Flask(__name__)
@app.route('/')
def health_check():
    return "üîÑ –ù–∞—Å—Ç–æ—è—â–∏–π –•–æ—Ä–∞—Ä–Ω—ã–π –ò–º–ø–µ—Ä–∞—Ç–æ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç!", 200

def run_flask():
    app.run(host='0.0.0.0', port=5000, debug=False)

flask_thread = threading.Thread(target=run_flask, daemon=True)
flask_thread.start()

BOT_TOKEN = "7166686748:AAFnyfjq5UsunijP_p8HQiYeKHh3qoAM5RA"
bot = telebot.TeleBot(BOT_TOKEN)

class RealHoraryEmperor:
    def __init__(self):
        print("üîÆ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É—é –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –•–æ—Ä–∞—Ä–Ω–æ–≥–æ –ò–º–ø–µ—Ä–∞—Ç–æ—Ä–∞...")
        self.house_significators = {
            'querent': ['ASC_RULER', 'MOON'],  # 1-–π –¥–æ–º - –°–ø—Ä–∞—à–∏–≤–∞—é—â–∏–π
            'money': ['2ND_RULER', 'VENUS'],   # 2-–π –¥–æ–º - –î–µ–Ω—å–≥–∏
            'love': ['5TH_RULER', 'VENUS'],    # 5-–π –¥–æ–º - –õ—é–±–æ–≤—å
            'health': ['6TH_RULER', 'MARS'],   # 6-–π –¥–æ–º - –ó–¥–æ—Ä–æ–≤—å–µ
            'partner': ['7TH_RULER', 'VENUS'], # 7-–π –¥–æ–º - –ü–∞—Ä—Ç–Ω–µ—Ä
            'career': ['10TH_RULER', 'SUN']    # 10-–π –¥–æ–º - –ö–∞—Ä—å–µ—Ä–∞
        }
    
    def get_mystic_greeting(self):
        greetings = [
            "üåå *–Ø –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤—É—é —Ç–µ–±—è, –ò—Å–∫–∞—Ç–µ–ª—å!* –° –∫–∞–∫–∏–º –≤–æ–ø—Ä–æ—Å–æ–º —Ç—ã –ø—Ä–∏—à—ë–ª –∫–æ –º–Ω–µ —Å–µ–≥–æ–¥–Ω—è?",
            "‚ú® *–ü—Ä–µ–¥ –ª–∏–∫–æ–º –í–µ—á–Ω–æ—Å—Ç–∏ —Å–∫–ª–æ–Ω–∏—Å—å, –ü—É—Ç–Ω–∏–∫!* –ö–∞–∫–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–µ–ª —Ç–µ–±—è –≤ –º–æ–∏ —á–µ—Ä—Ç–æ–≥–∏?",
        ]
        return random.choice(greetings)

    def calculate_horary_chart(self, question_time):
        """–°—Ç—Ä–æ–∏–º —Ö–æ—Ä–∞—Ä–Ω—É—é –∫–∞—Ä—Ç—É –Ω–∞ –≤—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–∞"""
        # –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç –Ω–∞—Å—Ç–æ—è—â–∏–π –∞—Å—Ç—Ä–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Ä–∞—Å—á–µ—Ç
        # –°–µ–π—á–∞—Å –∏—Å–ø–æ–ª—å–∑—É–µ–º —É–ø—Ä–æ—â–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é –¥–ª—è –¥–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏–∏
        
        planets = {
            'SUN': {'sign': 'Scorpio', 'degree': 15, 'aspects': []},
            'MOON': {'sign': 'Taurus', 'degree': 8, 'aspects': ['VENUS']},
            'VENUS': {'sign': 'Libra', 'degree': 22, 'aspects': ['MOON']},
            'MARS': {'sign': 'Capricorn', 'degree': 3, 'aspects': []},
            'JUPITER': {'sign': 'Gemini', 'degree': 18, 'aspects': []},
            'SATURN': {'sign': 'Pisces', 'degree': 12, 'aspects': []},
            'MERCURY': {'sign': 'Sagittarius', 'degree': 7, 'aspects': []}
        }
        
        return planets

    def analyze_aspects(self, planet1, planet2, chart):
        """–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—Å–ø–µ–∫—Ç—ã –º–µ–∂–¥—É –ø–ª–∞–Ω–µ—Ç–∞–º–∏"""
        p1 = chart.get(planet1, {})
        p2 = chart.get(planet2, {})
        
        # –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –∞—Å–ø–µ–∫—Ç
        if planet2 in p1.get('aspects', []) or planet1 in p2.get('aspects', []):
            return "HARMONIOUS"  # –ì–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π –∞—Å–ø–µ–∫—Ç
        else:
            # –í —Ä–µ–∞–ª—å–Ω–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –∑–¥–µ—Å—å –±—É–¥–µ—Ç —Ä–∞—Å—á–µ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤
            return "NO_ASPECT"

    def determine_timing(self, aspect_type):
        """–û–ø—Ä–µ–¥–µ–ª—è–µ–º —Å—Ä–æ–∫–∏ —Å–æ–±—ã—Ç–∏–π –ø–æ —Å–∫–æ—Ä–æ—Å—Ç–∏ –õ—É–Ω—ã"""
        if aspect_type == "HARMONIOUS":
            days = random.randint(1, 14)  # –û—Ç 1 –¥–æ 14 –¥–Ω–µ–π
            return f"{days} –¥–Ω–µ–π"
        else:
            return "—Å—Ä–æ–∫ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω"

    def generate_horary_answer(self, question, question_time):
        """–ì–ï–ù–ï–†–ò–†–£–ï–ú –ù–ê–°–¢–û–Ø–©–ò–ô –•–û–†–ê–†–ù–´–ô –û–¢–í–ï–¢"""
        chart = self.calculate_horary_chart(question_time)
        question_lower = question.lower()
        
        # –û–ü–†–ï–î–ï–õ–Ø–ï–ú –¢–ï–ú–£ –í–û–ü–†–û–°–ê
        if any(word in question_lower for word in ['–ª—é–±–æ–≤', '–æ—Ç–Ω–æ—à–µ–Ω', '—á—É–≤—Å—Ç–≤–∞', '–≤—Å—Ç—Ä–µ—á', '–ø–∞—Ä–µ–Ω—å']):
            return self._analyze_love_question(question, chart, question_time)
        elif any(word in question_lower for word in ['–¥–µ–Ω—å–≥', '—Ñ–∏–Ω–∞–Ω—Å', '–¥–µ–Ω–µ–≥']):
            return self._analyze_money_question(question, chart, question_time)
        elif any(word in question_lower for word in ['–∑–¥–æ—Ä–æ–≤', '–±–æ–ª–µ–∑']):
            return self._analyze_health_question(question, chart, question_time)
        else:
            return self._analyze_general_question(question, chart, question_time)

    def _analyze_love_question(self, question, chart, question_time):
        """–ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò –ø–æ —Ö–æ—Ä–∞—Ä–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º"""
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—Å–ø–µ–∫—Ç—ã –õ—É–Ω—ã –∏ –í–µ–Ω–µ—Ä—ã
        moon_venus_aspect = self.analyze_aspects('MOON', 'VENUS', chart)
        timing = self.determine_timing(moon_venus_aspect)
        
        if moon_venus_aspect == "HARMONIOUS":
            analysis = f"""
*üíñ –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò*

*–í—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–∞:* {question_time}
*–ö–∞—Ä—Ç–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞:* –õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ, –í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö

---

*üîÆ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê:*

‚ú® *–ê–°–ü–ï–ö–¢–´:* 
–õ—É–Ω–∞ –¥–µ–ª–∞–µ—Ç –≥–∞—Ä–º–æ–Ω–∏—á–Ω—ã–π –∞—Å–ø–µ–∫—Ç –∫ –í–µ–Ω–µ—Ä–µ - —ç—Ç–æ –û–ß–ï–ù–¨ –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã–π –∑–Ω–∞–∫!

‚ú® *–°–ò–ì–ù–ò–§–ò–ö–ê–¢–û–†–´:*
‚Ä¢ –°–∏–≥–Ω–∏—Ñ–∏–∫–∞—Ç–æ—Ä –ª—é–±–≤–∏ (–í–µ–Ω–µ—Ä–∞) –≤ —Å–∏–ª—å–Ω–æ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏
‚Ä¢ –õ—É–Ω–∞ –∫–∞–∫ —Å–∏–≥–Ω–∏—Ñ–∏–∫–∞—Ç–æ—Ä —Å–ø—Ä–∞—à–∏–≤–∞—é—â–µ–≥–æ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –í–µ–Ω–µ—Ä—É
‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –æ—Ç –°–∞—Ç—É—Ä–Ω–∞ –∏–ª–∏ –ú–∞—Ä—Å–∞

---

*üí´ –•–û–†–ê–†–ù–´–ô –í–ï–†–î–ò–ö–¢:*

*–î–ê, –ª—é–±–æ–≤–Ω—ã–µ –ø–µ—Ä—Å–ø–µ–∫—Ç–∏–≤—ã –±–ª–∞–≥–æ–ø—Ä–∏—è—Ç–Ω—ã!* 

–ß—É–≤—Å—Ç–≤–∞ –≤–∑–∞–∏–º–Ω—ã –∏–ª–∏ —Å–∫–æ—Ä–æ —Å—Ç–∞–Ω—É—Ç —Ç–∞–∫–æ–≤—ã–º–∏. –í—Å—Ç—Ä–µ—á–∞ —Å –∏–Ω—Ç–µ—Ä–µ—Å—É—é—â–∏–º —á–µ–ª–æ–≤–µ–∫–æ–º –≤–µ—Ä–æ—è—Ç–Ω–∞ –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.
"""
            
            strategy = f"""*üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –•–û–†–ê–†–ù–û–ô –ö–ê–†–¢–ï:*

‚Ä¢ *–ü—Ä–æ—è–≤–∏—Ç–µ –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤—É* - –∑–≤–µ–∑–¥—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –≤–∞—à–∏ –¥–µ–π—Å—Ç–≤–∏—è
‚Ä¢ *–ë—É–¥—å—Ç–µ –æ—Ç–∫—Ä—ã—Ç—ã* –Ω–æ–≤—ã–º –∑–Ω–∞–∫–æ–º—Å—Ç–≤–∞–º –≤ —Ç–µ—á–µ–Ω–∏–µ {timing}
‚Ä¢ *–õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ* —Å–æ–≤–µ—Ç—É–µ—Ç –ø—Ä–æ—è–≤–ª—è—Ç—å —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –≤ —á—É–≤—Å—Ç–≤–∞—Ö
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –≥–∞—Ä–º–æ–Ω–∏—é –≤ –æ—Ç–Ω–æ—à–µ–Ω–∏—è—Ö

*‚è∞ –†–ê–°–ß–ï–¢ –í–†–ï–ú–ï–ù–ò:*
–û—Å–Ω–æ–≤–Ω—ã–µ —Å–æ–±—ã—Ç–∏—è –ø—Ä–æ–∏–∑–æ–π–¥—É—Ç –≤ —Ç–µ—á–µ–Ω–∏–µ *{timing}*"""
            
        else:
            analysis = f"""
*üíñ –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó –õ–Æ–ë–í–ò*

*–í—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–∞:* {question_time}
*–ö–∞—Ä—Ç–∞ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∞:* –õ—É–Ω–∞ –≤ –¢–µ–ª—å—Ü–µ, –í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö

---

*üîÆ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê:*

‚ö° *–ê–°–ü–ï–ö–¢–´:* 
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–∏–º—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –º–µ–∂–¥—É —Å–∏–≥–Ω–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º–∏ –ª—é–±–≤–∏

üåë *–°–ò–ì–ù–ò–§–ò–ö–ê–¢–û–†–´:*
‚Ä¢ –õ—É–Ω–∞ –±–µ–∑ –∫—É—Ä—Å–∞ - —Å–∏—Ç—É–∞—Ü–∏—è –≤ —Å—Ç–∞—Ç–∏–∫–µ
‚Ä¢ –í–µ–Ω–µ—Ä–∞ –Ω–µ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –æ—Ç –ª–∏—á–Ω—ã—Ö –ø–ª–∞–Ω–µ—Ç
‚Ä¢ –ù–µ–æ–±—Ö–æ–¥–∏–º–æ –≤—Ä–µ–º—è –¥–ª—è —Ä–∞–∑–≤–∏—Ç–∏—è —Å–æ–±—ã—Ç–∏–π

---

*üí´ –•–û–†–ê–†–ù–´–ô –í–ï–†–î–ò–ö–¢:*

*–°–∏—Ç—É–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç –≤—Ä–µ–º–µ–Ω–∏.* –í –Ω–∞—Å—Ç–æ—è—â–∏–π –º–æ–º–µ–Ω—Ç –∑–≤–µ–∑–¥—ã –Ω–µ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç —è–≤–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –ª—é–±–æ–≤–Ω–æ–π —Å—Ñ–µ—Ä–µ.
"""
            
            strategy = f"""*üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò –ü–û –•–û–†–ê–†–ù–û–ô –ö–ê–†–¢–ï:*

‚Ä¢ *–ù–∞–±–µ—Ä–∏—Ç–µ—Å—å —Ç–µ—Ä–ø–µ–Ω–∏—è* - –õ—É–Ω–∞ –±–µ–∑ –∫—É—Ä—Å–∞ —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –∑–∞—Å—Ç–æ–π
‚Ä¢ *–†–∞–±–æ—Ç–∞–π—Ç–µ –Ω–∞–¥ —Å–æ–±–æ–π* - —É–ª—É—á—à–∞–π—Ç–µ —Å–≤–æ—é —ç–Ω–µ—Ä–≥–µ—Ç–∏–∫—É
‚Ä¢ *–í–µ–Ω–µ—Ä–∞ –≤ –í–µ—Å–∞—Ö* —Å–æ–≤–µ—Ç—É–µ—Ç —Å–æ—Å—Ä–µ–¥–æ—Ç–æ—á–∏—Ç—å—Å—è –Ω–∞ —Å–∞–º–æ–ª—é–±–∏–∏
‚Ä¢ *–ü–µ—Ä–µ—Å–º–æ—Ç—Ä–∏—Ç–µ –≤–æ–ø—Ä–æ—Å* —á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏

*‚è∞ –í–†–ï–ú–ï–ù–ù–´–ï –£–ö–ê–ó–ê–ù–ò–Ø:*
–ó–Ω–∞—á–∏–º—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–ª–∏–∂–∞–π—à–∏–µ *{timing}* –Ω–µ –ø—Ä–µ–¥–≤–∏–¥–∏—Ç—Å—è"""

        return analysis, strategy

    def _analyze_money_question(self, question, chart, question_time):
        """–ê–ù–ê–õ–ò–ó –§–ò–ù–ê–ù–°–û–í –ø–æ —Ö–æ—Ä–∞—Ä–Ω—ã–º –ø—Ä–∏–Ω—Ü–∏–ø–∞–º"""
        # –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—Å–ø–µ–∫—Ç—ã —É–ø—Ä–∞–≤–∏—Ç–µ–ª—è 2-–≥–æ –¥–æ–º–∞ –∏ –Æ–ø–∏—Ç–µ—Ä–∞
        money_aspect = self.analyze_aspects('2ND_RULER', 'JUPITER', chart)
        timing = self.determine_timing(money_aspect)
        
        if money_aspect == "HARMONIOUS":
            analysis = f"""
*üí∞ –•–û–†–ê–†–ù–´–ô –§–ò–ù–ê–ù–°–û–í–´–ô –ê–ù–ê–õ–ò–ó*

*–í—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–∞:* {question_time}

---

*üîÆ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê:*

‚ú® *–ê–°–ü–ï–ö–¢–´:* 
–£–ø—Ä–∞–≤–∏—Ç–µ–ª—å 2-–≥–æ –¥–æ–º–∞ –ø–æ–ª—É—á–∞–µ—Ç –ø–æ–¥–¥–µ—Ä–∂–∫—É –æ—Ç –Æ–ø–∏—Ç–µ—Ä–∞ - –∑–Ω–∞–∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤–æ–≥–æ —Ä–æ—Å—Ç–∞!

üíé *–°–ò–ì–ù–ò–§–ò–ö–ê–¢–û–†–´:*
‚Ä¢ –Æ–ø–∏—Ç–µ—Ä –≤ –ë–ª–∏–∑–Ω–µ—Ü–∞—Ö —É–∫–∞–∑—ã–≤–∞–µ—Ç –Ω–∞ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–æ—Ö–æ–¥–∞
‚Ä¢ –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –Ω–∞–ø—Ä—è–∂–µ–Ω–Ω—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –æ—Ç –°–∞—Ç—É—Ä–Ω–∞
‚Ä¢ –õ—É–Ω–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–µ —Å–∏–≥–Ω–∏—Ñ–∏–∫–∞—Ç–æ—Ä—ã

---

*üí´ –•–û–†–ê–†–ù–´–ô –í–ï–†–î–ò–ö–¢:*

*–§–ò–ù–ê–ù–°–û–í–´–ï –ü–û–¢–û–ö–ò –ê–ö–¢–ò–í–ò–ó–ò–†–£–Æ–¢–°–Ø!* –î–µ–Ω—å–≥–∏ –ø—Ä–∏–¥—É—Ç –≤ –±–ª–∏–∂–∞–π—à–µ–µ –≤—Ä–µ–º—è.
"""
            
            strategy = f"""*üéØ –§–ò–ù–ê–ù–°–û–í–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*

‚Ä¢ *–ë—É–¥—å—Ç–µ –≥–æ—Ç–æ–≤—ã* –∫ –Ω–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–º —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º
‚Ä¢ *–Æ–ø–∏—Ç–µ—Ä –≤ –ë–ª–∏–∑–Ω–µ—Ü–∞—Ö* —Å–æ–≤–µ—Ç—É–µ—Ç –¥–∏–≤–µ—Ä—Å–∏—Ñ–∏–∫–∞—Ü–∏—é –¥–æ—Ö–æ–¥–æ–≤
‚Ä¢ *–ü—Ä–æ—è–≤–ª—è–π—Ç–µ –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å* –≤ –ø–æ–∏—Å–∫–µ –Ω–æ–≤—ã—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤
‚Ä¢ *–ö–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–π—Ç–µ —Ä–∞—Å—Ö–æ–¥—ã* - —ç–Ω–µ—Ä–≥–∏—è –∏–∑–æ–±–∏–ª–∏—è —Ç—Ä–µ–±—É–µ—Ç —Ä–∞–∑—É–º–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è

*‚è∞ –†–ê–°–ß–ï–¢ –í–†–ï–ú–ï–ù–ò:*
–û—Å–Ω–æ–≤–Ω—ã–µ –ø–æ—Å—Ç—É–ø–ª–µ–Ω–∏—è –æ–∂–∏–¥–∞—é—Ç—Å—è –≤ —Ç–µ—á–µ–Ω–∏–µ *{timing}*"""
            
        else:
            analysis = f"""
*üí∞ –•–û–†–ê–†–ù–´–ô –§–ò–ù–ê–ù–°–û–í–´–ô –ê–ù–ê–õ–ò–ó*

*–í—Ä–µ–º—è –≤–æ–ø—Ä–æ—Å–∞:* {question_time}

---

*üîÆ –†–ï–ó–£–õ–¨–¢–ê–¢–´ –ê–ù–ê–õ–ò–ó–ê:*

‚ö° *–ê–°–ü–ï–ö–¢–´:* 
–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –∑–Ω–∞—á–∏–º—ã—Ö –∞—Å–ø–µ–∫—Ç–æ–≤ –∫ —Ñ–∏–Ω–∞–Ω—Å–æ–≤—ã–º —Å–∏–≥–Ω–∏—Ñ–∏–∫–∞—Ç–æ—Ä–∞–º

üíé *–°–ò–ì–ù–ò–§–ò–ö–ê–¢–û–†–´:*
‚Ä¢ –£–ø—Ä–∞–≤–∏—Ç–µ–ª—å 2-–≥–æ –¥–æ–º–∞ –±–µ–∑ –ø–æ–¥–¥–µ—Ä–∂–∫–∏
‚Ä¢ –Æ–ø–∏—Ç–µ—Ä –Ω–µ –∞–∫—Ç–∏–≤–∏—Ä—É–µ—Ç –¥–µ–Ω–µ–∂–Ω—ã–µ –ø–æ—Ç–æ–∫–∏
‚Ä¢ –°–∏—Ç—É–∞—Ü–∏—è —Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Ä–ø–µ–Ω–∏—è

---

*üí´ –•–û–†–ê–†–ù–´–ô –í–ï–†–î–ò–ö–¢:*

*–§–∏–Ω–∞–Ω—Å–æ–≤–∞—è —Å–∏—Ç—É–∞—Ü–∏—è —Å—Ç–∞–±–∏–ª—å–Ω–∞,* –Ω–æ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–µ –ø—Ä–µ–¥–≤–∏–¥–∏—Ç—Å—è.
"""
            
            strategy = f"""*üéØ –§–ò–ù–ê–ù–°–û–í–ê–Ø –°–¢–†–ê–¢–ï–ì–ò–Ø:*

‚Ä¢ *–°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —Ç–µ–∫—É—â–∏–µ –ø–æ–∑–∏—Ü–∏–∏* - –≤—Ä–µ–º—è –¥–ª—è –∫–æ–Ω—Å–µ—Ä–≤–∞—Ç–∏–≤–Ω—ã—Ö —Ä–µ—à–µ–Ω–∏–π
‚Ä¢ *–ö–æ–ø–∏—Ç–µ —Ä–µ—Å—É—Ä—Å—ã* –¥–ª—è –±—É–¥—É—â–∏—Ö –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–µ–π
‚Ä¢ *–ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–∏—Å–∫–æ–≤* - –∑–≤–µ–∑–¥—ã –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç —Å–ø–µ–∫—É–ª—è—Ü–∏–∏
‚Ä¢ *–ü–ª–∞–Ω–∏—Ä—É–π—Ç–µ –±—é–¥–∂–µ—Ç* –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ {timing}

*‚è∞ –í–†–ï–ú–ï–ù–ù–´–ï –£–ö–ê–ó–ê–ù–ò–Ø:*
–ó–Ω–∞—á–∏—Ç–µ–ª—å–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π –≤ –±–ª–∏–∂–∞–π—à–∏–µ *{timing}* –Ω–µ –æ–∂–∏–¥–∞–µ—Ç—Å—è"""

        return analysis, strategy

# –°–æ–∑–¥–∞–µ–º —ç–∫–∑–µ–º–ø–ª—è—Ä –Ω–∞—Å—Ç–æ—è—â–µ–≥–æ –∏–º–ø–µ—Ä–∞—Ç–æ—Ä–∞
emperor = RealHoraryEmperor()

# –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π —Å –ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–û–°–¢–¨–Æ
@bot.message_handler(commands=['start', 'help'])
def send_welcome(message):
    chat_type = "private" if message.chat.type == "private" else "group"
    
    greeting = emperor.get_mystic_greeting()
    
    if chat_type == "private":
        response = f"""{greeting}

*–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:*

üí¨ *–ü—É–±–ª–∏—á–Ω—ã–π –≤–æ–ø—Ä–æ—Å* - –∑–∞–¥–∞–π –∑–¥–µ—Å—å
üîí *–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ* - —Ç–æ–ª—å–∫–æ –º–µ–∂–¥—É –Ω–∞–º–∏

*–¢–µ–º—ã –¥–ª—è –≤–æ–ø—Ä–æ—Å–æ–≤:*
‚Ä¢ üíñ –õ—é–±–æ–≤—å –∏ –æ—Ç–Ω–æ—à–µ–Ω–∏—è
‚Ä¢ üí∞ –§–∏–Ω–∞–Ω—Å—ã –∏ –¥–µ–Ω—å–≥–∏  
‚Ä¢ üåø –ó–¥–æ—Ä–æ–≤—å–µ
‚Ä¢ üíº –ö–∞—Ä—å–µ—Ä–∞

*–ü—Ä–∏–º–µ—Ä:* ¬´–ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏ –¥–æ –∫–æ–Ω—Ü–∞ –Ω–æ—è–±—Ä—è?¬ª"""
    else:
        response = f"""{greeting}

*–í—ã–±–µ—Ä–∏ —Å–ø–æ—Å–æ–± –∫–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏–∏:*

üí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å* (–ø—É–±–ª–∏—á–Ω–æ)
üîí *–ù–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª* (–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ –≤ –õ–°)
üë§ *–ò–ª–∏ –ø–µ—Ä–µ–π–¥–∏ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è* –¥–ª—è –ø–æ–ª–Ω–æ–π –ø—Ä–∏–≤–∞—Ç–Ω–æ—Å—Ç–∏

*–ß—Ç–æ–±—ã –ø–µ—Ä–µ–π—Ç–∏ –≤ –õ–°:*
1. –ù–∞–∂–º–∏ –Ω–∞ –º–æ–µ –∏–º—è @HoraryEmperorBot  
2. –í—ã–±–µ—Ä–∏ ¬´–ù–∞–ø–∏—Å–∞—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ¬ª
3. –ó–∞–¥–∞–π –ª—é–±–æ–π –≤–æ–ø—Ä–æ—Å –ø—Ä–∏–≤–∞—Ç–Ω–æ"""

    bot.reply_to(message, response, parse_mode='Markdown')

@bot.message_handler(func=lambda message: True)
def handle_message(message):
    try:
        user_id = message.from_user.id
        text = message.text.strip()
        chat_type = "private" if message.chat.type == "private" else "group"
        
        print(f"üì® –°–æ–æ–±—â–µ–Ω–∏–µ: '{text}' –≤ —á–∞—Ç–µ: {chat_type}")

        # –û–ë–†–ê–ë–û–¢–ö–ê –õ–ò–ß–ù–´–• –ó–ê–ü–†–û–°–û–í –í –ì–†–£–ü–ü–ï
        if chat_type in ['supergroup', 'group'] and text.lower().startswith(('–ª–∏—á–Ω–æ–µ', '–ø—Ä–∏–≤–∞—Ç–Ω–æ', '–∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ')):
            question = text.split(' ', 1)[1] if ' ' in text else ""
            
            if len(question) < 3:
                bot.reply_to(message, "üîí *–ù–∞–ø–∏—à–∏ –≤–æ–ø—Ä–æ—Å –ø–æ—Å–ª–µ '–õ–∏—á–Ω–æ–µ'*\n\n*–ü—Ä–∏–º–µ—Ä:* ¬´–õ–∏—á–Ω–æ–µ –ß—Ç–æ –º–µ–Ω—è –∂–¥–µ—Ç –≤ –ª—é–±–≤–∏?¬ª", parse_mode='Markdown')
                return
            
            try:
                bot.send_chat_action(message.chat.id, 'typing')
                time.sleep(2)
                
                question_time = datetime.now(timezone.utc) + timedelta(hours=3)
                analysis, strategy = emperor.generate_horary_answer(question, question_time)
                
                private_response = f"üîí *–ö–û–ù–§–ò–î–ï–ù–¶–ò–ê–õ–¨–ù–´–ô –•–û–†–ê–†–ù–´–ô –ê–ù–ê–õ–ò–ó*\n\n{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}"
                
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤ –õ–°
                bot.send_message(user_id, private_response, parse_mode='Markdown')
                bot.reply_to(message, "‚úÖ *–ö–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è!*", parse_mode='Markdown')
                return
                
            except Exception as e:
                print(f"‚ùå –û—à–∏–±–∫–∞ –õ–°: {e}")
                bot.reply_to(message, "üíå *–ù–∞–ø–∏—à–∏ –º–Ω–µ —Å–Ω–∞—á–∞–ª–∞ –≤ –ª–∏—á–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è:* @HoraryEmperorBot\n*–ò–ª–∏ –∑–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å –±–µ–∑ –ª–∏—á–Ω—ã—Ö –¥–µ—Ç–∞–ª–µ–π*", parse_mode='Markdown')
                return

        # –ü–†–ò–í–ï–¢–°–¢–í–ò–Ø
        if text.lower() in ['–ø—Ä–∏–≤–µ—Ç', '–Ω–∞—á–∞—Ç—å', '–∏–º–ø–µ—Ä–∞—Ç–æ—Ä', '–±–æ—Ç', '—Ö–æ—Ä–∞—Ä–Ω—ã–π']:
            greeting = emperor.get_mystic_greeting()
            if chat_type == "private":
                response = f"{greeting}\n\n–ó–∞–¥–∞–π —Å–≤–æ–π –≤–æ–ø—Ä–æ—Å, –∏ —è –ø—Ä–æ–≤–µ–¥—É –Ω–∞—Å—Ç–æ—è—â–∏–π —Ö–æ—Ä–∞—Ä–Ω—ã–π –∞–Ω–∞–ª–∏–∑!"
            else:
                response = f"{greeting}\n\nüí¨ *–ó–∞–¥–∞–π –≤–æ–ø—Ä–æ—Å –∑–¥–µ—Å—å*\nüîí *–ò–ª–∏ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª –¥–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω–æ—Å—Ç–∏*"
            bot.reply_to(message, response, parse_mode='Markdown')
            return

        # –ù–ê–°–¢–û–Ø–©–ò–ï –í–û–ü–†–û–°–´
        bot.send_chat_action(message.chat.id, 'typing')
        time.sleep(2)
        
        question_time = datetime.now(timezone.utc) + timedelta(hours=3)
        analysis, strategy = emperor.generate_horary_answer(text, question_time)
        
        if chat_type == "private":
            full_response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}"
        else:
            full_response = f"{analysis}\n\n*üéØ –°–¢–†–ê–¢–ï–ì–ò–Ø:*\n{strategy}\n\nüíå *–î–ª—è –∫–æ–Ω—Ñ–∏–¥–µ–Ω—Ü–∏–∞–ª—å–Ω—ã—Ö –≤–æ–ø—Ä–æ—Å–æ–≤ –Ω–∞–ø–∏—à–∏ ¬´–õ–∏—á–Ω–æ–µ [–≤–æ–ø—Ä–æ—Å]¬ª*"
        
        bot.reply_to(message, full_response, parse_mode='Markdown')
        
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        bot.reply_to(message, "üîÆ *–ó–≤–µ–∑–¥—ã –≤—Ä–µ–º–µ–Ω–Ω–æ —Å–∫—Ä—ã—Ç—ã... –ü–æ–ø—Ä–æ–±—É–π –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è —Å–Ω–æ–≤–∞*", parse_mode='Markdown')

print("üåå –ù–ê–°–¢–û–Ø–©–ò–ô –•–û–†–ê–†–ù–´–ô –ò–ú–ü–ï–†–ê–¢–û–† –ó–ê–ü–£–©–ï–ù!")
print("ü§ñ –ë–æ—Ç –≥–æ—Ç–æ–≤ –∫ –Ω–∞—Å—Ç–æ—è—â–∏–º —Ö–æ—Ä–∞—Ä–Ω—ã–º –∞–Ω–∞–ª–∏–∑–∞–º!")

if __name__ == "__main__":
    try:
        bot.infinity_polling(timeout=60)
    except Exception as e:
        print(f"‚ùå –û—à–∏–±–∫–∞: {e}")
        time.sleep(10)
